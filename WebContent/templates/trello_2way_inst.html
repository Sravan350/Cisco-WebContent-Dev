<!DOCTYPE html>   
<html> 
<head>  
<meta charset="UTF-8">   
<title>Trello integration to Cisco Spark</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.css" rel="stylesheet" type="text/css"> 
<link href="https://d24wgzqqegxpap.cloudfront.net/api/css/collab-ui-min.css" rel="stylesheet" type="text/css">
<link href="https://183.82.99.100:8443/CiscoWebcontent/css/styles.css" rel="stylesheet" type="text/css"> 
<link href="https://183.82.99.100:8443/CiscoWebcontent/css/select2.min.css" rel="stylesheet"/> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.js"></script> 
<script type="text/javascript" src="https://d24wgzqqegxpap.cloudfront.net/api/js/porthole.min.js"></script>
<script type="text/javascript" src="https://183.82.99.100:8443/CiscoWebcontent/js/operations1.js"></script>
<script src="https://183.82.99.100:8443/CiscoWebcontent/js/select2.min.js"></script>
<style>
#notifications-note{margin:-20px 0 30px 1px;}

</style>
<script>
	integration_app_icon_url="https://d24wgzqqegxpap.cloudfront.net/api/images/trello/trello.png";
	clientAppRevokeMsg = '<p class="integrationAuthMsg"><span class="info-icon" title=""> &nbsp;</span><span>We are facing difficulty while accessing your Trello account. Please click on one of the button to authorize.</span></p>';
	var integration_token="";
	var selected_board_id="0";
	var board_modified=false;
	var list_modified=false;
	var board_id_old="";
	var list_id_old="0";
	var application_id="2";
	var token="";
	var instanceUuid="";
	var room_id = "";
    var selectedBoardId = "";
	var matchFlag = true;
	var configFlag = false;
	var listFlag=false;
	var listId = "";
	var selected_listId= "0";
	var listSuccess = false;
	var jsonStringEdit = "";
	var saveJsonString = "";
	var selectedRoomName = "";
	var action_url = "";
	var actionType = "";
	var notificationsNote = "Once you add the Trello bot to your desired space(s) (see directions above), you can set up multiple configurations to receive customized notifications in that space(s).";
	var notificationLabel = "Trello notification configuration (Optional)";
	//var notificationLabel = "Trello notification configuration";
	var bot_failure_msg = '<span class="close-btn"></span><label>The bot is already added to the space. Try @Trello help in Cisco Spark app to see what the bot can do.</label>';
	var bot_success_msg = '<span class="close-btn"></span><label>The bot is now added to the space. Try @Trello help in Cisco Spark app to see what the bot can do.</label>';
	//var _scopeWarningMsg = '<span class="close-btn"></span><label>You need to disconnect and connect to use this feature.</label>';
	var _scopeWarningMsg = '<span class="close-btn"></span><label>To enable this option, please disconnect and then connect again to this integration.</label>';
	/* Two way changes */
	var isPrivate = false;
	var isTwoWay = false;
	onlyBot = false;
	var roomsSelector = "<select name='room' id='rooms' class='custom-select'> <option value='0'>Please select a space</option> </select>";
	var twowayRoomsSelector = "<select name='room' id='rooms' class='custom-select'> <option value='0'>Please select a space</option><option value='isPrivate'>Private message (only to me) </option> </select>";
	var displayNameBox = "<input type='text' name='displayName1' id='displayName1' class='integration-name'	value=''>";
	/* --- Two way changes --- */
	appName = "Trello";
	postMessageToSpark = appName+" "+postMessageToSpark;
	updateMessageToSpark= appName+" "+updateMessageToSpark;
	removeMessageToSpark= appName+" "+removeMessageToSpark;
	$( document ).ready(function() {
		application_auth_details_url="/api/applications/"+application_id;
		save_spark_token_url="/api/clients/tokens";
		save_app_token_url="/api/integrations/"+integration_id+"/appTokens";
		get_app_token_url="/api/integrations/"+integration_id+"/appTokens";
		configuration_settings_url="/api/integrations/"+integration_id+"/uiSettings";
		save_configuration_settings_url="/api/integrations/instances";
		update_configuration_settings_url="/api/integrations/instances/";
		delete_instance_url="/api/integrations/instances/";
		list_integration_instances_url="/api/integrations/instances";		
		removeall_integration_instances_url="/api/integrations/instances";	
		delete_spark_token_url="/api/clients/tokens";
		delete_integration_token_url="/api/integrations/"+integration_id+"/appTokens";
		getSparkSpaceDetails = "/api/integrations/"+integration_id+"/getSparkSpaceDetailsBySpaceId";
		action=action.toLowerCase();
		
		
		if(action=="connect") {		
			formAction=="connect";
			$("#integrations-block").hide();
			$("#integration-form").hide();
			validateIntegrationAppToken();
		} else if(action=="disconnect") {
			formAction="disconnect";			
			removeAllIntegrationInstances(formAction);
		}else {
			var app_token="";
			//alert(document.referrer);
			//alert("window.top.location"+window.top.location);
			app_token = gup(document.referrer, 'token');
			twowayFlag = gup(document.referrer,'isTwoway');
			console.log("twowayFlag in list from redirect url ::::: "+twowayFlag+" ************ app_token :: "+app_token);
			if(app_token!="") {
				var jsonObject={};
				jsonObject["applicationId"] = application_id;
				jsonObject["integrationId"] = integration_id;
				jsonObject["accessToken"] = app_token;
				jsonObject["expires"] = "3600";
				var jsonString=JSON.stringify(jsonObject);
				validateIntegrationAppTokenInList(jsonString,app_token);
				console.log("code..." + app_token);
			} else {
				validateIntegrationAppTokenDB();
			}
		}
		$("#expand-close").addClass("closearrow");
		$('#expand-close').click(function(e){
			e.preventDefault();
			if($(this).attr('class')=='closearrow'){
				$('#showSetup').hide();
				 $(this).removeClass("closearrow");
				 $(this).addClass("expandarrow");
				 $('.expandarrow').attr('title','expand');
			}else{
				$(this).addClass("closearrow");
				$(this).removeClass("expandarrow");
				$('.closearrow').attr('title','close');
				$('#showSetup').show();
			}
			resize();
		});
		
		$("#rooms").select2();
		$("#trello-icon").attr("src", integration_app_icon_url);
		$(".spark-icon").attr("src", spark_icon_url);

		$("#trello #submit-button").click(function (e){
			e.preventDefault();
			$("#bot-alert").hide();
			onlyBot = false;
			saveTrelloInstance();			
		});
		
		$("#trello #bot-submit-button").click(function(e){
			e.preventDefault();
			$(".close-btn").trigger("click");
			onlyBot = true;
			if($("#rooms option:selected").val()== 0){
				alert("Please select a space.");
			}else{
				saveTrelloInstance();
			}
		});
		
		$("#trello #cancel-button").click(function (e){
			e.preventDefault();	
			$("#bot-alert").hide();
			$('#integration-form').hide();
			$('#integrations-block').show();
			if(listResultData.length == 0){
				listIntegrations();
			}
			resize();
		});
		
		$("#displayName").keypress(function(e){
			if(e.which == 13)
			e.preventDefault();			
		});
		$("#displayName1").keypress(function(e){
			if(e.which == 13)
			e.preventDefault();			
		});
		
		$('#trello #add-config').click(function(e){
			e.preventDefault();	
			formAction="add";
			
			$("#board-lists").hide();
			$('#select2-rooms-container').html('Please select a space'); 
			if(listResultData.length != 0){
				console.log("listresult  "+listResultData.length);
				$("#submit-button").text("Save");
				console.log("isClientAppTokenValid in add-config : "+isClientAppTokenValid);
				if(isClientAppTokenValid){
					resetForm();
					loadTrelloForm();
					loadRooms();
				}else{
					setTrelloAppAuthDetails(integration_id);
				}
			}else{
				console.log("listresilt is not there +++ = isClientAppTokenValid "+isClientAppTokenValid);
				$("#submit-button").text("Save");				
				validateIntegrationAppToken();				
			}
		});
		$('#cancel-remove-integration').click(function(e){
			e.preventDefault();
			$('#remove-integration-popup').foundation('close');
		});
		$("#trello #boards").on('change',function(){
			if($('#boards').val()!=0&&formAction=="update")
				$(".edit-itemconfig-info").hide();
				$(".edit-itemconfig1-info").hide();
		});
		$("#trello #lists").on('change',function(){
			if($('#lists').val()!=0&&formAction=="update")
				$(".edit-itemconfig1-info").hide();
		});	
		$("#trello #rooms").on('change',function(){
			if($('#rooms').val()!=0&&formAction=="update")
				$(".edit-roomconfig-info").hide();
		});	
		$(document).on("click", ".same-config-yes" , function(e) {
			console.log("yes clicked!!!!!!!!!!!!!");
			saveTrelloInstanceConfig();
		});
		$(document).on("click", ".same-config-no" , function(e) {
			console.log("no clicked!!!!!!!!!!!!!");
			$('#same-configuration').foundation('close');
		});
		$(document).on("click", "#trello #instance-list-block .edit-config" , function() {
			formAction="update";
			twowayFlag = false;
			$('#showSetup').hide();
			$(".spark_scope_alert").css("display","none");
			$("#notifications-note").hide();
			$('#lists option[value!="0"]').remove();
			$('#select2-rooms-container').html("Please select a space"); 
			$('#boards').find("option:gt(0)").remove();
			board_modified=false;
			room_modified=false;
			list_modified=false;
			isPrivate = false;
			$("#submit-button").text("Save");
			instanceId=this.id;
			$.each(listResultData,function(index,value){
				if(value["instanceId"]==instanceId) {
					instanceData=value;
				}
			});
			selected_room_id=instanceData.channelId;
			var config=JSON.parse(instanceData.configJson);
			selected_board_id=config.board_id;
			selected_listId = config.list_id;
			isTwoWay = config.twoway;
			isPrivate  =config.isPrivate;
			console.log("EDIT is private ::: "+isPrivate);
			
			if(isTwoWay) {
				twowayFlag = true;
				$("#expand-close").removeClass("closearrow"); // new
				$("#expand-close").addClass("expandarrow"); // new
			}
			console.log("selected_listId..." + selected_listId+" isTwoWay"+isTwoWay);
			var jsonObject1={};
			jsonObject1["integrationId"] = integration_id;
			jsonObject1["userId"] = user_id;
			jsonObject1["boardId"] = config.board_id;
			jsonObject1["responseType"]= 'lists';
			jsonStringEdit=JSON.stringify(jsonObject1);
			console.log("Trello room id in edit :::: "+selected_room_id);
			loadTrelloForm();
			instanceUuid = instanceData.instanceUuid;
			$('#displayName').val(config.displayName);
			board_id_old = config.board_id;
			list_id_old = config.list_id;
			room_id_old = instanceData.channelId;
			var notifications=config.notifications;
			if($.isArray(notifications)) {
				$.each(notifications,function(index,value){
					$("input[type=checkbox][value="+value+"][name=subnotifications]").prop("checked",true);
				});
			} else {
				$("input[type=checkbox][value="+notifications+"][name=subnotifications]").prop("checked",true);
			}			
		});	
		$("#boards").change(function () {
			if($("#boards").val() != '0'){ 
				var jsonObject={};
				jsonObject["integrationId"] = integration_id;
				jsonObject["userId"] = user_id;
				jsonObject["boardId"] = $("#boards").val();
				jsonObject["responseType"]= 'lists';
				jsonString=JSON.stringify(jsonObject);
				resetForm();
				getListsUnderBoard(jsonString);
			}
			resize();
		});
		//two way
		$(".trello-actions").click(function(e){
			e.preventDefault();
			$('#showSetup').show();
			$("#expand-close").removeClass("expandarrow"); // new
			$("#expand-close").addClass("closearrow"); // new
			//checkValidSparkScopes();
			//if(_isValidSparkScope){
			
				console.log("Trello twoway");
				selected_room_id = 0;
				$("#notifications-note").show();
				twowayFlag = true;
				formAction="add";
				$("#board-lists").hide();
				$('#select2-rooms-container').html('');
				$('#select2-rooms-container').html('Please select a space'); 
				$('#boards').find("option:gt(0)").remove();
				if(listResultData.length != 0){
					console.log("listresult  "+listResultData.length);
					$("#submit-button").text("Save");
					console.log("isClientAppTokenValid in add-config : "+isClientAppTokenValid);
					if(isClientAppTokenValid){
						resetForm();
						loadTrelloForm();
					}else{
						setTrelloAppAuthDetails(integration_id);
					}
				}else{
					console.log("listresilt is not there +++ = isClientAppTokenValid "+isClientAppTokenValid);
					$("#submit-button").html("Save");				
					validateIntegrationAppToken();				
				}
			/*}else{
				$('.spark_scope_alert').html(_scopeWarningMsg);
				$('.spark_scope_alert').css("display","block");
				console.log("Not enough spark scopes")
			}*/
		});
		$(".trello-alerts").click(function(e){
			console.log("trello-alerts ")
			e.preventDefault();	
			twowayFlag = false;
			$(".spark_scope_alert").css("display","none");
			$("#notifications-note").html("Receive Trello board notifications in Cisco Spark. You can set up multiple configurations to receive customized notifications in different spaces.");
			selected_room_id = 0;
			formAction="add";
			$("#board-lists").hide();
			$('#select2-rooms-container').html('Please select a space'); 
			$('#boards').find("option:gt(0)").remove();
			if(listResultData.length != 0){
				console.log("listresult  "+listResultData.length);
				$("#submit-button").text("Save");
				console.log("isClientAppTokenValid in add-config : "+isClientAppTokenValid);
				if(isClientAppTokenValid){
					resetForm();
					loadTrelloForm();
					loadRooms();
				}else{
					setTrelloAppAuthDetails(integration_id);
				}
			}else{
				console.log("listresilt is not there +++ = isClientAppTokenValid "+isClientAppTokenValid);
				$("#submit-button").text("Save");				
				validateIntegrationAppToken();				
			}
		});
		
		$(".select-all-checklist").change(function(){
			if($('.select-all-checklist:checked').size()<$('.select-all-checklist').size())	$('#checklist-all').prop("checked",false);
			else $('#checklist-all').prop("checked",true);
		});
		$('#checklist-all').click(function(){
			if($('#checklist-all').is(":checked"))	$('.select-all-checklist').prop("checked",true);
			else $('.select-all-checklist').prop("checked",false);
			
		});
		
		$(".select-all-cards").change(function(){
			if($('.select-all-cards:checked').size()<$('.select-all-cards').size())	$('#cards-all').prop("checked",false);
			else $('#cards-all').prop("checked",true);
		});
		$('#cards-all').click(function(){
			if($('#cards-all').is(":checked"))	$('.select-all-cards').prop("checked",true);
			else $('.select-all-cards').prop("checked",false);
			
		});
		
		$(".select-all-lists").change(function(){
			if($('.select-all-lists:checked').size()<$('.select-all-lists').size())	$('#lists-all').prop("checked",false);
			else {$('#lists-all').prop("checked",true);}
		});
		$('#lists-all').click(function(){
			if($('#lists-all').is(":checked")) $('.select-all-lists').prop("checked",true);
			else $('.select-all-lists').prop("checked",false);
		});
		$(".select-all-boards").change(function(){
			if($('.select-all-boards:checked').size() < $('.select-all-boards').size())$('#boards-all').prop("checked",false);
			else {$('#boards-all').prop("checked",true);}
		});
		$('#boards-all').click(function(){
			if($('#boards-all').is(":checked")) $('.select-all-boards').prop("checked",true);
			else	$('.select-all-boards').prop("checked",false);
		});
		
		$(document).on('click','.close-btn',function(){
			$("#bot-alert").fadeOut("slow");
		});
		$(document).on('click','.close-btn',function(){
			$(".spark_scope_alert").fadeOut("slow");
		});
		
		
    });
	function resetForm(){
		$('#lists option[value!="0"]').remove();	
		$("#board-lists").hide();
	}
	function getListsUnderBoard(jsonString){
		listFlag=false;
		var boardList = [];
		$.ajax({url: configuration_settings_url,
			async:true,
			headers: { 'userId': user_id },
			type: "POST",
			data: jsonString,
			contentType: "application/json",
			dataType: "json",
			success: function(result){
				listSuccess = true;
				var listresponse = result["postSpecificIntegrationSettings"]["listResponse"]; 
				if(listresponse.length != 0){
					$.each(listresponse, function(id,obj){ 
						obj.name = $('<div />').text(obj.name).html();
						$("#lists").append($('<option>').text(obj.name).attr('value',obj.id));
						if(formAction=="update" && selected_listId==obj.id && listFlag==false){
							console.log("obj.id..." + obj.id);
							selected_listId=obj.id;
							listFlag=true;
							console.log("list match.." + selected_listId);
						}
					});	
					$("#board-lists").show();
				}else{
					$("#board-lists").hide();
				}
				if(formAction=="update"&& listFlag==false&&selected_listId!=false){
					selected_listId = "0";
					$(".edit-itemconfig1-info").show();
					console.log("selected_listId.." + selected_listId);
				   } else if(formAction=="update"&&listFlag==false&&selected_listId==false){
						selected_listId = "0";
						$(".edit-itemconfig1-info").hide();
						console.log("selected_listId.." + selected_listId);
				}
				$("#lists").val(selected_listId);
				selected_listId="0";
				resize();
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					$("#board-lists").hide();
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function validateIntegrationAppToken() {
		$.ajax({url: get_app_token_url,
			async:true,
			headers: { 'userId': user_id },
			type: "get",
			success: function(result){
				if(result.tokenResult.tokenId) {
					//loadTrelloForm();
					validateIntegrationAppspecificToken();
				} else {
					setTrelloAppAuthDetails(integration_id);
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function validateIntegrationAppspecificToken(){
		$.ajax({
			url: configuration_settings_url,
			async: true,
			headers: { 'userId': user_id },
			success: function(result){
				if(result["integrationSpecificSettings"]["isValidToken"]==false && result["integrationSpecificSettings"]["isValidToken"] != undefined){
					isClientAppTokenValid = false;
					if(listResultData.length==0){
						setTrelloAppAuthDetails(integration_id);
					}
				}else{
					loadTrelloForm();
				}
				},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
				   alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function generateIntegrationAppToken(app_code) {
		$.ajax({url: get_app_token_url,
			async:true,
			headers: { 'userId': user_id },
			type: "get",
			success: function(result){
				if(result.tokenResult.tokenId) {
					listIntegrations();
				} else {
					//getIntegrationAppTokenDetails(app_code); 
					setTrelloAppAuthDetails(integration_id);
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function getAuthUser(){
		if(ui_settings["integrationSpecificSettings"]!= undefined){
			if(ui_settings["integrationSpecificSettings"]["userResponse"] != undefined && ui_settings["integrationSpecificSettings"]["userResponse"] != null)
				authenticated_user=ui_settings["integrationSpecificSettings"]["userResponse"].email;
		}
	}
	function setTrelloAppAuthDetails(int_id) {
		$.ajax({url: application_auth_details_url,
			async:true,
			headers: { 'userId': user_id },
			success: function(result){
				loginWithAuthDetails(result);	
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});		
	}
    function loginWithAuthDetails(result) {
		var KEY = result.clientId;
		var authorizationEndpoint = result.authorizationEndpoint;
		console.log("Two way flag :::: "+twowayFlag);
		var RETURN_URL='https://183.82.99.100:8443/CiscoWebcontent/spark1.html?isTwoway='+twowayFlag;
		var oauthURL= authorizationEndpoint+'?callback_method=fragment&return_url='+RETURN_URL+'&scope=read,write,account&expiration=never&name=Cisco Spark'+'&key='+KEY;
		isRedirect=true;
		if(isRedirect) {
			if(formAction=="add") {
				window.top.location.href = oauthURL;
			} else {
				var authReqMsg ="";
				authReqMsg+='<hr class="instance-hr"><div class="large-12 medium-12 columns instance-background">';
				authReqMsg+='<div class="no-config-msg"><label>You are not authorized to this integration. Click Add to continue.</label></div></div>';
				$('#integrations-block').show();
				$("#instance-list-block").html(authReqMsg);
			}			
		}else{
			var win = window.open("https://trello.com/", "windowname1", 'width=0, height=0');
			if(win){ 
				win.close();
			}else{
				alert(popblockedMessage); 
				return false;
			}
			$.getScript("https://trello.com/1/client.js?key="+key ,function(){
				Trello.authorize({
					name: "Cisco Spark",
					type: "popup",
					interactive: true,
					expiration: "never",
					persist: false,
					success: function () {
						token = Trello.token();
						var jsonObject={};
						jsonObject["applicationId"] = application_id;
						jsonObject["integrationId"] = integration_id;
						jsonObject["accessToken"] = token;
						jsonObject["expires"] = "3600";
						var jsonString=JSON.stringify(jsonObject);
						saveIntegrationAppToken(jsonString);
					},
					scope: {  write: true, read: true ,account : true},
				});
			});
		} 
	}
	function validateIntegrationAppTokenInList(jsonData,app_code) {
		$.ajax({url: get_app_token_url,
			async:true,
			headers: { 'userId': user_id },
			type: "get",
			success: function(result){
				if(result.tokenResult.tokenId) {
					//listIntegrations();
					validateSpecificAppToken(jsonData,app_code);
				} else {
					saveIntegrationAppToken(jsonData); 
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function validateSpecificAppToken(jsonData,app_code){
		$.ajax({
			url: configuration_settings_url,
			async: true,
			headers: { 'userId': user_id },
			success: function(result){
					if(result["integrationSpecificSettings"]["isValidToken"] != undefined && result["integrationSpecificSettings"]["isValidToken"]==false ){
						isClientAppTokenValid = false;
						if(app_code!="") {saveIntegrationAppToken(jsonData);}
						else setTrelloAppAuthDetails(integration_id);						
					}else{
						isClientAppTokenValid = true;
						listIntegrations();
					}
				},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
				   alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function getListInstances(){
		$.ajax({url: list_integration_instances_url+"?integrationId="+integration_id,
			async:true,
			headers: { 'userId': user_id },
			success: function(result){
			 instanceList = result;
			if(instanceList.length != 0 && instanceList.message == undefined){
				 console.log("instanceList in getListInstances()"+instanceList.length);
				 listIntegrations();
			 }else{
				 loadTrelloForm(); 
			 } 
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }
			}
		});
	}
	function saveIntegrationAppToken(jsonData){
		$.ajax({url: save_app_token_url,
			async:true,
			headers: { 'userId': user_id },
			type: "POST",
			data: jsonData,
			contentType: "application/json",
			dataType: "json",
			success: function(result){
				connectIntegration();
				console.log("isClientAppTokenValid in saveToken *** "+isClientAppTokenValid);
				if(isClientAppTokenValid == false){isClientAppTokenValid = true; getListInstances();}
				else loadTrelloForm(); 
				
			},
			error: function(xmlHttpRequest,error) {
				   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					   return;
				   }else{
						alert("We've experienced some difficulty. Try again.");
					}
			}
		});	
	}
	function loadConfigBlock(){
		console.log("2way flag "+twowayFlag)
		if(twowayFlag == true){
			console.log("Two way flag in loadForm");
			$('.spaces-refresh').hide();
			$('.twoway-config').show();
			//$('#showSetup').show();
			$("#app-notifications-label").html(notificationLabel);
			$("#notifications-note").html(notificationsNote);
			$('.expandClose').show(); //
		}else{
			console.log("One way flag in loadForm");
			$('.spaces-refresh').show();
			$(".twoway-config .room").html("");
			$('.twoway-config').hide();
			$("#app-notifications-label").html("Trello notification configuration");
			$('#showSetup').hide();
			$('.expandClose').hide(); // 
		}
		$("#rooms").select2();
	}
	function loadTrelloForm(){
		$("#form").trigger("reset");
		loadConfigBlock();
		$('#integrations-block').hide();
		$("#integration-form").show();
		$(".edit-roomconfig-info").hide();
		$(".edit-itemconfig-info").hide();
		$(".edit-itemconfig1-info").hide();
		$(".rooms-loading").show();
		resize();
		console.log("Is twoway ::: "+twowayFlag);
		if(twowayFlag) settingsUrl = configuration_settings_url+"?isBot=true";
		else settingsUrl = configuration_settings_url;
		$(".settings-loading").show();
		$.ajax({
			url: settingsUrl,
			async: true,
			headers: { 'userId': user_id },
			success: function(result){
				$(".settings-loading").hide();
				ui_settings=result;	
				loadConfigurationSettings();
				if(!twowayFlag) loadRooms();
				
			},
			 error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					$('#integration-form').html("We've experienced some difficulty. Try again.");
					$('#integration-form').hide();
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
		if(!twowayFlag){
			getAllSparkRooms();
		}
		
	}
	function loadConfigurationSettings(){
		if(ui_settings["sparkRoomSettings"] && ui_settings["integrationSpecificSettings"]) {
			var itemFlag=false;
			var roomFlag=false;
			var rooms ="";
			var boards = ui_settings["integrationSpecificSettings"]["userResponse"]["boards"];
			var authorizedto=ui_settings["integrationSpecificSettings"]["userResponse"].email;
			if(authorizedto!="" && authorizedto!=undefined) {
				$('#authenticted-to').html(authorizedto);
				$("input#authenticatedto").val(authorizedto);
				$(".authenticted-block").css("display","block");
			} 
			if(formAction=="update"){ 
			console.log("***** "+jsonStringEdit);
			if(selected_board_id!=0) getListsUnderBoard(jsonStringEdit);}
			$('#boards')[0].options.length =1;
			var isboardExists=false;
			$.each(boards, function(id,obj){
				isboardExists=true;
				obj.name = $('<div />').text(obj.name).html();
				$("#boards").append($('<option>').text(obj.name).attr('value',obj.id));
				if(formAction=="update" && selected_board_id==obj.id && itemFlag==false){
					selected_board_id=obj.id;
					itemFlag=true;
				}else if(selected_board_id==0 && twowayFlag){
					itemFlag = true;
				}
			});
			if(formAction=="update" && itemFlag==false){
				selected_board_id = "0"; 
				$(".edit-itemconfig-info").show();
				$(".edit-itemconfig1-info").hide();
				$("#board-lists").hide();
			}
			$('#rooms')[0].options.length = 1;
			rooms = ui_settings["sparkRoomSettings"].items;
			//2way
			if(allRooms.length !=0 && !twowayFlag) {
				rooms = allRooms;
			}
			$.each(rooms, function(id,obj){
				obj.title=$('<div />').html(obj.title).text();
				$("#rooms").append($('<option>').text(obj.title).attr('value',obj.id));
				if(formAction=="update" && selected_room_id==obj.id && roomFlag==false){
					selected_room_id=obj.id;
					roomFlag=true;
					console.log("Rooms in update edit-config ::: selected_room_id "+selected_room_id);
				}
			}); 
			console.log(" ::::::: "+selected_room_id+" :::::: "+isPrivate);
			if(formAction=="update" && roomFlag==false ){
				selected_room_id = "0";
				$(".edit-roomconfig-info").show();
			}			
			$("#rooms").val(selected_room_id);
			$("#boards").val(selected_board_id);
			$('#select2-rooms-container').html($("#rooms option:selected").text());
			//selected_room_id="0";
			$(".rooms-loading").hide();
			selected_board_id="0";
			if(isboardExists) {
			} else {
				$('.no-configuration-block').show();
				$('#form').hide();
			}
		}else{
			alert("We've experienced some difficulty. Try again.");
		}
	}
	function validateConfiguration(instance, notifications){
	    console.log("validating Configuration....");
		var configData = JSON.parse(instance.configJson);
		console.log("JSON config ::: "+JSON.stringify(configData));
		var configEvents = configData.notifications;
		var notificationsLength = notifications.length;
		var matchCount = 0;
		configFlag = false;
		matchFlag = true;
		console.log("listId..." + listId);
		if(instance.channelId==room_id && configData.board_id==selectedBoardId && configData.list_id==listId){
			configFlag = true;
		}
		console.log("configData.notifications "+JSON.stringify(configData.notifications));
		if($.isArray(notifications)){
			//console.log("configEvents..." + configEvents +"length...." + configEvents.length);
			if($.isArray(configEvents)){
				for (var p in notifications) {
					if(configEvents[p] != notifications[p]){
						matchFlag = false;
						console.log("Match: " + configEvents[p] + "!=" + notifications[p]);
					}else {
						matchCount = matchCount +1;
					   console.log("Match: " + configEvents[p] + "==" + notifications[p]);
					}
					console.log("match count..." + matchCount + "configEvents.length..." + configEvents.length);
					if(matchCount==configEvents.length&&notificationsLength==configEvents.length){
						matchFlag = true;
						return false;
					}else{
						matchFlag = false;
					}
				}
			}else{
			    console.log("not matched...configEvents");
				matchFlag = false;
			}
		}else{
			if($.isArray(configEvents)){
			    matchFlag = false;
				console.log("not matched...array" + matchFlag);
			}else{
			  if(configEvents==notifications){
				matchFlag = true;
				 console.log("matched single.." + matchFlag);
			  }else{
				matchFlag = false;
			  }
			}
		}
	}
	
	function saveTrelloInstance() {
		var res = $('form').serializeObject();
		selectedRoomName=$("#rooms option:selected").text();
	    selectedBoardId = $("#boards option:selected").val();
	    room_id = $("#rooms option:selected").val();
		var list_id = $("#lists").val();
		var jsonData = {};			
		jsonData["channelId"] = room_id;									
		jsonData["integrationId"] = integration_id;
		jsonData["status"] = "ACTIVE";
		jsonData["userId"] = user_id;
		jsonData["messageFormat"]="Trello Bot :"+"Hello...User";
		
		postAddMessageToRoom(room_id,appName);
		if(formAction=="update") {
			jsonData["instance_id"] = instanceId;
			if(!onlyBot){
				jsonData["room_id_old"] = room_id_old;
				if(room_id!=room_id_old) {
					room_modified=true;
					jsonData["messageToSpark"] = updateMessageToSpark;
				} else {
					room_modified=false;
				}
				if(board_id_old!=selectedBoardId) {
					board_modified=true;
				} else {
					board_modified=false;
				}
				if(list_id_old!=list_id) {
					list_modified=true;
				} else {
					list_modified=false;
				}
				jsonData["repo_modified"] = board_modified;
				jsonData["room_modified"] = room_modified;
				jsonData["instanceUuid"] = instanceUuid;
				jsonData["configJson"]=JSON.parse(instanceData.configJson);
			}else{
				jsonData["configJson"]={};
			}
			action_url=update_configuration_settings_url+instanceId;
			actionType="PUT";
			/*if(onlyBot){
				action_url=save_configuration_settings_url;
				actionType="POST";
			} */
			$('.loading-first-block').html('Please wait while your Integration is being updated');
		} else {
			jsonData["configJson"]={};
			jsonData["messageToSpark"] = postMessageToSpark;
			action_url=save_configuration_settings_url;
			actionType="POST";
			$('.loading-first-block').html('Please wait while your Integration is being set up');
		}
		jsonData["configJson"]["board_id"] = selectedBoardId;
		if($("#lists").val() == 0){
			listId = false;
			jsonData["configJson"]["list_id"] = false;
		}else{
			listId = $("#lists").val();
			jsonData["configJson"]["list_id"] = $("#lists").val();
		}
		
		jsonData["configJson"]["notifications"]={};	
		jsonData["configJson"]["notifications"] = res.subnotifications;	
		if(twowayFlag){
			jsonData["configJson"]["twoway"] = true;
		}else{
			jsonData["configJson"]["twoway"] = false;
		}
		jsonData["configJson"]["displayName"]= res.displayName;
		if(!onlyBot){
			var notificationslength = objLength(res.subnotifications);
			var notifications = res.subnotifications;
			if(listResultData.length != 0 && notificationslength !=0){
				$.each(listResultData, function(i, instance) {
					if(formAction=="update"&&instance.instanceId!=instanceId){
					 validateConfiguration(instance, notifications);
					 if(matchFlag==true&&configFlag==true){
							return false;
						}
					}
					if(formAction!="update"){
					 validateConfiguration(instance, notifications);
					  if(matchFlag==true&&configFlag==true){
							return false;
						}
					}
				});
			}
		}
		jsonData["configJson"]["onlyRoom"] = false;
		saveJsonString = JSON.stringify(jsonData);
		if(room_id == 0){
			alert("Please select a space");
		}else if($('#boards').val()==0){ 
			alert("Please select a board");
		}else if(notificationslength==0) {
			alert("Please select at least 1 notification");
		}else if(listResultData.length != 0 && matchFlag==true && configFlag==true){
			if(formAction=="update"){
				$.each(listResultData, function(i, instance) {
					if(formAction=="update"&&instance.instanceId==instanceId){
						validateConfiguration(instance, notifications);
					}
				});
				if(room_modified || board_modified || list_modified || !matchFlag)
					$('#same-configuration').foundation('open');
				else
					saveTrelloInstanceConfig();
			}else{
				$('#same-configuration').foundation('open');
			}
		}else{
			saveTrelloInstanceConfig();
		}
	}
	
	function saveTrelloInstance1() {
		var res = $('form').serializeObject();
		selectedRoomName=$("#rooms option:selected").text();
	    selectedBoardId = $("#boards option:selected").val();
	    room_id = $("#rooms option:selected").val();
		var list_id = $("#lists").val();
		console.log("listId...." + listId);
		var jsonData = {};			
		jsonData["channelId"] = room_id;									
		jsonData["integrationId"] = integration_id;
		jsonData["status"] = "ACTIVE";
		jsonData["userId"] = user_id;
		jsonData["messageFormat"]="Trello Bot :"+"Hello...User";
		
		postAddMessageToRoom(room_id,appName);
		if(formAction=="update") {
			jsonData["instance_id"] = instanceId;
			if(!onlyBot){
				jsonData["room_id_old"] = room_id_old;
				if(room_id!=room_id_old) {
					room_modified=true;
					jsonData["messageToSpark"] = updateMessageToSpark;
				} else {
					room_modified=false;
				}
				if(board_id_old!=selectedBoardId) {
					board_modified=true;
				} else {
					board_modified=false;
				}
				if(list_id_old!=list_id) {
					list_modified=true;
				} else {
					list_modified=false;
				}
				jsonData["repo_modified"] = board_modified;
				jsonData["room_modified"] = room_modified;
				jsonData["instanceUuid"] = instanceUuid;
				jsonData["configJson"]=JSON.parse(instanceData.configJson);
			}else{
				jsonData["configJson"]={};
			}
			action_url=update_configuration_settings_url+instanceId;
			actionType="PUT";
			if(onlyBot){
				action_url=save_configuration_settings_url;
				actionType="POST";
			}
			$('.loading-first-block').html('Please wait while your Integration is being updated');
		} else {
			jsonData["configJson"]={};
			jsonData["messageToSpark"] = postMessageToSpark;
			action_url=save_configuration_settings_url;
			actionType="POST";
			$('.loading-first-block').html('Please wait while your Integration is being set up');
		}
		if(!onlyBot){
			console.log("display name1 in !onlyBot ::: "+res.displayName1);
			jsonData["configJson"]["board_id"] = selectedBoardId;
			//jsonData["configJson"]["displayName"]= res.displayName1;
		
			if($("#lists").val() == 0){
				listId = false;
				jsonData["configJson"]["list_id"] = false;
			}else{
				listId = $("#lists").val();
				jsonData["configJson"]["list_id"] = $("#lists").val();
			}
			
			jsonData["configJson"]["notifications"]={};	
			jsonData["configJson"]["notifications"] = res.subnotifications;	
		}
		
		//2way
		if(twowayFlag){
			jsonData["configJson"]["twoway"] = true;
		}else{
			jsonData["configJson"]["twoway"] = false;
		}
		jsonData["configJson"]["displayName"]= res.displayName;
		//-----------
		if(!onlyBot){
			var notificationslength = objLength(res.subnotifications);
			var notifications = res.subnotifications;
			if(listResultData.length != 0 && notificationslength !=0){
				$.each(listResultData, function(i, instance) {
					if(formAction=="update"&&instance.instanceId!=instanceId){
					 validateConfiguration(instance, notifications);
					 if(matchFlag==true&&configFlag==true){
						 console.log("matchFlag in cond.." + matchFlag + " config Flag.." + configFlag);
							return false;
						}
					}
					if(formAction!="update"){
					 validateConfiguration(instance, notifications);
					  if(matchFlag==true&&configFlag==true){
						 console.log("matchFlag in cond.." + matchFlag + " config Flag.." + configFlag);
							return false;
						}
					}
				});
			}
			
		}
		
		jsonData["configJson"]["onlyRoom"] = false;
		saveJsonString = JSON.stringify(jsonData);
		if(twowayFlag && room_id !=0 && onlyBot ){
			jsonData["configJson"]["onlyRoom"] = true;
			saveJsonString = JSON.stringify(jsonData);
			saveTrelloInstanceConfig();
		}else if(twowayFlag && !onlyBot){
			if(room_id == 0){
				alert("Please select a space");
			}else if($('#boards').val()==0){ 
				alert("Please select a board");
			}else if(notificationslength==0) {
				alert("Please select at least 1 notification");
			}else if(listResultData.length != 0 && matchFlag==true && configFlag==true){
				if(formAction=="update"){
					$.each(listResultData, function(i, instance) {
						if(formAction=="update"&&instance.instanceId==instanceId){
							validateConfiguration(instance, notifications);
						}
					});
					if(room_modified || board_modified || list_modified || !matchFlag)
						$('#same-configuration').foundation('open');
					else
						saveTrelloInstanceConfig();
				}else{
					$('#same-configuration').foundation('open');
				}
			}else{
				saveTrelloInstanceConfig();
			}
		}else if(!twowayFlag){
			jsonData["configJson"]["isValidSparkScope"] = false;
			saveJsonString = JSON.stringify(jsonData);
			if(room_id == 0){
				alert("Please select a space");
			}else if($('#boards').val()==0){ 
				alert("Please select a Board");
			}else if(notificationslength==0) {
				alert("Please select at least 1 notification");
			}else if($('#rooms').val()==0 || $('#rooms').val()==null){ 
				alert("Please select a space");
			} else if(listResultData.length != 0 && matchFlag==true && configFlag==true){
				if(formAction=="update"){
					$.each(listResultData, function(i, instance) {
						if(formAction=="update"&&instance.instanceId==instanceId){
						 validateConfiguration(instance, notifications);
						}
					});
					if(room_modified || board_modified || list_modified || !matchFlag)
						$('#same-configuration').foundation('open');
					else
						saveTrelloInstanceConfig();
				}else{
					$('#same-configuration').foundation('open');
				}
			}else{
				saveTrelloInstanceConfig();
			}
		}
	}
	function saveTrelloInstanceConfig(){
		console.log("saveTrelloInstanceConfig!!!!!!!!!");
		$('#same-configuration').foundation('close');
		$('.loading-second-block').html('Selected Space is '+ selectedRoomName);
		//$('#loading-block').foundation('open');
		if(onlyBot){
			//$('#loading-block').foundation('open');
			
			//$('#trello-loading-block').removeClass("loading-block").addClass("bot-loading-block");
			//$('#trello-success-integration').removeClass("success-integration").addClass("bot-success-integration");
		}else{
			//$('#loading-block1').attr('id','loading-block');
			//$('#success-integration1').attr('id','success-integration');
			$('#loading-block').foundation('open');
			//$('#loading-block').removeClass("bot-loading-block").addClass("loading-block");
			//$('#trello-success-integration').removeClass("bot-success-integration").addClass("success-integration");
		}
		console.log("**** action_url **** :: "+action_url);
		$.ajax({url: action_url,
			async:true,
			headers: { 'userId': user_id },
			type: actionType,
			data: saveJsonString, 
			contentType: "application/json",
			dataType: "json",
			success: function(result){
				if(!onlyBot){
					$('#success-integration').foundation('open');
					$('#loading-block').foundation('close');
				}else{
					if(result['twoWaySetUpResponse']['addMemberToSpaceResponse'] != undefined && result['twoWaySetUpResponse']['addMemberToSpaceResponse']['statusCode'] == 409){
						//$('#loading-block').foundation('close');
						 $("#bot-alert").html(bot_failure_msg );
					}else{
						//$('success-integration').foundation('open');
						//$('#loading-block').foundation('close');
						$("#bot-alert").html(bot_success_msg);
					}
					$("#bot-alert").fadeIn("slow");
					/*var polling = setInterval(function(){
					   $("#bot-alert").fadeOut("slow"); 
					   clearInterval(polling);
					}, 3000);*/
				}
			},
			error: function(xmlHttpRequest, error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					$('#loading-block').foundation('close');
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
		$('.loading-first-block').html('Please wait just a moment while your app is loading');
		$('.loading-second-block').html('');
	}

</script>
</head>
<body>
    <div class="integration-app" id="trello">
		<div class="rows large-12 medium-12 columns warning-msg" style="display:none;"></div>
		<div class="rows large-12 medium-12 columns client-app-warning" style="display:none;"></div>
		<div id="loading-block" class="reveal" data-reveal  data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="loading"><img class="spark-icon" src="" alt="....."></div>
			<div class="loading-div-background">
				<div class="loading-first-block">Please wait just a moment while your app is loading</div>
				<div class="loading-second-block">name and space name</div>
				<div class="loading-bar"><div class="loading-background"></div>	</div>
			</div>
		</div>
		<div id="list-loading-block" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="loading"><img class="spark-icon" src="" alt="....."></div>
			<div class="loading-div-background">
				<div class="loading-first-block">Please wait...</div>
				<div class="loading-second-block"></div>
				<div class="loading-bar"><div class="loading-background"></div>	</div>
			</div>
		</div>
		<div id="success-integration" class="reveal" data-reveal  data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="success-loading">
				<img class="spark-icon" src="" alt=".....">
			</div>
			<div class="well-done-text">Well done!</div>
			<div class="success-integration-first-block">Your configuration has been set up and is ready to use.</div>
			<div class="large-5 medium-5 columns buttons-block">
				<div class="success-integration-second-block">
					<!--<button class="button" id="room-button">Go to
						Content Testing Space</button>-->
					<button class="secondary button" id="done-button">Done</button>
				</div>
			</div>
		</div>
		<div class="reveal" id="remove-integration-popup" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="large-12 columns desktop-block">			    
				<div class="row">
					<div class="large-2 medium-2 columns"><img alt="" id="trello-icon" src=""/></div>
					<div class="large-6 medium-6 columns" style="float:left;">
						<label id="displayName-label"></label>
						<label id="addedon-label"></label>
					</div>
				</div><br>
				<div class="msg-labels">
					<label id="remove-msg"></label> 
					<label id="remove-auth"></label>
				</div>			
				<button class="close-button" data-close aria-label="Close modal" type="button">
					<span aria-hidden="true">&times;</span>
				</button><br><br>
				<button id="remove-integration-btn" class="button remove-integration-btn" style="float:right">Remove</button>
			</div>
			<div class="large-12 columns mobile-block">	
				<div class="msg-labels"><label id="remove-msg-mobile"></label> <label id="remove-auth-mobile"></label></div>				
				<div class="option-buttons remove-integration-buttons">
					<label id="cancel-remove-integration" class="remove-popup-cancel"> 
						<a href="#" >Cancel</a>
					</label>
					<label class="remove-popup-remove remove-integration-btn">
						<a href="#">Remove</a>
					</label>
				</div>
			</div>
		</div>
		<div id="same-configuration" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="same-config-text">An identical configuration to the same Cisco Spark space you have selected already exists. Are you sure you want to configure one more?</div>
			<div class="large-5 medium-5 columns buttons-block">
				<button class="secondary button same-config-yes">Yes</button>
				<button class="secondary button same-config-no">No</button>
			</div>
		</div>
		<div id="bot-alert"></div>
		<div class="spark_scope_alert" style="display:none;"></div>
		<div class="integrations" id="integrations-block">
			<div id="instance-loading-block" class="row instance-loading-block" style="display: none;">
				<div class="instances-loading">&nbsp;</div>
				<div class="instances-loading-text"></div>
			</div>
			<div id="home" class="home">
				<div class="row large-12 medium-12 columns" > <!-- style="margin:10px 0 25px 20px" -->
					<p style="margin:0 0 12px -8px;">There are 2 options to add Trello for Cisco Spark:</p>
					<div  class="large-10 medium-10 columns" ><p><b>&#183;</b> Update Trello boards from Cisco Spark and/or receive Trello notifications in Cisco Spark </p></div><div class="large-2 medium-2 columns"><button class="button secondary trello-actions text"  style="margin:0 0 15px 0;padding: 0.6rem 1.8rem;">Add</button></div>
				</div>
				<div class="row large-12 medium-12 columns " style = "margin-bottom:15px;" > <!-- Only receive Trello notifications in Cisco Spark -->
					<div class="large-8 medium-8 columns"><p><b>&#183;</b> Receive Trello board notifications in Cisco Spark</p></div><div class="large-2 medium-2 columns"><button class="button secondary trello-alerts text" style="margin-right:0px;padding: 0.6rem 1.8rem;">Add</button></div>
				</div>
				<div class="row add-config-block">
					<div class="large-12 medium-12 columns">							
						<div class="large-6 medium-6 columns config-name"><label><b>Trello configurations</b></label></div>
						<div class="large-6 medium-6 columns">
							<!--<button class="button" data-open="remove-integration-popup" id="remove-all-config">Remove All</button>
							 <button class="secondary button" id="add-config">Add</button> -->
						</div>					
					</div>
				</div>
				<div id="instance-list-block" class="row instance-list-block">						
				</div> 
			</div>
		</div>
		<div class="large-12 columns" id="integration-form" >
			<form name="form" id="form" method="post">
				<!--<div class="row ">-->
					<div class="row app-config-block twoway-config" style="display:none">
						<div class="large-12 medium-12 columns edit-itemconfig-info" style="display:none">
							<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured board does not exist.</span></p>
						</div>
						<div class="large-12 medium-12 columns edit-itemconfig1-info" style="display:none">
							<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured list does not exist.</span></p>
						</div>
						<div class="large-12 medium-12 columns edit-roomconfig-info" style="display:none">
							<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured space does not exist.</span></p>
						</div>
						<div class="authenticted-block">Authenticated to Trello as: <span id="authenticted-to"></span></div>
						<div class="no-configuration-block" style="display:none">There are no boards available in your Trello Account. Please create boards in your account and configure<br></div>
						<div class="large-12 columns first sub-config-block">
							<h3 class="heading-01">Add Bot to Cisco Spark</h3>
							<!-- <div class="large-10 medium-10 columns sub-config-block items-config">
								<div class="large-3 medium-3 columns bot-small-mobile">
									<label class="label-config">Space
										<span class="has-tip tip-right" id="tooltip" title="Space in which you'd like to receive notifications. Only spaces in which you are eligible to add a bot will display here." data-tooltip>
											<img class="tool-tip">
										</span>
									</label>
								</div>
								<div class="large-5 medium-5 columns text left bot-input-small-mobile">
									<span class="room">
									</span>
								</div>
								<div class="spaces-refresh spaces-refresh1" title="Refresh the spaces"></div>
								<div class="rooms-loading" style="display: none;"></div>
							</div>
							<br/>
							<div class="large-12 medium-12 columns" style="margin-bottom:10px">
								<div class="large-6 medium-6 columns">
								<div class="large-4 medium-4 columns left bot-btn" >
									<button class="button secondary text" style="margin:0 -23px 20px 0;" id="bot-submit-button">Add Bot</button>
								</div>
								</div>
								<div class="large-6 medium-6 columns">
								&nbsp;
								</div>
							</div> -->
							<div class="large-12 medium-12 columns expandClose" style="display:none">
								<p><span class="" id="expand-close" title=""> &nbsp;</span><span id="config-label">Please follow the below steps to add Trello Bot to the desired Cisco Spark space.</span></p>
								<div id="showSetup">
									<div class="large-12 columns sub-config-block">
										<div class="large-1 medium-1 columns step">
											<h3><label>Note :</label></h3>
										</div>
										<div class="large-11 medium-11 columns step-text">
											<p>You must be moderator of the Cisco Spark space to add Trello Bot. Please follow below steps to add Trello Bot.</p>
										</div>
									</div>
									<div class="large-12 columns sub-config-block">
										<div class="large-1 medium-1 columns step">
											<h3><label>Step A</label></h3>
										</div>
										<div class="large-11 medium-11 columns step-text">
											<p>In your Cisco Spark space, click on <b>People</b> as shown.</p><br>
											<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/trello/screenshot01.PNG"><br/>
										</div>
									</div>
									<div class="large-12 columns sub-config-block">
										<div class="large-1 medium-1 columns step">
											<h3><label>Step B</label></h3>
										</div>
										<div class="large-11 medium-11 columns step-text">
											<p>Click on <b>Add people</b> to add Trello Bot.</p><br>
											<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/trello/screenshot02.PNG"><br/>
										</div>
									</div>
									<div class="large-12 columns sub-config-block">
										<div class="large-1 medium-1 columns step">
											<h3><label>Step C</label></h3>
										</div>
										<div class="large-11 medium-11 columns step-text">
											<p>Search for <b>trello.cisco@sparkbot.io</b> and press enter key or click on Bot.</p><br>
											<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/trello/screenshot1.PNG"><br/><br/>
											<p>After adding Bot to the space, welcome message will posted from the Bot and you can perform actions from Spark space by providing commands. Proceed to "Trello notification configuration" below if you would like to configure Trello notifications in Spark</p><br/>
											<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/trello/screenshot2.PNG"><br/><br/>
										</div>
									</div>
								</div><br/><br/>
							</div>
						</div>
					</div>
				<!-- </div> -->
				<div class="row app-config-block">
					<div class="large-12 columns first sub-config-block " style="margin-bottom:2rem;">
						<h3 class="heading-01" id="app-notifications-label">Trello notification configuration</h3>
						<label id="notifications-note">Receive Trello board notifications in the space the bot was added above. You can set up multiple configurations to receive customized notifications in different spaces.</label>
						<div class="large-12 medium-12 columns" style="display:none" >&nbsp;</div> 
						<div class="large-10 medium-10 columns items-config" style="float:left;">
							<div class="large-3 medium-3 columns">
								<label class="label-config left">Trello Board
									<span class="has-tip tip-right" id="tooltip" title="Boards, for which you'd receive notifications" data-tooltip><img class="tool-tip"></span>
								</label>
							</div>						
							<div class="large-6 medium-6 columns dropdown-config text left" style="margin-left:6px;">
								<select name="boards"  id="boards" class="dropdown"><option value="0" hidden>Select a Board</option></select>
								<div class="settings-loading" style="display: none;margin-right:15px;"></div>
							</div>	
						</div>						
					</div>
					<div class="large-12 columns events-config">
						<div class="large-12 medium-12 columns events">
							<label>Notifications: Boards</label>
							<div class="events-sub" id="board-list-notifications">
							    <div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  name="subnotifications" id="boards-all" value="boards-all"><label for="boards-all">All</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  class="select-all-boards" name="subnotifications" id="list-created" value="list-created"><label for="list-created">List created</label>
									</div>
									
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  class="select-all-boards" name="subnotifications" id="member-added" value="member-addedto-board"><label for="member-added">Member added to board</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  class="select-all-boards" name="subnotifications" id="board-renamed" value="board-renamed"><label for="board-renamed">Board renamed</label>
									</div>	
								</div>
							</div>
						</div>
						<div class="large-12 medium-12 columns">&nbsp;</div>
						<div class="large-12 columns first sub-config-block" id="board-lists" style="display:none">
							<div class="large-10 medium-10 columns items-config" >
								<div class="large-3 medium-3 columns ">
									<label class="label-config">List (optional)
										<span class="has-tip tip-right" id="tooltip" title="List, for which you'd receive notifications" data-tooltip><img class="tool-tip"></span>
									</label>
								</div>
								<div class="large-6 medium-6 dropdown-config columns text left " style="margin-left:8px">
									<select id="lists" name="lists" class="dropdown">
										<option value='0'>Select a list</option>  
									</select>
									<div class="settings-loading" style="display: none;margin-right:-11px;"></div>
								</div>								
							</div>
						</div>
						<div class="large-12 medium-12 columns events">
							<label>Notifications: Lists</label>
							<div class="events-sub" id="list-notifications">
							    <div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" name="subnotifications" id="lists-all" value="lists-all"><label for="lists-all">All</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  class="select-all-lists" name="subnotifications" id="list-renamed" value="list-renamed"><label for="list-renamed">List renamed</label>
									</div>
									
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  class="select-all-lists" name="subnotifications" value="list-archived-unarchived" id="list-archived"><label for="list-archived">List archived/unarchived</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox"  class="select-all-lists"  name="subnotifications" id="list-moved" value="list-movedto-otherboard"><label for="list-moved">List moved to other board</label>
									</div>
								</div>
							</div>
						</div>
						<div class="large-12 medium-12 columns">&nbsp;</div>
						<div class="large-12 medium-12 columns events">	
							<label>Notifications: Cards</label>
							<div class="events-sub" id="cards-notifications">
							    <div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" name="subnotifications" id="cards-all" value="cards-all"><label for="cards-all">All </label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox"  class="select-all-cards" name="subnotifications" id="card-created" value="card-created"><label for="card-created">Card created </label>
									</div>
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="card-renamed" value="card-renamed"><label for="card-renamed">Card renamed</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="card-moved" value="card-moved"><label for="card-moved">Card moved</label>
									</div>
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="comment-added" value="comment-addedto-card"><label for="comment-added">Comment added to card</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="attachment-added" value="attachment-addedto-card"><label for="attachment-added">Attachment added to card</label>
									</div>
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="description-changed" value="description-changed"><label for="description-changed">Description changed</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="due-date-changed" value="duedate-changed"><label for="due-date-changed">Due date changed</label>
									</div>	
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="due-date-completed" value="duedate-completed"><label for="due-date-completed">Due date completed</label>
									</div>	
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="label-changed" value="label-changed"><label for="label-changed">Label changed</label>
									</div>
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
									<input type="checkbox" class="select-all-cards" name="subnotifications" id="card-member-added" value="member-addedto-card"><label for="card-member-added">Member added to card</label>
									</div>
									<div class="large-6 medium-6 columns checkbox">
										<input type="checkbox" class="select-all-cards" name="subnotifications" id="card-archived" value="card-archived"><label for="card-archived">Card archived/unarchived</label>
									</div>
								</div>
							</div>
						</div>
						<div class="large-12 medium-12 columns">&nbsp;</div>
						<div class="large-12 medium-12 columns events">
							<label>Notifications: Checklists</label>
							<div class="events-sub" id="checklists-notifications">
							    <div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" name="subnotifications" id="checklist-all" value="checklist-all"><label for="checklist-all">All</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" class="select-all-checklist" name="subnotifications" id="checklist-card-created" value="checklist-card-created"><label for="checklist-card-created">Checklist added to card</label>
									</div>
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" class="select-all-checklist" name="subnotifications" id="checklist-cardmoved" value="checklist-item-created"><label for="checklist-cardmoved">Checklist item created</label>
									</div>
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" class="select-all-checklist" name="subnotifications" id="checklist-card-renamed" value="checklist-renamed"><label for="checklist-card-renamed">Checklist renamed</label>
									</div>
								</div>
								<div class="large-12 medium-12 columns">								
									<div class="large-3 medium-4 columns checkbox">
										<input type="checkbox" class="select-all-checklist" name="subnotifications" id="checklist-item-complete" value="item-complete"><label for="checklist-item-complete">Checklist item complete</label>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row spark-config-block">
					<div class="large-10 medium-10 columns">
						<h3 class="heading-01">Cisco Spark configuration</h3>
						<div class="large-8 columns sub-config-block">
							<div class="large-2 medium-3 columns small-mobile">
								<label>Space
									<span class="has-tip tip-right" id="tooltip" title="Space in which you'd like to receive notifications. Spaces with at least 1 message will appear here." data-tooltip><img class="tool-tip"></span>
								</label>
							</div>
							<div class="large-5 medium-5 columns text left input-small-mobile">
								<select name="room" id="rooms" class="custom-select">
									<option value='0'>Please select a space</option>
								</select>
							</div>
							<div class="spaces-refresh" title="Refresh the spaces"></div>
							<div class="rooms-loading" style="display: none;"></div>
						</div>
						<div class="large-8 columns sub-config-block left">
							<div class="large-2 medium-3 columns small-mobile config-optional">
								<label>Configuration name (optional)</label>
							</div>
							<div class="large-5 medium-5 columns text left input-small-mobile">
								<input type="text" name="displayName" id="displayName" class="integration-name"	value="">
							</div>							
						</div>
					</div>
				</div>
				<div class="row integration-config-block">
					<div class="large-5 medium-5 columns" >&nbsp;</div>
					<div class="large-4 medium-4 columns left" >
						<button class="button" id="cancel-button">Cancel</button>
						<button class="button secondary text" id="submit-button">Add Integration</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</body>
</html> 