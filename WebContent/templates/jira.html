<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>JIRA Integration to Cisco Spark</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.css" rel="stylesheet" type="text/css"> 
<link href="https://d24wgzqqegxpap.cloudfront.net/api/css/collab-ui-min.css" rel="stylesheet" type="text/css">
<link href="https://d24wgzqqegxpap.cloudfront.net/api/css/select2.min.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.js"></script> 
<script type="text/javascript" src="https://d24wgzqqegxpap.cloudfront.net/api/js/porthole.min.js"></script>
<script type="text/javascript" src="https://183.82.99.100:8443/CiscoWebcontent/js/operations1.js"></script>
<!-- <script type="text/javascript" src="https://183.82.99.100:8443/CiscoWebcontent/js/options11.js"></script> -->
<script src="https://d24wgzqqegxpap.cloudfront.net/api/js/jquery.multiselect.js"></script>
<link href="https://d24wgzqqegxpap.cloudfront.net/api/css/jquery.multiselect.css" rel="stylesheet" type="text/css">
<link href="https://183.82.99.100:8443/CiscoWebcontent/css/styles.css" rel="stylesheet" type="text/css">  
<script src="https://d24wgzqqegxpap.cloudfront.net/api/js/select2.min.js"></script>
<style>
	#collapse{cursor:pointer;}
	.jira.dropdown-config{left:-15px;}
	.auth-issuetypes div.ms-options > ul{margin-left:10px;}
	.jira-baseurl-tooltip {margin-top: -8px !important;}
	.jira-links {margin-bottom: 20px;}
	.jira-align-margin{margin:0 0 0 -9px !important;}
	.instructions_tooltip{ margin:-7px 0 0 0.5rem !important;}
	.admin_instruction_label{margin: -1.25rem 0 0 1.28rem;}
	.file_sending_loading{margin:0 18rem 0 0;}	
	
	 input[type="radio"] {
						margin-right: 4px;
						opacity: 1;
						position: relative !important;
						top: 3px;
						height: 15px !important;
						z-index: 0;
						width: 15px !important;
						top: 2px !important;
					}
	.jiraradiobutton{
					margin: 0 0 0 60px;
					}
	@media screen and (max-width: 650px) {
										.jiraradiobutton{
														margin: 0 0 0 60px;
														}
										}
	
</style>
<script type="application/javascript">
	integration_app_icon_url="https://d24wgzqqegxpap.cloudfront.net/api/images/jira/jira.png";
	clientAppRevokeMsg = '<p class="integrationAuthMsg"><span class="info-icon" title=""> &nbsp;</span><span>We are facing difficulty while accessing your JIRA account. Click <a href="#" class="jira-auth-link">here</a> to authorize.</span></p>';
	//clientTokenSetMsg = '<span class="close-btn"></span><label>Looks like, your admin did not configured application link in JIRA.</label>';
	//clientTokenSetMsg = '<span class="close-btn"></span><label style="color:red">Sorry, the JIRA admin has not completed Step 2 instructions. Please try again after its done.';
	clientTokenSetMsg = "<span class='close-btn'></span><label style='color:red'>Sorry, the JIRA admin has not completed Step 2 instructions. Please try again after it's done.";
	//clientTokenSetMsg = '<span class="close-btn"></span><label style="color:red">Oops! Your Spark administrator has denied access to this option.';
	accountExpireMsg = '<p class="accountExpireMsg"><span class="info-icon" title=""> &nbsp;</span><span>Looks like your JIRA account has been expired. Please activate your JIRA account and come back.</span></p>';
	//ciscoUsersPermissionMsg = '<span class="close-btn"></span><label style="color:red">Disabled for Cisco</label>';
	
	ciscoUsersPermissionMsgclk = '<span class="close-btn"></span><label style="color:red">Oops! Your Spark administrator has denied access to this option.</label>';
	var _scopeWarningMsg = '<span class="close-btn"></span><label>To enable this option, please disconnect and then connect again to this integration.</label>';
	application_id = "7";
	var instanceUuid ="";
	var webhookUrl = "";
	var issueTypesText;
	var issueSelectedText;
	var typeslength = 0;
	var room_id = "";
	var selectedAllEventsMatchFlag = true;
	var issueTypeMatchFlag = true;
	var issueStatusMatchFlag = false;
	var configFlag = false;
	var eventsFlag = false;
	var statusFlag = false;
	var statusJSON = "";
	var addElementsCount = 0;
	var issue_types_count = 0;
	var editStatusJson ={};
	var dynamicStatus = [];
	var allEventsArray = [];
	var allTypesArray = [];
	var configStatusJson = "";
	var divCount = 0;
	var allSelectedArray = ["sprint","board","user","project","all"];
	var otherEventSelectedValues = [];
	var allEventStatus = false;
	var checkedComments = [];
	var isSprintBoard = false;
	var saveJsonString = "";
	var selectedRoomName = "";
	var action_url = "";
	var actionType = "";
	onlyBot = false;
	appName = "JIRA Software";
	postMessageToSpark = appName+" "+postMessageToSpark;
	updateMessageToSpark= appName+" "+updateMessageToSpark;
	removeMessageToSpark= appName+" "+removeMessageToSpark;
	
	
	//------two way------
	var protocol = "https://";
	var domain = ".atlassian.net";
	var OAUTHURL = "";
	var basedomain = "";
	var selected_project_id = 0;
	var project_id_old = "0";
	var validateLink = false;
	var editAuthIssueTypes = "";
	var selected_room_id = "0";
	var privateRoom = false;
	var projectChanged = false;
	
	
	var pollingFalg = false;//
	var ajaxResult = {};//
	var ajaxFailFlag = false;//
	
	var bot_failure_msg = '<span class="close-btn"></span><label>The bot is already added to the space. Try @JIRA help in Cisco Spark app to see what the bot can do.</label>';
	var bot_success_msg = '<span class="close-btn"></span><label>The bot is now added to the space. Try @JIRA help in Cisco Spark app to see what the bot can do.</label>';
	
	var spark_admin_ins_msg = '<span class="close-btn"></span><label>Your personalized Admin Instructions have been sent to you in Cisco Spark.</label>';
	
	var roomsSelector = "<select name='room' id='rooms' class='custom-select'> <option value='0'>Please select a space</option> </select>";
	var displayNameBox = "<input type='text' name='displayName' id='displayName' class='integration-name'	value=''>";
	
	$( document ).ready(function() {
		save_spark_token_url="/api/clients/tokens";
		configuration_settings_url="/api/integrations/"+integration_id+"/uiSettings";
		save_configuration_settings_url="/api/integrations/instances";
		update_configuration_settings_url="/api/integrations/instances/";
		delete_instance_url="/api/integrations/instances/";
		list_integration_instances_url="/api/integrations/instances";		
		removeall_integration_instances_url="/api/integrations/instances";	
		delete_spark_token_url="/api/clients/tokens";
		get_app_token_url="/api/integrations/"+integration_id+"/appTokens";
		delete_integration_token_url="/api/integrations/"+integration_id+"/appTokens";
		getSparkSpaceDetails = "/api/integrations/"+integration_id+"/getSparkSpaceDetailsBySpaceId";
		token_url="/api/integrations/"+integration_id+"/authDetails";
		save_app_token_url="/api/integrations/"+integration_id+"/appTokens";
		action=action.toLowerCase();
		if(action=="connect") {
			formAction="connect";
			$("#integrations-block").hide();
			$("#integration-form").hide();
			connectIntegration();
			validateIntegrationAppToken();
			//------------------05/09/2017/---------
			if(oauthRequired ){ 
			validateClientAppSettings();
			}
			//---------------
		} else if(action=="disconnect") {
			formAction="disconnect";
			removeAllIntegrationInstances(formAction);
		} else {
			twowayFlag = true;
			var app_code =   gup(document.referrer, 'oauth_verifier');
			if(app_code!="") {
				generateIntegrationAppToken(app_code); 
			} else {
				validateIntegrationAppTokenDB();
			}
		}
		//$("#rooms").select2();
		$("#jira-icon").attr("src", integration_app_icon_url);
		$(".spark-icon").attr("src", spark_icon_url);
		$("#jira #submit-button").click(function (e){
			e.preventDefault();
			instance = "";
			onlyBot = false;
			$("#bot-alert").fadeOut("slow");
			saveJiraInstance();
		});
	
		//
		$("#jira #rooms").on('change',function(){
			if($('#rooms').val()!=0&&formAction=="update")
				$(".edit-roomconfig-info").hide();
		});
		$("#jira #cancel-button").click(function (e){
			e.preventDefault();
			$("#bot-alert").fadeOut("slow");
			if(!isClientAppTokenValid){
				$('.client-app-warning').show();
			}
			$('#integration-form').hide();
			$('#integrations-block').show();
			$('.config-notes').show();
			$(".jira-links").show();
			if(listResultData.length == 0) 
				listIntegrations();
			resize();
		});
		$("#displayName").keypress(function(e){
			if(e.which == 13)
			e.preventDefault();			
		});
		/*$('#jira #add-config').click(function(e){
			
		});*/
		$('#restricted-comments').change(function () {
			if ($(this).prop('checked')) {
				$('#newcomment').prop('checked', true);
			} 
		}); 
		$('#comment-edits').change(function () {
			if ($(this).prop('checked')) {
				$('#newcomment').prop('checked', true);
			} 
		});
		$('#newcomment').change(function () {
			if (!$(this).prop('checked')) {
				$('#comment-edits').prop('checked', false);
				$('#restricted-comments').prop('checked', false);
			}
		}); 
		
		$('#add_customtypes').on('click',function(){
			allTypesArray = [];
			allTypesArrayChecked = [];
			var x = $('input[name="issuetype"]:checked');
			
			for(var xx = 0; xx<x.length; xx++){
				console.log("allTypesArrayChecked!!!!!for!!!!!" + x[xx]);
				allTypesArrayChecked.push($(x[xx]).val());
			}
			
			$("#issuetypes option").each(function(){
				allTypesArray.push($(this).val());
			});
			var customtype = $("#customtype_field").val();
			if (~customtype.indexOf(":")) console.log("String contains ::: ")
			else console.log("String not contains ::: ")
			customtype = $('<div />').text(customtype).html();
			alert("custom type!!!" + customtype);
			allTypesArrayChecked.push(customtype);
			var count =0;
			var customTypecount = 0;
			if(customtype !="" && customtype!=null){
				var checkIssueType = customtype.replace(/\s/g, "");
				    checkIssueType = checkIssueType.toLowerCase();
				$.each(allTypesArray,function(index,value){
					if(value==checkIssueType ){
						count= count+1;
					}else allTypesArray.push(checkIssueType);
				});
				if(count==0){
					$("#issue-types-options").append($('<option>').attr('class','otherissuetypes').text(customtype).attr('value',checkIssueType).prop('selected', true));
					$('#issuetypes').multiselect('reload');
					$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('name', 'issuetype');
					$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('class', 'issuetype');
					$('.issuetypes div.ms-options > ul > li > ul > li input[value="All"]').attr('class', 'issuetypeall');
					$("#customtype_field").val('');
					if($('.issuetypeall').is(':checked')){
						$(".issuetype").prop('checked', true);
						$('.issuetypes div.ms-options-wrap > button').html("All");
					}
					typeslength = $('input[name="issuetype"]:checked').length;
					issue_types_count = $('input[class="issuetype"]').length;
					if(typeslength!=0){
						$(".config-info").show();
						$("#showConfig").show();
						$("#expand-close-config").removeClass("expandarrow");
						$("#expand-close-config").addClass("closearrow");
						$('.closearrow').attr('title','close');
						resize();
					} else {
						$(".config-info").hide();
						$("#showConfig").hide();
					}
				}else{
					alert("Please enter different issue type");
				}
				$('input[name="issuetype"]').prop("checked",false);
				x = $('input[name="issuetype"]');
				for(var i=0;i<x.length;i++){
					if(allTypesArrayChecked.indexOf($(x[i]).val())>=0){
						$(x[i]).prop("checked",true);
					}
				}
				allTypesArrayChecked = allTypesArrayChecked.join(",");
				
				if(allTypesArrayChecked.indexOf("All")>=0)
				$('.issuetypes div.ms-options-wrap > button').html("All");
				else
				$('.issuetypes div.ms-options-wrap > button').html(allTypesArrayChecked);
			}else{
				alert("Please give your custom issue type");
			}
		});
		$('#add-other-events').on('click',function(){
			var otherEventName = $("#other-event-name").val();
				otherEventName = $('<div />').text(otherEventName).html();
			var otherEventValue = otherEventName.replace(/\s/g, "");
				otherEventValue = otherEventValue.toLowerCase();
			var count =0;
			allEventsArray = [];
			$("input[name=events]").each( function () {
			   allEventsArray.push($(this).val());
			});
			var length = $('#other_notifications div').last().parent().children().length;
			if(otherEventName =="" || otherEventName==null){
				alert("Please enter the name of the custom field for which you would like to receive notifications.");
			} else{
				$.each(allEventsArray,function(index,value){
					if(value==otherEventValue){
						count= count+1;
					}
				});
				if(count==0){
					if(length==1){
					$('#other_notifications div').last().parent().append('<div class="large-3 medium-4 columns checkbox"><input name="events" id="'+otherEventValue+'" value="'+otherEventValue+'" type="checkbox" class="otherevent-custom-disable"><label for="'+otherEventValue+'">'+otherEventName+'</label></div>');
					$("input[type=checkbox][value='"+otherEventValue+"'][name=events]").prop("checked",true);
					}else{
						$('#other_notifications').append('<div class="large-12 medium-12 columns custom-event-remove"><div class="large-3 medium-4 columns checkbox"><input name="events" id="'+otherEventValue+'" value="'+otherEventValue+'" type="checkbox" class="otherevent-custom-disable"><label for="'+otherEventValue+'">'+otherEventName+'</label></div></div>');
						$("input[type=checkbox][value='"+otherEventValue+"'][name=events]").prop("checked",true);
					}
					$("#other-event-name").val("");
				}else{
					alert("Please enter different other event name.");
				}
			}
			resize();
		});
		$('#add_status').click(function(e){
			e.preventDefault();
			dynamicStatus=[];
			calculateDivIds();
			insertAtIndex($("#notificationList > div").length);
			resize();
		});
		$("#issuetypes").val('');
		$("#issuetypes").on("change",function() {
		    getIssueTypesText();
		});
		$("#auth-issuetypes").val('');
		$("#auth-issuetypes").on("change",function() {
		    getIssueTypesText();
		});
		$("#expand-close").addClass("closearrow");
		$('#expand-close').click(function(e){
			e.preventDefault();
			if($(this).attr('class')=='closearrow'){
				$('#showSetup').hide();
				$('#showSetup1').hide();
				 $(this).removeClass("closearrow");
				 $(this).addClass("expandarrow");
				 $('.expandarrow').attr('title','expand');
			}else{
				$(this).addClass("closearrow");
				$(this).removeClass("expandarrow");
				$('.closearrow').attr('title','close');
				$('#showSetup').show();
				$('#showSetup1').show();
			}
			resize();
		});
		$("#expand-close-config").addClass("closearrow");
		$('#expand-close-config').click(function(e){
			e.preventDefault();
			if($(this).attr('class')=='closearrow'){
				$('#showConfig').hide();
				 $(this).removeClass("closearrow");
				 $(this).addClass("expandarrow");
				 $('.expandarrow').attr('title','expand');
			}else{
				$(this).addClass("closearrow");
				$(this).removeClass("expandarrow");
				$('.closearrow').attr('title','close');
				$('#showConfig').show();
			}
			resize();
		});
		$(".closearrow").mouseover(function(){
			$('.closearrow').attr('title','close');
		});
		$('#issuetypes').multiselect({
			columns: 1,
			placeholder: 'Select Types',
			search: false,
			selectAll: false
		});
		
		$.fn.serializeObject1 = function(){
			        var self = this,json = {},push_counters = {},patterns = {
			                "validate": /^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,
			                "key":      /[a-zA-Z0-9_]+|(?=\[\])/g,
			                "push":     /^$/,
			                "fixed":    /^\d+$/,
			                "named":    /^[a-zA-Z0-9_]+$/
			            };
			        this.build = function(base, key, value){base[key] = value;return base;};
			        this.push_counter = function(key){if(push_counters[key] === undefined){push_counters[key] = 0;}return push_counters[key]++;};
			        $.each($(this).serializeArray(), function(){
			        	if(!patterns.validate.test(this.name)){ return; }
			            var k,
			                keys = this.name.match(patterns.key),
			                merge = this.value,
			                reverse_key = this.name;
			            while((k = keys.pop()) !== undefined){
			                reverse_key = reverse_key.replace(new RegExp("\\[" + k + "\\]$"), '');
			                if(k.match(patterns.push)){merge = self.build([], self.push_counter(reverse_key), merge);}
			                else if(k.match(patterns.fixed)){merge = self.build([], k, merge);}
			                else if(k.match(patterns.named)){merge = self.build({}, k, merge);}
			            }	json = $.extend(true, json, merge);
			        });	        return json;
			    }; 
		$(document).on("click", ".same-config-yes" , function(e) {			
			saveJiraInstanceConfig();
		});
		$(document).on("click", ".same-config-no" , function(e) {
			$('#same-configuration').foundation('close');
		});
		$(document).on("click", "#jira #instance-list-block .edit-config, #jira #unauth-instance-list-block .edit-config" , function() {
		    $('.cisco_users_permission_errorclk').hide();
			$('#select2-rooms-container').html('Please select a space');
			$(".spark_scope_alert").css("display","none");
			var statusJSONAuth = '{"statuses": []}';
			var typeVal = JSON.parse(statusJSONAuth);
			fillNotificationList(changeToArray(typeVal.statuses));
			$(".client-app-warning").hide();
		
			privateRoom = false;
			projectChanged = false;
		//-----------------------------------------------------
			$(".config-notes").hide();
			$(".jira-links").hide();
		//-----------------------------------------------------
			var issueStatusArray = [];
			var issueTypesArray = [];
			allEventsArray = [];
			var typesArray = [];
			var otherEventsArray = [];
			var issueSelectedText = "";
			var issueTypeText = "";	
			$('.custom-event-remove').remove();
			$('.otherissuetypes').remove();
			$('#issuetypes').multiselect('reload');
		 	$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('name', 'issuetype');
		    $('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('class', 'issuetype');
		    $('.issuetypes div.ms-options > ul > li > ul > li input[value="All"]').attr('class', 'issuetypeall');
			$('.otherevent-disable').prop("disabled",false);
			$('.otherevent-custom-disable').prop("disabled",false);
			$('.otherevent-disable').prop("checked",false);
			$('.otherevent-custom-disable').prop("checked",false);
			formAction="update";
			$("#expand-close").removeClass("closearrow");
			$("#expand-close").addClass("expandarrow");
			$('.expandarrow').attr('title','expand');
			$("#showSetup").hide();
			$("#showSetup1").hide();
			$("#expand-close-config").removeClass("closearrow");
			$("#expand-close-config").addClass("expandarrow");
			$(".config-label").html("");
			$(".config-label").html("For preview only. These admin instructions, if already executed, need NOT be changed for any further edits made above to the Spark space or notification selections.");
			$('.expandarrow').attr('title','expand');
			$(".config-info").show();
			$("#showConfig").hide();			
			//$("#config-label").html('Steps you had executed to add this configuration. View for reference, if needed. Otherwise, steps need not be executed again.');
		//	$("#config-label").html().replace("<p>For preview only. These admin instructions, if already executed, need NOT be changed for any further edits made above to the Spark space or notification selections.</p>");
			console.log("---coonfig-lable----");
			room_modified=false;
			//$("#submit-button").text("Save");
			instanceId=this.id;
			$("input[name=events]").each( function () {
			   allEventsArray.push($(this).val());
			});
			$.each(listResultData,function(index,value){
				if(value["instanceId"]==instanceId) {
					instanceData=value;
				}
			});
			selected_room_id=instanceData.channelId;
			room_id_old = instanceData.channelId;
			var config=JSON.parse(instanceData.configJson);
			editUnAuthMode = config.unauthmode;
			var notifications=config.notifications;
			console.log("editUnAuthMode!!!!" + editUnAuthMode);
			if(editUnAuthMode!=undefined&&!editUnAuthMode){
				console.log("auth editUnAuthMode!!!!" + editUnAuthMode);
				editAuthIssueTypes = "";
				$('.editUnAuthMode').hide();
				$('.authissuetypesblock').hide();
				twowayFlag = true;
				project_id_old = config.projectId;
				selected_project_id = config.projectId;
				privateRoom = config.isPrivate;
				editAuthIssueTypes = notifications.isuuesType;
			}else if(editUnAuthMode==undefined || editUnAuthMode){
				console.log("in editUnAuthMode!!!!" + editUnAuthMode);
				twowayFlag = false;
				var issuetype = notifications.isuuesType;
				var yesflag = true;
				if ($.isArray(issuetype)) {
					var ty = $(".issuetype");
					for(var i = 0; i<ty.length; i++){
						if(issuetype.indexOf($(ty[i]).val())>=0){
							issueTypesArray.push($(ty[i]).val());
						}
					}
					if(issuetype.indexOf("All")>=0 || issuetype.indexOf("all")>=0){
						issueTypesArray.push($(".issuetypeall").val());
					}
					var sampleIssueTypeArray = [];
					for(var i = 0; i<issuetype.length; i++){
						if(issueTypesArray.indexOf(issuetype[i])<0){
							typesArray.push(issuetype[i])
						}
						sampleIssueTypeArray.push(issuetype[i])
					}
					issueTypesArray = sampleIssueTypeArray;
				} else {
					issueTypesArray.push(issuetype);
					if(issuetype.toLowerCase()=="all"){
						$("input[type=checkbox][class=issuetypeall]").attr("checked", true);
						$(".issuetype").attr('checked',true);
						yesflag = false;
					}else{
						var ty = $(".issuetype");
						var otherIssueFlag = false;
						for(var i = 0; i<ty.length; i++){
							if(issuetype==$(ty[i]).val()){
								otherIssueFlag = true;
							}
						}
						if(!otherIssueFlag){
							typesArray.push(issuetype)
						}
					}
				}
				if ($.isArray(typesArray)) {
					$.each(typesArray, function(index, value) {
						var checkIssueType = value.replace(/\s/g, "");
						checkIssueType = checkIssueType.toLowerCase();
						$("#issue-types-options").append($('<option>').attr('class','otherissuetypes').text(value).attr('value',checkIssueType).prop('selected', true));
						$('#issuetypes').multiselect('reload');
						$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('name', 'issuetype');
						$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('class', 'issuetype');
						$('.issuetypes div.ms-options > ul > li > ul > li input[value="All"]').attr('class', 'issuetypeall');
					});
				}else{
						var checkIssueType = typesArray.replace(/\s/g, "");
						checkIssueType = checkIssueType.toLowerCase();
					  $("#issue-types-options").append($('<option otherissuetypes>').attr('class','otherissuetypes').text(typesArray).attr('value',checkIssueType).prop('selected', true));
						$('#issuetypes').multiselect('reload');
						$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('name', 'issuetype');
						$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('class', 'issuetype');
						$('.issuetypes div.ms-options > ul > li > ul > li input[value="All"]').attr('class', 'issuetypeall');
				}
				
				if(yesflag){
					yesflag = false;
					var ty = $(".issuetype");
					console.log("ty ::: "+ty+" ty.length "+ty.length);
					for(var i = 0; i<ty.length; i++){
						if(issuetype.indexOf($(ty[i]).val())>=0){
							$("input[type=checkbox][class=issuetype][value='"+$(ty[i]).val()+"']").attr("checked", true);
						}
					}
				}
				
				issueTypeText = issueTypesArray.join(',');
				$('.issuetypes div.ms-options-wrap > button').html(issueTypeText);
			}
			editStatusJson["statuses"] = notifications.issuesStatus;
			configStatusJson = notifications.issuesStatus;
			loadJiraForm();
			$("#webhookURL").val(config.webhookurl);
			config.displayName = $('<div />').text(config.displayName).html();
			$('#displayName').val(config.displayName);
			$('#instanceid').val(instanceId);
			instanceUuid = instanceData.instanceUuid;
			var comments = notifications.comments;
			
			if(notifications.hasOwnProperty("comments")){
				if($.isArray(comments)) {
					if(comments.indexOf("All")>=0 || comments.indexOf("all")>=0){
						$('.otherevent-disable').prop("checked",true);
						$('.otherevent-custom-disable').prop("checked",true);
					}
					
					var eventsArrayCheckedTemp = $("input[type=checkbox][name=events]");
					var eventsArrayChecked = [];
					for(var i=0;i<eventsArrayCheckedTemp.length;i++)
						eventsArrayChecked.push($(eventsArrayCheckedTemp[i]).val());
					
					
					for(var i=0;i<comments.length;i++){
						otherEventSelectedValues.push(comments[i]);
						$("input[type=checkbox][value='"+comments[i]+"'][name=events]").prop("checked",true);
						if(eventsArrayChecked.indexOf(comments[i])<0){
							if(comments[i]!="user"&&comments[i]!="project")
								otherEventsArray.push(comments[i]);
						}
					}
				} else {
					if(comments=="all" || comments=="All"){
						$("input[type=checkbox][value='"+comments+"'][name=events]").prop("checked",true);
						$('.otherevent-disable').prop("checked",true);
						$('.otherevent-custom-disable').prop("checked",true);
						otherEventSelectedValues.push(comments);
					}
				}	
			}
			if ($.isArray(otherEventsArray)) {
				$.each(otherEventsArray, function(index, value) {
					var otherEventValue = value.replace(/\s/g, "");
						otherEventValue = otherEventValue.toLowerCase();
					var length = $('#other_notifications div').last().parent().children().length;
						if(length==1){
							$('#other_notifications div').last().parent().append('<div class="large-3 medium-4 columns checkbox"><input name="events" id="'+otherEventValue+'" value="'+otherEventValue+'" type="checkbox" class="otherevent-custom-disable"><label for="'+otherEventValue+'">'+value+'</label></div>');
							$("input[type=checkbox][value='"+otherEventValue+"'][name=events]").prop("checked",true);
						}else{
							$('#other_notifications').append('<div class="large-12 medium-12 columns custom-event-remove"><div class="large-3 medium-4 columns checkbox"><input name="events" id="'+otherEventValue+'" value="'+otherEventValue+'" type="checkbox" class="otherevent-custom-disable"><label for="'+otherEventValue+'">'+value+'</label></div></div>');
							$("input[type=checkbox][value='"+otherEventValue+"'][name=events]").prop("checked",true);
						}
				});
			}else{
				var length = $('#other_notifications div').last().parent().children().length;
				var otherEventValue = otherEventsArray.replace(/\s/g, "");
					otherEventValue = otherEventValue.toLowerCase();
					if(length==1){
						$('#other_notifications div').last().parent().append('<div class="large-3 medium-4 columns checkbox"><input name="events" id="'+otherEventValue+'" value="'+otherEventValue+'" type="checkbox" class="otherevent-custom-disable"><label for="'+otherEventValue+'">'+otherEventsArray+'</label></div>');
						$("input[type=checkbox][value='"+otherEventValue+"'][name=events]").prop("checked",true);
					}else{
						$('#other_notifications').append('<div class="large-12 medium-12 columns custom-event-remove"><div class="large-3 medium-4 columns checkbox"><input name="events" id="'+otherEventValue+'" value="'+otherEventValue+'" type="checkbox" class="otherevent-custom-disable"><label for="'+otherEventValue+'">'+otherEventsArray+'</label></div></div>');
						$("input[type=checkbox][value='"+otherEventValue+"'][name=events]").prop("checked",true);
					}
			}
			
			//$("#submit-button").html("Save");
			
			resize();
		});
		
		
		$('input[type="checkbox"][value="all"]').click(function(){
            if($('input[type="checkbox"][value="all"]').is(':checked')){
				$('input[type="checkbox"][class="otherevent-disable"]').prop("checked",true);
				$('input[type="checkbox"][class="otherevent-custom-disable"]').prop("checked",true);
			}else{
				$('input[type="checkbox"][class="otherevent-disable"]').prop("checked",false);
				$('input[type="checkbox"][class="otherevent-custom-disable"]').prop("checked",false);
			}
		});
		
		$('input[type="checkbox"][class="otherevent-disable"]').click(function(){
            $('input[type="checkbox"][value="all"]').prop("checked",false);
		});
		
		$(document).on('click','input[type="checkbox"][class="otherevent-custom-disable"]',function(){
            $('input[type="checkbox"][value="all"]').prop("checked",false);
		});
		
		//-----------------------------------------------------------------------------------------------------------------------------
		$("#bot-submit-button").click(function(e){
			e.preventDefault();
			$(".close-btn").trigger("click");
			onlyBot = true;
			if($("#rooms option:selected").val()== 0 || $("#rooms option:selected").val() =="0"){
				alert("Please select a space.");
			}else{
				saveJiraInstance();
			}
		});
		$(document).on('click','.close-btn',function(){
			$("#bot-alert").fadeOut("slow");
			$(".application_link_configured_error").fadeOut("slow");
			$(".cisco_users_permission_errorclk").fadeOut("slow");
			$("#spark_admin").fadeOut("slow");
			
			resize();
		});
		
		$("#collapse").click(function(){
			console.log("in collapse btn click!!!");
			collapseAuthInstructions();
		});
		$("#intruction-expand-close-config").addClass("closearrow");
		$("#intruction-expand-close-config-user").addClass("closearrow");
		$('#intruction-expand-close-config').click(function(e){
			e.preventDefault();
			resize();
			if($(this).attr('class')=='closearrow'){
				 $("#showSetup").hide();
				 $(this).removeClass("closearrow");
				 $(this).addClass("expandarrow");
				 $('.expandarrow').attr('title','expand');
			}else{
				$(this).addClass("closearrow");
				$(this).removeClass("expandarrow");
				$('.closearrow').attr('title','close');
				$("#showSetup").show();
			}
			resize();
		});
		
		$('#intruction-expand-close-config-user').click(function(e){
			e.preventDefault();
			if($(this).attr('class')=='closearrow'){
				 $("#showSetup1").hide();
				 $(this).removeClass("closearrow");
				 $(this).addClass("expandarrow");
				 $('.expandarrow').attr('title','expand');
			}else{
				$(this).addClass("closearrow");
				$(this).removeClass("expandarrow");
				$('.closearrow').attr('title','close');
				$("#showSetup1").show();
			}
			resize();
		});
		$(document).on('click','.close-btn',function(){
			$(".spark_scope_alert").fadeOut("slow");
		});
		
		$(".jira-unauth-link").click(function(){
		    $('.cisco_users_permission_errorclk').hide();
		    $('.account-expire-warning').hide();
			$(".spark_scope_alert").css("display","none");
			var statusJSONAuth = '{"statuses": []}';
			$(".client-app-warning").hide();
			var typeVal = JSON.parse(statusJSONAuth);
			fillNotificationList(changeToArray(typeVal.statuses));
			formAction="add";
			twowayFlag = false;
			$("#rooms").find("option").remove();//
			loadForm();
			loadJiraForm();
			resize();
		});
		
		
		
		$('#projects').change(function () {
			$("input[class='authissuetypeall']").prop("checked",false);
			$("input[class='authissuetype']").prop("checked",false);
			projectChanged = true;
			$(".authissuetypesblock").hide();
			$('.auth-issuetypes .ms-options-wrap > button').html("Select Types");
			var proj = $('#projects').val();
			if(proj!=0 && proj!=""){
				var jsons = {};
				jsons['userId'] = user_id;
				jsons['integrationId'] = integration_id;
				jsons['projectId'] = proj;
				getIssueTypes(jsons);
			}else{
				$("input[class='authissuetypeall']").prop("checked",false);
				$("input[class='authissuetype']").prop("checked",false);
			}
		});
		
		//---------------------------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------------------------
		//-----------------------------------------------------------------------------------------------------------
		
		/*
			Onclick Auth Link
		*/
		$(document).on("click", ".jira-auth-link", function(){
			$('#select2-rooms-container').html('Please select a space');
			$(".client-app-warning").hide();
			checkValidSparkScopes();
			console.log("ddddddd"+_isValidSparkScope);
			if(_isValidSparkScope){
				var statusJSONAuth = '{"statuses": []}';
				var typeVal = JSON.parse(statusJSONAuth);
				fillNotificationList(changeToArray(typeVal.statuses));
				isPrivate = false;
				formAction="add";
				$(".authissuetypesblock").hide();
				twowayFlag = true;
				oauthRequired=true;
				validateLink=true;
				$(".config-notes").hide();
				$(".jira-links").hide();
				
				if(isClientAppTokenValid && appTokenExists){
				//if(isClientAppTokenValid){
					loadForm();
					loadJiraForm();
				}else{
					$('.client-app-warning').hide();
					$('#integrations-block').hide();
					$("#form1").show();	
				}
			
			}else{
				$('.spark_scope_alert').html(_scopeWarningMsg);
				$('.spark_scope_alert').css("display","block");
			}
			
			
			
		});
		
		
		/*
			Validates Jira Base Url
		*/
		$('#get-authentication').click(function(e){
		   e.preventDefault();
		   if($('#jirasubdomain').val()!="") {
				basedomain = protocol+$('#jirasubdomain').val()+domain;
				validateJiraUrl();
		   }else{
				alert("Please enter your JIRA Base URL");
		   }
		});
		
		/*
			Get JIRA Authorization URL
		*/
		$("#authenticate-btn").click(function(){
			var requestBody = {};
			requestBody['integrationId'] = integration_id;
			requestBody['userId'] = user_id;
			var authSettings = {};
			authSettings['url'] = basedomain;
			authSettings['istoken'] = true;
			requestBody['authSettings'] = authSettings;
			
			postAjaxCall(token_url, requestBody);
			pollingFalg = false;
			ajaxFailFlag = false;
			ajaxResult = {};
			
			$('.application_link_configured_error').hide();
			var polling = setInterval(function(){
				if(pollingFalg){
					clearInterval(polling);
					if(ajaxResult['integrationSpecificAuthDetails']!=undefined){
						if(ajaxResult['integrationSpecificAuthDetails']['isAppliationlink']!=undefined && !ajaxResult['integrationSpecificAuthDetails']['isAppliationlink']){
							//alert("Looks like, your admin did not configured application link in JIRA");
							$('.application_link_configured_error').html(clientTokenSetMsg);
							$('.application_link_configured_error').show();
							resize();
					}else{
							OAUTHURL = JSON.parse(ajaxResult['integrationSpecificAuthDetails']['RequestData'])['requestUrl'];
							loginWithAuthDetails(OAUTHURL);
						}
					}
				}else if(ajaxFailFlag)
					clearInterval(polling);
			}, 200);
		});
		/*$(document).on('click', '.ciscousrhide', function(){
		//$('.ciscousrhide').click(function(){
		     console.log("in add button click!!!");
		     if($('.ciscousrhide').is(':disabled')){
			   console.log("disabled!!!");
			 }else{
			   console.log("not disabled");
			 }
		});*/
		$(document).on("click", ".ciscousr-auth-link-block", function(){

		     console.log("in add button click!!!");
		     if($('.ciscousrhide').is(':disabled')){
				$(".secondary.button").css("opacity", "1");
			   $(".secondary.button").css("background", "#049fd9;");
			   $(".secondary.button").css("color", "white;");
			   $('.cisco_users_permission_errorclk').html(ciscoUsersPermissionMsgclk);
			   $('.cisco_users_permission_errorclk').show();
			   resize();
			   console.log("disabled!!!");
			 }else{
			   $('.cisco_users_permission_errorclk').hide();
			   console.log("not disabled");
			 }
		});
		
		$(document).on('click', '.send_instructions', function(){
			console.log("Sending Admin instructions to Cisco Spark ");
			$("#spark_admin").fadeOut("fast");
			var pdfReqPayload = {};
			pdfReqPayload["isFile"] = true;
			pdfReqPayload["userId"] = user_id;
			pdfReqPayload["integrationId"] = integration_id;
			$('.file_sending_loading').show();		
			$.ajax({
				url: configuration_settings_url,
				async: true,
				type:'POST',
				data: JSON.stringify(pdfReqPayload),
				headers: { 'userId': user_id },
				contentType: "application/json",
				dataType: "json",
				success: function(result, textStatus, request){
						if(request.getResponseHeader('x-csrf-jwt') != null){
							csrfJwt = request.getResponseHeader('x-csrf-jwt');
						}
						if(result["postSpecificIntegrationSettings"]["fileStatus"] != undefined && result["postSpecificIntegrationSettings"]["fileStatus"]==200){
							$('.file_sending_loading').hide();	
							$("#spark_admin").html(spark_admin_ins_msg);
						//	$("#spark_admin").show();
							$("#spark_admin").fadeIn();
							console.log("Result :11 "+JSON.stringify(result));
						}
						console.log("Result : "+JSON.stringify(result));
					},
				error: function(xmlHttpRequest,error) {
				   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					   return;
				   }else{
					   $('.file_sending_loading').hide();	
					   alert("We've experienced some difficulty. Try again.");
				   }
				}	
			});
		})
		
	}); 
	
	
	/*
		Check Integration exist or not
	*/
	function validateIntegrationAppToken() {
	
		pollingFalg = false;
		ajaxFailFlag = false;
		ajaxResult = {};
		getAjaxCall(get_app_token_url+"?userId="+user_id);
		
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				if(ajaxResult.tokenResult.tokenId) {
					validateIntegrationAppspecificToken();
				} else {
					isClientAppTokenValid = false;
					$(".config-notes").show();
					$(".jira-links").show();
					$("#form1").hide();
				}
				resize();
			}else if(ajaxFailFlag)
				clearInterval(polling);
		}, 200);
	}
	
	/*
		Ajax Call to validate Jira Base Url
	*/
	function validateJiraUrl() {
		var requestBody = {};
		requestBody['integrationId'] = integration_id;
		requestBody['userId'] = user_id;
		var authSettings = {};
		authSettings['url'] = basedomain;
		authSettings['istoken'] = false;
		requestBody['authSettings'] = authSettings;
		
		postAjaxCall(token_url, requestBody);
		pollingFalg = false;
		ajaxFailFlag = false;
		ajaxResult = {};
		
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				if(ajaxResult['integrationSpecificAuthDetails']['status']==200){
					var UUID = "";
					$('#sharedSecret').val("");
					var UUID = generateUUID();
					$('#sharedSecret').val(UUID);
					$('.jira-setup-instructions').show();
					collapseAuthInstructions();
					$('.jira-authform-btn').show();
					resize();
				}else if(ajaxResult['integrationSpecificAuthDetails']['status']==502 || ajaxResult['integrationSpecificAuthDetails']['status']==503){
					alert("Please enter your valid JIRA Base URL");
				}
			}else if(ajaxFailFlag)
				clearInterval(polling);
		}, 200);
	}
	
	/*
		Collapse all auth instructions
	*/
	function collapseAuthInstructions(){
		 $("#showSetup").hide();
		 $("#showSetup1").hide();
		 $("#intruction-expand-close-config").removeClass("closearrow");
		 $("#intruction-expand-close-config").addClass("expandarrow");
		 
		 $("#intruction-expand-close-config-user").removeClass("closearrow");
		 $("#intruction-expand-close-config-user").addClass("expandarrow");
		 
		 $('.expandarrow').attr('title','expand');
		 resize();
	}
	
	
	/*
		Redirect to JIRA login Page
	*/
	function loginWithAuthDetails(oauthURL) {
		isRedirect=true;
		if(isRedirect) {
			window.top.location.href = oauthURL;
		} else {
			var win = window.open(oauthURL, "windowname1", 'width=600, height=600'); 
			if(win){ 
			}else{
				alert(popblockedMessage); 
				return false;
			}
			var pollTimer = window.setInterval(function() { 
				try {
					if (win.document.URL.indexOf("code") != -1) {
						window.clearInterval(pollTimer);
						var url =   win.document.URL;
						accessCode =   gup(url, 'code');
						win.close();
						getIntegrationAppTokenDetails(accessCode);
					}
				} catch(e) {
					console.log('error while getting authorization code..'+e);
				}
			}, 100);
		}
    }
	
	/*
		Gets Access token from url and send to muleflow
	*/
	function getIntegrationAppTokenDetails(code) {
		var requestBody={};
		requestBody["integrationId"] = integration_id;
		requestBody["userId"] = user_id;
		requestBody["authSettings"] = {};
		requestBody["authSettings"]["code"] = code;
		
		postAjaxCall(token_url, requestBody);
		pollingFalg = false;
		ajaxFailFlag = false;
		ajaxResult = {};
		
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				var tokenDetails=ajaxResult["integrationSpecificAuthDetails"];
				var requestBody={};
				requestBody["applicationId"] = application_id;
				requestBody["integrationId"] = integration_id;
				appTokenExists = true;
				requestBody["accessToken"] = tokenDetails.AccessToken;
				var tokenExpireTime="";
				requestBody["expires"] ="3600";
				requestBody["refreshToken"] = "";
				requestBody["subDomain"] = tokenDetails.domainUrl;
				saveIntegrationAppToken(requestBody);
			}else if(ajaxFailFlag)
				clearInterval(polling);
		}, 200);
	}
	
	/*
		Save app token to DB
	*/
	function saveIntegrationAppToken(requestBody){
		saveIntegrationTokenResponse = "failure";
		
		postAjaxCall(save_app_token_url+"?userId="+user_id, requestBody);
		pollingFalg = false;
		ajaxFailFlag = false;
		ajaxResult = {};
		
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				saveIntegrationTokenResponse="success";
				connectIntegration();
				if(isClientAppTokenValid == false){
					isClientAppTokenValid = true;
					getListInstances();
				}else {
					loadJiraForm();
				}
			}else if(ajaxFailFlag)
				clearInterval(polling);
		}, 200);
	}
	
	/*
		Get Instance list
	*/
	function getListInstances(){
		appTokenExists = true;
		
		pollingFalg = false;
		ajaxResult = {};
		ajaxFailFlag = false;
		var ajaxUrl = list_integration_instances_url+"?userId="+user_id+"&integrationId="+integration_id;
		getAjaxCall(ajaxUrl);
		
		
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				instanceList = ajaxResult;
				if(instanceList.length != 0){
					if(!isClientAppTokenValid){
						$('.client-app-warning').html(clientAppRevokeMsg);
					}
					listIntegrations();
				}else{
					loadJiraForm();
				}
			}else if(ajaxFailFlag)
				clearInterval(polling);
		}, 200);
	}
	
	/*
		Set Status Object
	*/
	function  fillNotificationList(list){
		$("#notificationList").html('<div></div>');
		$.each(list, function(index, obj){
			var insertPosition = $("#notificationList > div").length;
			count=insertPosition-1;
			$("#notificationList > div:nth-child(" + (insertPosition) + ")").after('<div class="large-10 medium-12 columns staticCount" id="field_'+count+'" style="margin-bottom: 10px"><div class="large-5 medium-4 columns left status-fields"><input type="text" id="from_'+count+'" value="'+obj.from+'" name="notifications['+count+'][from]"></input></div><span class="towards-arrow" title="To">&nbsp;</span><div class="large-5 medium-4 columns left status-fields">	<input type="text" id="to_'+count+'" value="'+obj.to+'" name="notifications['+count+'][to]"></input></div><span class="remove-status" onclick="javascript:removeField('+count+');return false;" title="Remove">&nbsp;</span></div>');
		});
	 }
	 
	
	/*
		Load Jira form
	*/
	 
	 function loadJiraForm(){
		var settingsUrl;
		$(".edit-projectconfig-info").hide();
		loadConfigBlock();
		$("#form").trigger("reset");
		$('#integrations-block').hide();
		$("#integration-form").show();
		$(".edit-roomconfig-info").hide();
		$(".rooms-loading").show();
		if(twowayFlag){
			$(".jira-authform").show();
			$(".jira-unauthform").hide();
			//$("#submit-button").html("Add Configuration");
			settingsUrl = configuration_settings_url+"?userId="+user_id+"&isBot=true";
		}else{
			$(".jira-unauthform").show();
			$(".jira-authform").hide();
			//$("#submit-button").html("Add Integration");
			settingsUrl = configuration_settings_url+"?userId="+user_id;
		}
		resize();
		
		pollingFalg = false;
		ajaxResult = {};
		ajaxFailFlag = false;
		
		getAjaxCall(settingsUrl);
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				ui_settings = ajaxResult;
				loadConfigurationSettings();
			}else if(ajaxFailFlag){
				$('#integration-form').html("We've experienced some difficulty. Try again.");
				$('#integration-form').hide();
				clearInterval(polling);
			}
		}, 200);
		if(!twowayFlag){
			getAllSparkRooms();
			loadRooms();
		}
    }
	
	/*
		Get Issue Types for selected project
	*/
	function getIssueTypes(jsons){
		$('.jira-loading').show();
		
		pollingFalg = false;
		ajaxResult = {};
		ajaxFailFlag = false;
		var ajaxUrl = configuration_settings_url+"?userId="+user_id+"&isBot=true";
		
		postAjaxCall(ajaxUrl, jsons);
		
		var polling = setInterval(function(){
			if(pollingFalg){
				clearInterval(polling);
				result = ajaxResult;
				var issuesTypes = result['postSpecificIntegrationSettings']['projectData']['issueTypes'];
				$('.jira-loading').hide();
				if(issuesTypes.length>0){
					$.each(issuesTypes, function(id,obj){
						$("#auth-issuetypes").append($('<option>').text(obj.name).attr('value',obj.name));
					});
					$('#auth-issuetypes').multiselect({
						columns: 1,
						placeholder: 'Select Types',
						search: false,
						selectAll: false
					});
					$('.auth-issuetypes div.ms-options > ul > li').find(':checkbox').attr('name', 'authissuetype');
					$('.auth-issuetypes div.ms-options > ul > li').find(':checkbox').attr('class', 'authissuetype');
					$('.auth-issuetypes div.ms-options > ul > li input[value="All"]').attr('class', 'authissuetypeall');
					$(".authissuetypesblock").show();
					$("input[class='authissuetypeall']").prop("checked",false);
					$("input[class='authissuetype']").prop("checked",false);
			
					if(formAction=="update" && !projectChanged){
						var issueTypesArray = [];
						var typesArray = [];
						var issueTypeText = "";
						if ($.isArray(editAuthIssueTypes)) {
							$.each(editAuthIssueTypes, function(index, value) {
								issueTypesArray.push(value);
								$("input[type=checkbox][value='"+ value + "']").prop("checked", true);
							});
						} else {
							issueTypesArray.push(editAuthIssueTypes);
							if(editAuthIssueTypes=="All"){
								$("input[type=checkbox][value='"+ editAuthIssueTypes+ "']").prop("checked", true);
								$(".authissuetype").prop('checked',true);
							}else{
								$("input[type=checkbox][value='"+ editAuthIssueTypes + "']").prop("checked", true);
							}
						}
						issueTypeText = issueTypesArray.join(',');
						$('.auth-issuetypes div.ms-options-wrap > button').html(issueTypeText);
					}
					if(result['postSpecificIntegrationSettings']['statuses'] != undefined && projectChanged){
						var statusJSONByProject = result['postSpecificIntegrationSettings']['statuses'];
						var statusJSONByissue = [];
						for(var i=0;i<statusJSONByProject.length;i++){
							var tempSatus = statusJSONByProject[i]['statuses'];
							for(var j=0;j<tempSatus.length;j++){
								if(statusJSONByissue.indexOf(tempSatus[j]['name'])<0){
									statusJSONByissue.push(tempSatus[j]['name']);
								}
							}
						}
						
						statusJSONAuth = '{"statuses": [';
						for(var i=0;i<statusJSONByissue.length;i++)
							statusJSONAuth+='{"from": "*","to": "'+statusJSONByissue[i]+'"},';
						
						statusJSONAuth = statusJSONAuth.substring(0,statusJSONAuth.lastIndexOf(","));
						statusJSONAuth +=']}';
						var typeVal = JSON.parse(statusJSONAuth);
						fillNotificationList(changeToArray(typeVal.statuses));
					}resize();
				}else{
					$(".authissuetypesblock").hide();
				}
			}else if(ajaxFailFlag){
				clearInterval(polling);
			}
			
		}, 200);
		
			
	}
	
	/*
		Loads JIRA configuration
	*/
	function loadConfigurationSettings() {
		if(ui_settings["sparkRoomSettings"]!=undefined && ui_settings["integrationSpecificSettings"]!=undefined){
			var projectFlag=false;
			$("#projects").html("");
			if(twowayFlag){
				$(".twoway_text").show();
				$(".oneway_text").hide();
				var projectList = ui_settings["integrationSpecificSettings"]["webhookDetails"]['projectData'];
				$("#projects").append($('<option>').text("Select").attr('value',"0"));
				$.each(projectList, function(id,obj){
					$("#projects").append($('<option>').text(obj.name).attr('value',obj.id));
					if(formAction=="update" && selected_project_id==obj.id && projectFlag==false)
						projectFlag = true;
				});
				
				if(formAction=="update" && projectFlag==false){
					selected_project_id = "0";
					$(".edit-projectconfig-info").show();
				}
				
				$("#projects").val(selected_project_id);
				
				if(formAction=="update"&&projectFlag){
					var jsons = {};
					jsons['userId'] = user_id;
					jsons['integrationId'] = integration_id;
					jsons['projectId'] = selected_project_id;
					getIssueTypes(jsons);
				}
				selected_project_id = "0";
			}else{
				$(".twoway_text").hide();
				$(".oneway_text").show();
			}
			var roomFlag=false;
			var rooms =  "";
			statusJSON = '{"statuses": [{"from": "*","to": "To Do"}, {"from": "*","to": "In Progress"}, {"from": "*","to": "Resolved"}, {"from": "*","to": "Done"}]}';
			var typeVal = JSON.parse(statusJSON);
			if(formAction!="update"){
				fillNotificationList(changeToArray(typeVal.statuses));
			}else{
				if(configStatusJson!=undefined){
				if(configStatusJson[0].hasOwnProperty("from")){
						fillNotificationList(changeToArray(editStatusJson.statuses));
					}else{
						fillNotificationList(changeToArray(typeVal.statuses));
					}
				}else{
					fillNotificationList(changeToArray(typeVal.statuses));
				}
				var removeEmptyDivs = [];
				$('#notificationList').find('div').each(function() {
					if($('#notificationList').find('div').is(':empty')){
						removeEmptyDivs.push(this.id);
					}
				});
			}
			if(formAction!="update") {
				webhookUrl = ui_settings["integrationSpecificSettings"]["webhookDetails"].webhookUrl;
				$('#webhookURL').val(webhookUrl);
				$('.webhookUrl').html(webhookUrl);
				instanceUuid = ui_settings["integrationSpecificSettings"]["webhookDetails"].instanceUuid;
			}
			
			$('#rooms')[0].options.length = 1;
			
			rooms = ui_settings["sparkRoomSettings"].items;
			console.log("rooms!!!!!!!!!!!!!!!" + rooms);
			if(allRooms.length !=0 && !twowayFlag) {
				rooms = allRooms;
				$(".rooms-loading").hide();
			}
			if(twowayFlag)
				$("#rooms").append($('<option>').text("Private message (only to me)").attr('value',"isPrivate"));
			$.each(rooms, function(id,obj){
				obj.title = $('<div />').text(obj.title).html();
				$("#rooms").append($('<option>').text(obj.title).attr('value',obj.id));
				if(formAction=="update" && room_id_old==obj.id&&roomFlag==false){
					selected_room_id=obj.id;
					roomFlag=true;
				}
			});
			authenticated_user = ui_settings["integrationSpecificSettings"]["webhookDetails"]["user"];
			if(twowayFlag){
				$(".rooms-loading").hide();
				$("#authenticatedas").html(authenticated_user);
				$(".authenticted-block").show();
			}
			
			if(formAction=="update" && roomFlag==false && !privateRoom){
				console.log("formAction update and roomFlag false!!!");
				selected_room_id = "0";
				$(".edit-roomconfig-info").show();
			}
			$("#rooms").val(selected_room_id);
			
			
			$('#select2-rooms-container').html($("#rooms option:selected").text());
			$(".rooms-loading").hide();
			resize();
		}else{
			alert("We've experienced some difficulty. Try again.");
		}
		if(formAction!="update"){
			$('#select2-rooms-container').html('Please select a space');
			selected_room_id = 0;
			$("#rooms").val(selected_room_id);
			
			$('input[name="events"]').attr('disabled', false);
			$("#other-event-name").attr('disabled', false);
			
		}
	}
	
	
	//-----------------------------------------------------------------------------------------------------------
	//-----------------------------------------------------------------------------------------------------------
	//-----------------------------------------------------------------------------------------------------------
	//-----------------------------------------------------------------------------------------------------------
	
	
		
		
		
		
		
		
		
		
		
		
		
		
	function getIssueTypesText(){
		console.log("in getIssueTypesText()!!!!!!!!!!");
		var issueTypeName = "";
		var issueTypeClass = "";
		var buttonParentDiv = "";
		if(twowayFlag){
			issueTypeName = "authissuetype";
			issueTypeClass = "authissuetype";
			buttonParentDivName = "auth-issuetypes";
			allCheckBoxClass = "authissuetypeall";
		}else{
			issueTypeName = "issuetype";
			issueTypeClass = "issuetype";
			buttonParentDivName = "issuetypes";
			allCheckBoxClass = "issuetypeall";
		}
		typeslength = $('input[name="'+issueTypeName+'"]:checked').length;
		issue_types_count = $('input[class="'+issueTypeClass+'"]').length;
		console.log("typeslength!!!!" + typeslength +"!!!!class count!!!!" + issue_types_count);
		var issueTpesArray = [];
		var issueTypesText;
		
		$("."+issueTypeClass+":checked").each(function() {
			issueTpesArray.push($(this).val());
		});
		
		issueTypesText = issueTpesArray.join(',');

		if(typeslength >= 1){
			$('.'+buttonParentDivName+' div.ms-options-wrap > button').html(issueTypesText);
		}else{
			$('.'+buttonParentDivName+' div.ms-options-wrap > button').html("Select Types");
		}
		if(typeslength!=0){
			$(".config-info").show();
			$("#showConfig").show();
			$("#expand-close-config").removeClass("expandarrow");
			$("#expand-close-config").addClass("closearrow");
			$('.closearrow').attr('title','close');
		} else {
			$(".config-info").hide();
			$("#showConfig").hide();
		}
		$('.'+allCheckBoxClass).change(function () {
			console.log("allCheckBox change function()!!!!!!!");
			var flag = $(this).prop("checked");
			if(flag==true){ 
				$('.'+buttonParentDivName+' div.ms-options-wrap > button').html("All"); 
			}else{
				$('.'+buttonParentDivName+' div.ms-options-wrap > button').html("Select Types");
			}
			$("."+issueTypeClass).prop('checked', $(this).prop("checked"));
			 typeslength = $('input[class="'+issueTypeClass+'"]:checked').length;
			 console.log("after all checked length!!!!" + typeslength);
			 if(typeslength!=0){
				$(".config-info").show();
				$("#showConfig").show();
				$("#expand-close-config").removeClass("expandarrow");
				$("#expand-close-config").addClass("closearrow");
				$('.closearrow').attr('title','close');
			} else {
				$(".config-info").hide();
				$("#showConfig").hide();
			}	
		}); 
		$('.'+issueTypeClass).change(function(){ 
			console.log("class change function()!!!!!!!");
			typeslength = $('input[class="'+issueTypeClass+'"]:checked').length;
			console.log("types length!!!!" + typeslength);
			$("."+issueTypeClass).each(function() { 
				if($(this).prop('checked')==false && typeslength<issue_types_count){
					$("."+allCheckBoxClass).prop('checked',false);
				} else if(typeslength==issue_types_count){
					$("."+allCheckBoxClass).prop('checked',true);
					$('.'+buttonParentDivName+' div.ms-options-wrap > button').html("All"); 		
				}
			});
		});
		resize();
	}
	
	
	function validateIntegrationAppspecificToken(){
		console.log("in validateIntegrationAppspecificToken...");
		$.ajax({
			url: configuration_settings_url,
			async: true,
			headers: { 'userId': user_id },
			success: function(result, textStatus, request){
					if(request.getResponseHeader('x-csrf-jwt') != null){
						csrfJwt = request.getResponseHeader('x-csrf-jwt');
					}
					if(result["integrationSpecificSettings"]["isValidToken"]==false && result["integrationSpecificSettings"]["isValidToken"] == undefined){
						isClientAppTokenValid = false;
						console.log("***** validateIntegrationsApp token  with validateClientToken *********");
						$('.client-app-warning').html(clientAppRevokeMsg);
						listIntegrations();
						$(".jira-auth").hide();
					}else{
						isClientAppTokenValid = true;
						appTokenExists = true;
						loadJiraForm();
					}
				},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
				   alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function getAuthUser(){
		if(!isAccountExpired){
			if(ui_settings["integrationSpecificSettings"] != undefined ){
				if(ui_settings["integrationSpecificSettings"]!= undefined && ui_settings["integrationSpecificSettings"]!= null && isClientAppTokenValid && appTokenExists){
					authenticated_user=ui_settings["integrationSpecificSettings"]["webhookDetails"].user;
				}
			}
		}
		
	}
	function loadForm(){
		$("#expand-close-config").removeClass("expandarrow");
		$("#expand-close-config").addClass("closearrow");
		$('.closearrow').attr('title','close');
		$(".config-info").hide();
		$("#showConfig").hide();			
		$('.custom-event-remove').remove();
		otherEventSelectedValues = [];
		$('#instanceid').val('');
		
		if(!twowayFlag){
			$(".issuetypeall").prop('checked',false);
			$('.otherevent-disable').prop("disabled",false);
			$('.otherevent-custom-disable').prop("disabled",false);
			$('.comments-checkbox').prop("checked",false);
			if(!twowayFlag){
				$('.otherissuetypes').remove();
				$('#issuetypes').multiselect('reload');
				$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('name', 'issuetype');
				$('.issuetypes div.ms-options > ul > li > ul > li').find(':checkbox').attr('class', 'issuetype');
				$('.issuetypes div.ms-options > ul > li > ul > li input[value="All"]').attr('class', 'issuetypeall');
				$('.issuetypes div.ms-options-wrap > button').html("Select Types");	
				$(".config-notes").hide();
				$(".jira-links").hide();
			}
			/*if(listResultData.length != 0){$("#submit-button").text("Add");
				$("#expand-close").removeClass("closearrow");
				$("#expand-close").addClass("expandarrow");
				$('#expand-close').find("span").attr("title",'expand');
				$("#showSetup").hide();
			}
			else{
				$("#submit-button").text("Add Integration");
				$("#expand-close").removeClass("expandarrow");
				$("#expand-close").addClass("closearrow");
				$('#expand-close').find("span").attr("title",'close');
				$("#showSetup").show();
			}*/
			
			$("#config-label").html('Next, reach out to your JIRA admin so that they can add this configuration to your JIRA instance. Below are the JIRA admin steps. Once your JIRA admin completes these steps, you will start to receive notifications in your selected Spark space.');
			$("#all").prop('checked',false);
			
			
			//loadRooms();
			$('#select2-rooms-container').html('Please select a space');
		}
		$(".config-label").html('');
		$(".config-label").html('Next, once the respective JIRA admin completes these steps, notifications will get sent to the selected Spark space.');
	}
	
	
			
	function expandAuthInstructions(){
		$("#showSetup").show();
		$("#showSetup1").show();
		$("#intruction-expand-close-config").addClass("closearrow");
		$("#intruction-expand-close-config-user").addClass("closearrow");
		$("#intruction-expand-close-config").removeClass("expandarrow");
		$("#intruction-expand-close-config-user").removeClass("expandarrow");
		$('.closearrow').attr('title','close');
	}
	
	function generateIntegrationAppToken(app_code) {
		$.ajax({url: get_app_token_url,
			async:true,
			headers: { 'userId': user_id },
			type: "get",
			success: function(result, textStatus, request){
				if(request.getResponseHeader('x-csrf-jwt') != null){
					csrfJwt = request.getResponseHeader('x-csrf-jwt');
				}
				if(result.tokenResult.tokenId) {
					validateIntegrationSpecificAppToken(app_code);
				} else {
					getIntegrationAppTokenDetails(app_code); 
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function validateIntegrationSpecificAppToken(app_code) {
		console.log("in validateIntegrationSpecificAppToken..app_code" +app_code);
		$.ajax({
			url: configuration_settings_url,
			async: true,
			headers: { 'userId': user_id },
			success: function(result, textStatus, request){
				if(request.getResponseHeader('x-csrf-jwt') != null){
					csrfJwt = request.getResponseHeader('x-csrf-jwt');
				}
			console.log("---------------------------------------------------------------------")
				if(result["integrationSpecificSettings"]["isValidToken"]==false && result["integrationSpecificSettings"]["isValidToken"] != undefined){
					isClientAppTokenValid = false;
					console.log("---------------------------------------------------------------------")
					console.log("---------------------------------------------------------------------"+app_code)
					if(app_code!="")
					getIntegrationAppTokenDetails(app_code);
					else setIntegrationAppAuthDetails(integration_id);
				}else{
					isClientAppTokenValid = true;
					appTokenExists = true;
					listIntegrations();
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
				   
				}
			}
		});
	}
	function setIntegrationAppAuthDetails() {
		console.log("in setIntegrationAppAuthDetails..");
		var OAUTHURL    =   '';
		var CLIENTID    =   '';
		var TYPE        =   'code';
		$.ajax({url: application_auth_details_url,
			async:true,
			headers: { 'userId': user_id },
			success: function(result, textStatus, request){
				if(request.getResponseHeader('x-csrf-jwt') != null){
					csrfJwt = request.getResponseHeader('x-csrf-jwt');
				}
				CLIENTID=result.clientId;
				OAUTHURL= result.authorizationEndpoint;
				OAUTHURL=OAUTHURL+'?client_id='+CLIENTID+'&response_type='+TYPE+'&scope=admin:org_hook write:repo_hook admin:repo_hook user repo';
				loginWithAuthDetails(OAUTHURL);	
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});		
	}
	
	
	//-----------------------------------------------------------------------------------------------------------------------------
	function generateUUID() {
		var d = new Date().getTime();
		var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
			var r = (d + Math.random()*16)%16 | 0;
			d = Math.floor(d/16);
			return (c=='x' ? r : (r&0x3|0x8)).toString(16);
		});
		return uuid;
	};
	function insertAtIndex(i) {
		var count = addElementsCount;
		$("#notificationList > div:nth-child(" + (i) + ")").after('<div class="large-10 medium-12 columns dynamicCount" id="field_'+count+'" style="margin-bottom: 10px"><div class="large-5 medium-4 columns left status-fields"><input type="text" id="from_'+count+'" value="" name="notifications['+count+'][from]"></input></div><span class="towards-arrow" title="To">&nbsp;</span><div class="large-5 medium-4 columns left status-fields">	<input type="text" id="to_'+count+'" value="" name="notifications['+count+'][to]"></input></div><span class="remove-status" onclick="javascript:removeField('+count+');testCoo();return false;" title="Remove">&nbsp;</span></div>');
	}
	function calculateDivIds(){
			$('#notificationList').find('div').each(function() {
				var field_name = this.id;
				if(field_name.length !=0){
					if(field_name.length == 7){
						dynamicStatus.push(field_name.substring(field_name.length-1,field_name.length));
					}
					else 
					dynamicStatus.push(field_name.substring(field_name.length-2,field_name.length));
				}
			});
			addElementsCount = Math.max(...dynamicStatus)+1;
	}
	
	 function testCoo(){
		divCount = $('#notificationList').find('div').length;
		if($('#notificationList').find('div').length>3){
			divCount = divCount-3;
		}
	 }
	function removeField(id){
		var length = $('#notificationList').children().length;
		if(length>2){$('#field_'+id).remove();}else{alert("Please give at least one status.");}
		var c = 0,inputCount=-1;
		$('#notificationList').find('input:text').each(function() {
			inputCount++;
			if(inputCount%2 == 0){
				$(this).attr('name','notifications['+(c)+'][from]');
				$(this).attr('id','from_'+c);	
			}
			if(inputCount%2 == 1){
				$(this).attr('name','notifications['+(c)+'][to]');
				$(this).attr('id','to_'+c);
			}
			if(inputCount%2 == 1){
				c++;
			} 
		});
	}
	function changeToArray(obj){
		if( typeof obj === 'string' ) {
			obj = [ obj ];
			return obj;
		}else{return obj;}
	}
	
	
	function loadWebhookSettings(){
		$.ajax({
				url: configuration_settings_url,
				async: true,
				headers: { 'userId': user_id },
				success: function(result, textStatus, request){
					if(request.getResponseHeader('x-csrf-jwt') != null){
						csrfJwt = request.getResponseHeader('x-csrf-jwt');
					}
					if(formAction!="update") {
						webhookUrl = result["integrationSpecificSettings"]["webhookDetails"].webhookUrl;
						$('#webhookURL').val(webhookUrl);
						$('.webhookUrl').html(webhookUrl);
						instanceUuid = result["integrationSpecificSettings"]["webhookDetails"].instanceUuid;
					}
				},
				 error: function(xmlHttpRequest,error) {
				   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					   return;
				   }else{
						$('#integration-form').html("We've experienced some difficulty. Try again.");
						$('#integration-form').hide();
						alert("We've experienced some difficulty. Try again.");
					}
				}
			});
	}
	/*function validateConfiguration(instance, notifications, configNotifications, flag){
		var configData = JSON.parse(instance.configJson);
		var configEvents = configNotifications;
		var notificationsLength = notifications.length;
		var matchCount = 0;
		configFlag = false;
		if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = true;}else{selectedAllEventsMatchFlag=false;}
		if(flag=="issuetype"){issueTypeMatchFlag = true;}else{issueTypeMatchFlag=false;}
		if(instance.channelId==room_id){
			configFlag = true;
		}
		if($.isArray(notifications)&&configEvents!=undefined){
			if($.isArray(configEvents)){
				if($(configEvents).not(notifications).length === 0 && $(notifications).not(configEvents).length === 0) {
					if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = true;}else{issueTypeMatchFlag=true;}
				}else{
					if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = false;}else{issueTypeMatchFlag=false;}
				}
			}else{
				if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = false;}else{issueTypeMatchFlag=false;}
			}
		}else{
			if($.isArray(configEvents)&&configEvents!=undefined){
			   if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = false;}else{issueTypeMatchFlag=false;}
			}else{
			  if(configEvents==notifications&&configEvents!=undefined){
				if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = true;}else{issueTypeMatchFlag=true;}
			  }else{
				if(flag=="selectedAllEvents"){selectedAllEventsMatchFlag = false;}else{issueTypeMatchFlag=false;}
			  }
			}
		}
	}
	function validateIssueStatusConfiguration(instance, notifications, configNotifications, flag){
		var configEvents = configNotifications;
		var notificationsLength = notifications.length;
		var matchCount = 0;
			if(notificationsLength==configEvents.length){
				$.each(notifications, function(index, notificationObj){
					if($.isArray(configEvents)){
						$.each(configNotifications, function(index, configObj){
							var notificationObjFrom = notificationObj.from;
								notificationObjFrom = notificationObjFrom.replace(/\s/g, "");
								notificationObjFrom = notificationObjFrom.toLowerCase();
							var notificationObjTo = notificationObj.to;
								notificationObjTo = notificationObjTo.replace(/\s/g, "");
								notificationObjTo = notificationObjTo.toLowerCase();
							if(configObj.hasOwnProperty("from")){
								var configObjFrom = configObj.from;
								configObjFrom = configObjFrom.replace(/\s/g, "");
								configObjFrom = configObjFrom.toLowerCase();
								var configObjTo = configObj.to;
									configObjTo = configObjTo.replace(/\s/g, "");
									configObjTo = configObjTo.toLowerCase();
								if(notificationObjFrom==configObjFrom && notificationObjTo==configObjTo){
									matchCount = matchCount +1;
								}else{
								}
							}else{
								issueStatusMatchFlag = false;
							}
						});
					}else{
						issueStatusMatchFlag = false;
					}
				});
			}else{
				issueStatusMatchFlag = false;
			}
		
		 if(matchCount==configEvents.length&&notificationsLength==configEvents.length){issueStatusMatchFlag = true;}else{issueStatusMatchFlag = false;}
	}
	
	*/
	
	
	function validateJIraConfigurations(notificationEventsCheckBox, configSelectedAllEvents){
		if(!$.isArray(configSelectedAllEvents) && notificationEventsCheckBox.length == 1){
			if(notificationEventsCheckBox.indexOf(configSelectedAllEvents)>=0)
				return false;
			else return true;
		}else if(notificationEventsCheckBox.length == configSelectedAllEvents.length){
			var y = 0;
			for(var x = 0; x<configSelectedAllEvents.length; x++){
				if(notificationEventsCheckBox.indexOf(configSelectedAllEvents[x])>=0){
					y++;
				}
			}
			if(y == configSelectedAllEvents.length)
				return false;
			else
				return true;
		}else if(!$.isArray(notificationEventsCheckBox) && !$.isArray(configSelectedAllEvents)){
			if(notificationEventsCheckBox.toLowerCase() == configSelectedAllEvents.toLowerCase()){
				return false;
			}else
				return true;
		}else
			return true;
	}
	
	function validateJIraConfigurationsStatus(notificationStatus, configSelectedStatus){
		if(notificationStatus.length == configSelectedStatus.length){
			var y = 0;
			for(var x = 0; x<configSelectedStatus.length; x++){
				if(configSelectedStatus[x]['from'].toLowerCase() == notificationStatus[x]['from'].toLowerCase() && configSelectedStatus[x]['to'].toLowerCase() == notificationStatus[x]['to'].toLowerCase()){
					y++;
				}
			}
			if(y == configSelectedStatus.length)
				return false;
			else
				return true;
		}else
			return true;
	}
	
	function checkRooms(thisRoom, instanceRoom){
		
	}
	function saveJiraInstance() {
		room_id = $("#rooms option:selected").val();
		var condigurationJSON = {};
		condigurationJSON['channelId'] = room_id;
		condigurationJSON['integrationId'] = integration_id;
		condigurationJSON['status'] = "ACTIVE";
		condigurationJSON['userId'] = user_id;
		condigurationJSON['instanceUuid'] = instanceUuid;
		condigurationJSON['messageFormat'] = "JIRA Bot :"+"Hello...User";
		if(formAction=="update") {
			actionType="PUT";
			condigurationJSON["instanceId"] = $('#instanceid').val();
			action_url=update_configuration_settings_url+instanceId;
			if(room_id!=room_id_old) {
				room_modified=true;
				condigurationJSON["messageToSpark"] = updateMessageToSpark;
			} else {
				room_modified=false;
			}
			condigurationJSON["room_modified"] = room_modified;
			condigurationJSON["configJson"]=JSON.parse(instanceData.configJson);
			$('.loading-first-block').html('Please wait while your Integration is being updated');
		}else{
		    condigurationJSON["configJson"] = {};
			action_url = save_configuration_settings_url;
			actionType="POST";
			condigurationJSON["messageToSpark"] = postMessageToSpark;
			$('.loading-first-block').html('Please wait while your Integration is being set up');
		}
		
		if(onlyBot){
			action_url = save_configuration_settings_url;
			actionType="POST";
		}
		
		condigurationJSON["configJson"]['displayName'] = $("#displayName").val();
		condigurationJSON["configJson"]["webhookurl"]= $("#webhookURL").val();
		
		//Selected notifications
		var notificationEventsCheckBox = []
		
		$("input[name='events']:checked").each(function (){
			if($(this).val()=='all'||$(this).val()=='All'){
				notificationEventsCheckBox.push('user');
				notificationEventsCheckBox.push('project');
			}
			notificationEventsCheckBox.push($(this).val());
		});
		condigurationJSON["configJson"]["notifications"] = {};
		
		condigurationJSON["configJson"]["notifications"]["comments"] = notificationEventsCheckBox;
		
		//Selected IssueTypes
		var notificationIssueTypeCheckBox = []
		if(twowayFlag){
			if($('.authissuetypeall').is(":checked")){
				notificationIssueTypeCheckBox = "All";
			}else{
				$("input[name='authissuetype']:checked").each(function (){
					notificationIssueTypeCheckBox.push($(this).val());
				});
			}
			condigurationJSON["configJson"]["notifications"]["isuuesType"] = notificationIssueTypeCheckBox;
		}else{
			if($('.issuetypeall').is(":checked")){
				notificationIssueTypeCheckBox = "All";
			}else{
				$("input[name='issuetype']:checked").each(function (){
					notificationIssueTypeCheckBox.push($(this).val());
				});
			}
			condigurationJSON["configJson"]["notifications"]["isuuesType"] = notificationIssueTypeCheckBox;
		}
		
		
		
		//selected status
		var notificationBox = $("#notificationList input[type=text]");
		var notificationCheckBox = []
		var has_empty = false;
		for(var x=0;x<notificationBox.length;x+=2){
			var jsonS = {};
			if(($(notificationBox[x]).val()=="" || $(notificationBox[x+1]).val()=="") && !has_empty)
				has_empty = true;
			jsonS['from'] = $(notificationBox[x]).val();
			jsonS['to'] = $(notificationBox[x+1]).val();
			notificationCheckBox.push(jsonS);
		}
		condigurationJSON["configJson"]["notifications"]["issuesStatus"] = notificationCheckBox;
		
		if(twowayFlag){
			if(room_id == "isPrivate")
				condigurationJSON["configJson"]["isPrivate"] = true;
			else
				condigurationJSON["configJson"]["isPrivate"] = false;
			condigurationJSON["configJson"]["unauthmode"] = false;
			condigurationJSON["configJson"]["twoway"] = true;
			condigurationJSON["configJson"]["projectId"] = $("#projects").val();
		}else{
			condigurationJSON["configJson"]["unauthmode"] = true;
			condigurationJSON["configJson"]["twoway"] = false;
		}
		
		postAddMessageToRoom(room_id,appName);
		
		
		
		
		var eventslength = $('input[name="events"]:checked').length;
		var statuslength = $('#notificationList').children().length;
		
		var typeslength = notificationIssueTypeCheckBox.length;
		if(!$.isArray(notificationIssueTypeCheckBox) && notificationIssueTypeCheckBox.toLowerCase() == "all")
			typeslength = "All";
		
		
		//update modified
		var updateChangeFlag = false;
		if(formAction == "update"){
			var old_instance_match = JSON.parse(instanceData.configJson);
			var old_issuetypes = old_instance_match.notifications.isuuesType;
			var old_events = old_instance_match.notifications.comments;
			var old_status = old_instance_match.notifications.issuesStatus;
			
			if(!$.isArray(old_issuetypes) && !$.isArray(notificationIssueTypeCheckBox) && old_issuetypes.toLowerCase() != notificationIssueTypeCheckBox.toLowerCase()){
				updateChangeFlag = true;
			}else if(old_issuetypes.length == notificationIssueTypeCheckBox.length){
				var countissuesmatch = 0;
				for(var i=0; i<old_issuetypes.length ; i++){
					if(old_issuetypes.indexOf(notificationIssueTypeCheckBox[i])>=0)
						countissuesmatch++;
				}
				if(countissuesmatch == old_issuetypes.length)
					updateChangeFlag = false;
				else
					updateChangeFlag = true;
			}else
				updateChangeFlag = true;
				
				
			if(!updateChangeFlag){
				if(old_status.length == notificationCheckBox.length){
					if(JSON.stringify(old_status).toLowerCase() == JSON.stringify(notificationCheckBox).toLowerCase())
						updateChangeFlag = false;
					else
						updateChangeFlag = true;
				}else
					updateChangeFlag = true;
			}
			
			if(!updateChangeFlag){
				if(old_events.length == notificationEventsCheckBox.length){
					if(JSON.stringify(old_events) == JSON.stringify(notificationEventsCheckBox))
						updateChangeFlag = false;
				}else
					updateChangeFlag = true;
			}
			
			if(twowayFlag && !updateChangeFlag){
				if(old_instance_match.projectId == $("#projects").val())
					updateChangeFlag = false;
				else
					updateChangeFlag = true;
			}
			
			if(room_modified)
				updateChangeFlag = true;
		}
		
		
		
		
		
		
		
		
		
		
					
		var selectedAllEventsFlag = true;
		var selectedAllIssueTypeFlag = true;
		var selectedAllStatusesFlag = true;
		var roomCheckFlag = true;
		
		
		var roomSelect = true;
		
		if(room_id==0)
			roomSelect = false;
			
		condigurationJSON["configJson"]["onlyRoom"] = false;
		saveJsonString = JSON.stringify(condigurationJSON);
		if(onlyBot){
			condigurationJSON["configJson"]["onlyRoom"] = true;
			saveJsonString = JSON.stringify(condigurationJSON);
			saveJiraInstanceConfig();
		}else if(formAction=="update" && !updateChangeFlag){
			saveJiraInstanceConfig();
		}else if(!roomSelect){
			alert("Please select a space.");
		}else if(has_empty){
			alert("status change field value must not be empty")
		}else if(!twowayFlag){
			if(condigurationJSON["configJson"]["notifications"]["isuuesType"] == undefined || condigurationJSON["configJson"]["notifications"]["isuuesType"].length == 0)
				alert("Please select an issue type(s).");
			else if(condigurationJSON["configJson"]["notifications"]["issuesStatus"] == undefined || condigurationJSON["configJson"]["notifications"]["issuesStatus"].length == 0)
				alert("Please enter status change field value.");
			else if(condigurationJSON["configJson"]["notifications"]["comments"] == undefined || condigurationJSON["configJson"]["notifications"]["comments"].length == 0)
				alert("Please select at least 1 notification");
			else if(listResultData.length == 0)
				saveJiraInstanceConfig();
			else{
				var saveFlagUnauth = true;
				$.each(listResultData, function(i, instance) {
					if(instance.instanceId!=instanceId){
						var configData = JSON.parse(instance.configJson);
						if(configData.unauthmode == undefined || configData.unauthmode){
							var events = configData.notifications;
							var configSelectedAllEvents = events.comments;
							var issuetypeEvents = events.isuuesType;
							var configIssueStatuses = events.issuesStatus;
							
							
							if(selectedAllEventsFlag || selectedAllIssueTypeFlag || selectedAllStatusesFlag || roomCheckFlag){
							
								//check for same notifications events
								selectedAllEventsFlag = validateJIraConfigurations(notificationEventsCheckBox, configSelectedAllEvents);
								
								//check for same issuetypes
								selectedAllIssueTypeFlag = validateJIraConfigurations(notificationIssueTypeCheckBox, issuetypeEvents);
								
								//check for same statuses
								selectedAllStatusesFlag = validateJIraConfigurationsStatus(notificationCheckBox, configIssueStatuses);
								
								//check for same room
								if(instance.channelId == room_id)
									roomCheckFlag = false;
								else
									roomCheckFlag = true;
							}
							if(!selectedAllEventsFlag && !selectedAllIssueTypeFlag && !selectedAllStatusesFlag && !roomCheckFlag){
								saveFlagUnauth = false;
							}
						
						}
					}
				});
				if(saveFlagUnauth)
					saveJiraInstanceConfig();
				else
					$('#same-configuration').foundation('open');
			}
		}else if(twowayFlag){
			if($("#projects").val()==0 || $("#projects").val()=="0" && $("#projects").val()=="")
				alert("Please select a project.");
			else if(condigurationJSON["configJson"]["notifications"]["isuuesType"] == undefined || condigurationJSON["configJson"]["notifications"]["isuuesType"].length == 0)
				alert("Please select an issue type(s).");
			else if(condigurationJSON["configJson"]["notifications"]["issuesStatus"] == undefined || condigurationJSON["configJson"]["notifications"]["issuesStatus"].length == 0)
				alert("Please enter status change field value.");
			else if(condigurationJSON["configJson"]["notifications"]["comments"] == undefined || condigurationJSON["configJson"]["notifications"]["comments"].length == 0)
					alert("Please select at least 1 notification");
			else if(listResultData.length == 0)
				saveJiraInstanceConfig();
			else{
				var saveFlagUnauth = true;
				$.each(listResultData, function(i, instance) {
					if(instance.instanceId!=instanceId){
						var configData = JSON.parse(instance.configJson);
						
						if(configData.twoway){
							var events = configData.notifications;
							var configSelectedAllEvents = events.comments;
							var issuetypeEvents = events.isuuesType;
							var configIssueStatuses = events.issuesStatus;
							
							
							if(selectedAllEventsFlag || selectedAllIssueTypeFlag || selectedAllStatusesFlag || roomCheckFlag){
							
								//check for same notifications events
								selectedAllEventsFlag = validateJIraConfigurations(notificationEventsCheckBox, configSelectedAllEvents);
								
								//check for same issuetypes
								selectedAllIssueTypeFlag = validateJIraConfigurations(notificationIssueTypeCheckBox, issuetypeEvents);
								
								//check for same statuses
								selectedAllStatusesFlag = validateJIraConfigurationsStatus(notificationCheckBox, configIssueStatuses);
								
								//check for same room
								if(instance.channelId == room_id)
									roomCheckFlag = false;
								else
									roomCheckFlag = true;
							}
							if(!selectedAllEventsFlag && !selectedAllIssueTypeFlag && !selectedAllStatusesFlag && !roomCheckFlag){
								saveFlagUnauth = false;
							}
						
						}
					}
				});
				if(saveFlagUnauth)
					saveJiraInstanceConfig();
				else
					$('#same-configuration').foundation('open');
			}
		}
		
		
		
		
		
		
		
		
			
		/*if(formAction=="update") {
			actionType="PUT";
			jsonData["instanceId"] = $('#instanceid').val();
			action_url=update_configuration_settings_url+instanceId;
			if(room_id!=room_id_old) {
				room_modified=true;
				jsonData["messageToSpark"] = updateMessageToSpark;
			} else {
				room_modified=false;
			}
			jsonData["room_modified"] = room_modified;
			jsonData["configJson"]=JSON.parse(instanceData.configJson);
			$('.loading-first-block').html('Please wait while your Integration is being updated');
		}else{
			jsonData["configJson"]={};
		    action_url = save_configuration_settings_url;
			actionType="POST";
			jsonData["messageToSpark"] = postMessageToSpark;
			$('.loading-first-block').html('Please wait while your Integration is being set up');
		}
		jsonData["configJson"]["displayName"]= res.displayName;
		jsonData["configJson"]["webhookurl"]= $("#webhookURL").val();
		jsonData["configJson"]["notifications"]={};			
		jsonData["configJson"]["notifications"]["issuesStatus"] = statusObjects;
		if(checkRes)
			jsonData["configJson"]["isPrivate"] = true;
		else
			jsonData["configJson"]["isPrivate"] = false;
			
		checkedComments=[];
		if($('input[type="checkbox"][value="all"]').prop("checked")==true){
			$(".comments-checkbox:checked").each(function() {
				checkedComments.push(this.value);
			});
			if(checkedComments.length != 0){
				$.each(allSelectedArray,function(index,value){
					checkedComments.push(value);
				});
			}else{
				checkedComments = allSelectedArray;
			}
			jsonData["configJson"]["notifications"]["comments"] = checkedComments;
			selectedAllEvents  = checkedComments;
		}else{
			jsonData["configJson"]["notifications"]["comments"] = res.events;
			selectedAllEvents = res.events;
		}
		var eventslength = $('input[name="events"]:checked').length;
		var statuslength = $('#notificationList').children().length;
		var issueStatuses =  statusObjects;
		var issueTypeNotifications = issueTypeEvents;
		if(!twowayFlag){
			if ($.isArray(res.issuetype)) {
				var issueTypesArray = [];
					$.each(res.issuetype, function(index, value) {
						issueTypesArray.push(value);
					});
					if($.inArray('All', issueTypesArray)>-1){
						jsonData["configJson"]["notifications"]["isuuesType"] = "All";
						issueTypeEvents="All";
					}else{
						jsonData["configJson"]["notifications"]["isuuesType"] = res.issuetype;
						issueTypeEvents = res.issuetype;
					}
			}else{
				issueTypeEvents = res.issuetype;
				jsonData["configJson"]["notifications"]["isuuesType"] = res.issuetype;
			}
				jsonData["configJson"]["unauthmode"]=true;
				saveJsonString = JSON.stringify(jsonData);
			var typeslength = $('input[name="issuetype"]:checked').length;
			console.log("unauth typeslength!!!!!!!!" + typeslength);
			if(listResultData.length != 0 && eventslength !=0 && typeslength !=0 && !has_empty){
				$.each(listResultData, function(i, instance) {
					var configData = JSON.parse(instance.configJson);
					var events = configData.notifications;
					var configSelectedAllEvents = events.comments;
					var issuetypeEvents = events.isuuesType;
					var configIssueStatuses = events.issuesStatus;
					var selectedAllEventsFlag = "selectedAllEvents";
					var issueTypeFlag = "issuetype";
					var issueStatusFlag = "issuestatus";
					var issueStatus = events.issuesStatus;
					if(formAction=="update"&&instance.instanceId!=instanceId){
					 validateConfiguration(instance, selectedAllEvents, configSelectedAllEvents, selectedAllEventsFlag);
					 eventsFlag = selectedAllEventsMatchFlag;
					 validateIssueStatusConfiguration(instance, issueStatuses, configIssueStatuses, issueStatusFlag);
					 statusFlag = issueStatusMatchFlag;
					 validateConfiguration(instance, issueTypeNotifications, issuetypeEvents, issueTypeFlag);				 
					 if(eventsFlag==true&&issueTypeMatchFlag==true&&configFlag==true){
							return false;
						}
					}
					if(formAction!="update"){
					 validateConfiguration(instance, selectedAllEvents, configSelectedAllEvents,selectedAllEventsFlag);
					 eventsFlag = selectedAllEventsMatchFlag;
					 validateIssueStatusConfiguration(instance, issueStatuses, configIssueStatuses, issueStatusFlag);
					 statusFlag = issueStatusMatchFlag;
					 validateConfiguration(instance, issueTypeNotifications, issuetypeEvents,issueTypeFlag);
					  if(eventsFlag==true&&issueTypeMatchFlag==true&&configFlag==true&&statusFlag==true){
							return false;
						}
					}
				});
			}
			if($('#rooms').val()==0 || $('#rooms').val()==null){
				alert("Please select a space.");
			} else if(typeslength==0){
				alert("Please select IssueTypes.");
			} else if(has_empty){
				alert("Please enter status change field value.");
			} else if(eventslength==0){
				alert("Please select at least 1 notification");
			}else if(listResultData.length != 0 && eventsFlag==true && issueTypeMatchFlag==true && statusFlag==true && configFlag==true){
				if(formAction=="update"){
					$.each(listResultData, function(i, instance) {
						var configData = JSON.parse(instance.configJson);
						var events = configData.notifications;
						var configSelectedAllEvents = events.comments;
						var issuetypeEvents = events.isuuesType;
						var configIssueStatuses = events.issuesStatus;
						var selectedAllEventsFlag = "selectedAllEvents";
						var issueTypeFlag = "issuetype";
						var issueStatusFlag = "issuestatus";
						var issueStatus = events.issuesStatus;
						if(formAction=="update"&&instance.instanceId==instanceId){
						  validateConfiguration(instance, selectedAllEvents, configSelectedAllEvents, selectedAllEventsFlag);
						  eventsFlag = selectedAllEventsMatchFlag;
						  validateIssueStatusConfiguration(instance, issueStatuses, configIssueStatuses, issueStatusFlag);
						  statusFlag = issueStatusMatchFlag;
						  validateConfiguration(instance, issueTypeNotifications, issuetypeEvents, issueTypeFlag);
						  if(room_modified || !eventsFlag || !issueTypeMatchFlag || !statusFlag)
							$('#same-configuration').foundation('open');
						  else
							saveJiraInstanceConfig();
						}
					});
				}else{
					$('#same-configuration').foundation('open');
				}
			}else{
				saveJiraInstanceConfig();
			}
		}else{
				jsonData["configJson"]["projectId"]= $("#projects").val();
				if ($.isArray(res.authissuetype)) {
					var issueTypesArray = [];
						$.each(res.authissuetype, function(index, value) {
							issueTypesArray.push(value);
						});
						if($.inArray('All', issueTypesArray)>-1){
							jsonData["configJson"]["notifications"]["isuuesType"] = "All";
							issueTypeEvents="All";
						}else{
							jsonData["configJson"]["notifications"]["isuuesType"] = res.authissuetype;
							issueTypeEvents = res.authissuetype;
						}
				}else{
					issueTypeEvents = res.authissuetype;
					jsonData["configJson"]["notifications"]["isuuesType"] = res.authissuetype;
				}
				jsonData["configJson"]["unauthmode"]=false;
				saveJsonString = JSON.stringify(jsonData);
				var typeslength = $('input[name="authissuetype"]:checked').length;
				console.log("auth typeslength!!!!!!!!" + typeslength);
			if(!checkRes && ($('#rooms').val()==0 || $('#rooms').val()==null)){
				alert("Please select a space.");
			} else if($("#projects").val()=="0" || $("#projects").val()==""){
				alert("Please select Project.");
			}else if(typeslength==0){
				alert("Please select IssueTypes.");
			} else if(has_empty){
				alert("Please enter status change field value.");
			} else if(eventslength==0){
				alert("Please select at least 1 notification");
			}else{
				saveJiraInstanceConfig();
			}
		}
		*/
	}
	function saveJiraInstanceConfig(){
		$('#same-configuration').foundation('close');
		$('.loading-second-block').html('Selected Space is '+ selectedRoomName);
		if(!onlyBot)
		$('#loading-block').foundation('open');
		$.ajax({url: action_url,
			async:true,
			headers: { 'userId': user_id, 'x-csrf-jwt' : csrfJwt},
			type: actionType,
			data: saveJsonString,
			contentType: "application/json",
			dataType: "json",
			success: function(result, textStatus, request){
				if(request.getResponseHeader('x-csrf-jwt') != null){
					csrfJwt = request.getResponseHeader('x-csrf-jwt');
				}
				if(!onlyBot){
					$('#success-integration').foundation('open');
					$('#loading-block').foundation('close');
				}else{
					if(result['twoWaySetUpResponse']['addMemberToSpaceResponse'] != undefined && result['twoWaySetUpResponse']['addMemberToSpaceResponse']['statusCode'] == 409){
						$("#bot-alert").html(bot_failure_msg );
					}else{
						$("#bot-alert").html(bot_success_msg);
					}
					$("#bot-alert").fadeIn("slow");
				}			
			},
			error: function(xmlHttpRequest, error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					$('#loading-block').foundation('close');
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
		$('.loading-first-block').html('Please wait just a moment while your app is loading');
		$('.loading-second-block').html('');
	}
	
	
	function loadConfigBlock(){
		if(twowayFlag){
			$(".authhiddenblock .room").html(roomsSelector);
			$(".authhiddenblock .displayName").html(displayNameBox);
			
			$(".unauthconfigurationdiv .room").html("");
			$(".unauthconfigurationdiv .displayName").html("");
			$(".unauthconfigurationdiv").hide();
			
		}else{
			$(".unauthconfigurationdiv .room").html(roomsSelector);
			$(".unauthconfigurationdiv .displayName").html(displayNameBox);
			$(".unauthconfigurationdiv").show();
			
			$(".authhiddenblock .room").html("");
			$(".authhiddenblock .displayName").html("");
		}
		$("#rooms").select2();
	}
	//-------------------------------------------------------------------------------------------------
	
	function getAjaxCall(callUrl){
		$.ajax({
			url: callUrl,
			async:true,
			headers: { 'userId': user_id },
			type: "get",
			success: function(result, textStatus, request){
				if(request.getResponseHeader('x-csrf-jwt') != null){
					csrfJwt = request.getResponseHeader('x-csrf-jwt');
				}
				pollingFalg = true;
				ajaxResult = result;
			},
			error: function(xmlHttpRequest,error) {
				ajaxFailFlag = true;
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	
	function postAjaxCall(callUrl, jsonPostBody){
		$.ajax({
			url: callUrl,
			async:true,
			headers: { 'userId': user_id, 'x-csrf-jwt' : csrfJwt},
			type: "POST",
			data: JSON.stringify(jsonPostBody),
			contentType: "application/json",
			dataType: "json",
			success: function(result, textStatus, request){
				if(request.getResponseHeader('x-csrf-jwt') != null){
					csrfJwt = request.getResponseHeader('x-csrf-jwt');
				}
				pollingFalg = true;
				ajaxResult = result;
			},
			error: function(xmlHttpRequest, error) {
				ajaxFailFlag = true;
				if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					return;
				}else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	
	function check_value(fieldvalue) {
            switch (fieldvalue) {
            case 1:
                document.getElementById("imagedest").innerHTML = "<img src='https://183.82.99.100:8443/CiscoWebcontent/images/jira/jiraissueassigne.png'>";
                break;
            case 2:
                document.getElementById("imagedest").innerHTML = "<img src='https://183.82.99.100:8443/CiscoWebcontent/images/jira/jiraissuerepoter.png'>";
                break;
            }
        }
		
	//-------------------------------------------------------------------------------------------------
</script>
</head>
<body data-whatinput="mouse">
	<div class="integration-app" id="jira"><br>
		<div class="rows large-12 medium-12 columns warning-msg" style="display:none;"></div>
		<div class="rows large-12 medium-12 columns client-app-warning" style="display:none;"> </div>
		<div class="rows large-12 medium-12 columns account-expire-warning" style="display:none;"></div>
		<div id="loading-block" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="loading"><img class="spark-icon" src="" alt="....."></div>
			<div class="loading-div-background">
				<div class="loading-first-block">Please wait just a moment while your app is loading</div>
				<div class="loading-second-block">name and space name</div>
				<div class="loading-bar"><div class="loading-background"></div>	</div>
			</div>
		</div>
		<div id="list-loading-block" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="loading"><img class="spark-icon" src="" alt="....."></div>
			<div class="loading-div-background">
				<div class="loading-first-block">Please wait...</div>
				<div class="loading-second-block"></div>
				<div class="loading-bar"><div class="loading-background"></div>	</div>
			</div>
		</div>
		<div id="success-integration" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="success-loading">
				<img class="spark-icon" src="" alt=".....">
			</div>
			<div class="well-done-text">Well done!</div>
			<div class="success-integration-first-block">Your configuration has been set up. Ensure that you have followed any additional instructions provided.</div>
			<div class="large-5 medium-5 columns buttons-block">
				<div class="success-integration-second-block">
					<!--<button class="button" id="room-button">Go to
						Content Testing Space</button>-->
					<button class="secondary button" id="done-button">Done</button>
				</div>
			</div>
		</div>
		<div class="reveal" id="remove-integration-popup" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="large-12 columns desktop-block">			    
				<div class="row">
					<div class="large-2 medium-2 columns"><img alt="" id="jira-icon" src=""/></div>
					<div class="large-6 medium-6 columns" style="float:left;">
						<label id="displayName-label"></label>
						<label id="addedon-label"></label>
					</div>
				</div><br>
				<div class="msg-labels"><label id="remove-msg"></label> <label id="remove-auth"></label></div>				
				<button class="close-button" data-close aria-label="Close modal" type="button">
					<span aria-hidden="true">&times;</span>
				</button><br><br>
				<button class="button remove-integration-btn" id="remove-integration-btn" style="float:right">Remove</button>
			</div>
			<div class="large-12 columns mobile-block">	
				<div class="msg-labels"><label id="remove-msg-mobile"></label> <label id="remove-auth-mobile"></label></div>				
				<div class="option-buttons remove-integration-buttons">
					<label id="cancel-remove-integration" class="remove-popup-cancel"> 
						<a href="#" >Cancel</a>
					</label>
					<label class="remove-popup-remove remove-integration-btn">
						<a href="#">Remove</a>
					</label>
				</div>
			</div>
		</div>
		<div id="same-configuration" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="same-config-text">An identical configuration to the same Cisco Spark space you have selected already exists. Are you sure you want to configure one more?</div>
			<div class="large-5 medium-5 columns buttons-block">
				<button class="secondary button same-config-yes">Yes</button>
				<button class="secondary button same-config-no">No</button>
			</div>
		</div>
		
		<div id="bot-alert"></div>
		<div class="spark_scope_alert" style="display:none;"></div>
		 <div class="large-12 columns">
			<div class='cisco_users_permission_errorclk' style="display:none;">
				
			</div>
		</div>
		<div class='config-notes' style='display:none'>
			<div class='row'>
				<div class="large-12 medium-12" style='margin-bottom:10px;'>
					<p><b>To add JIRA for Cisco Spark, choose one of two ways below.</b></p>
				</div>
			</div>
			<div class='row ciscouser' style='margin-bottom:15px;'>
				<div class="large-10 medium-10 columns">
					<ul>
						<li><p>Update JIRA tickets from Spark and/or Receive JIRA notifications in Spark</p>
						<p>- Any JIRA user can exercise this option by taking help from their JIRA admin.</p><p>- Works only for JIRA Cloud.</p><p>- JIRA authorization needed.</p>
						</li>
					</ul>
					
				</div>
				<div class="large-2 medium-2 columns ciscoAuthLinkDiv"style="margin-top:5px">
					<a href="#" class="jira-auth-link" style='padding:0px !important'><button class="button secondary text ciscousrhide" style="font-size: 14px !important;">Add</button></a>
							
				</div>
				<span class='cisco_users_permission_error'>
				
				</span>
			</div>
			<div class='row' style='margin-bottom:15px;'>
				<div class="large-10 medium-10 columns">
					<ul>
						<li><p>Receive JIRA notifications in Spark</p>
						<p>- Only a JIRA admin can exercise this option.</p><p>- Works for both JIRA Server and Cloud.</p><p>- JIRA authorization not needed.</p>
						</li>
					</ul>
					
				</div>
				<div class="large-2 medium-2 columns" style="margin-top:15px">
					<a href="#" class="jira-unauth-link" style='padding:0px !important'><button class="button secondary text" style="font-size: 14px !important;">Add</button></a>
				</div>
			</div>
		</div>
		
		<!--
		<div class="config-notes" style='display:none'>
			<p>There are 2 options to set up JIRA for Cisco Spark:<br>
			- Via the Spark Depot: Any JIRA user can set up the configuration in the Spark Depot after their JIRA admin completes steps in their JIRA instance. Only works for cloud versions of JIRA. Requires Spark OAuth process. Once you complete the configuration, you can receive notifications from the bot and give it commands.<br><br>
			- Via WebHooks: Only a JIRA admin can set up the configuration via WebHooks. Works for on-prem and cloud versions of JIRA. Does not require OAuth process. Once you complete the configuration, you can receive notifications, which will appear as JIRA on behalf of you. There will be no JIRA bot attached to the configuration. </p>
			<br>
		</div>
		
		<div class="jira-links" style='display:none; text-align:center'>
			<a href="#" class="jira-auth-link" style='padding:0px !important'><button class="button secondary text" style="width:280px !important;padding-left:10px !important;padding-right:10px !important;font-size: 14px !important;">Add Configuration Via Spark Depot</button></a><br><br>
			<a href="#" class="jira-unauth-link" style='padding:0px !important'><button class="button secondary text" style="width:280px !important;padding-left:10px !important;padding-right:10px !important;font-size: 14px !important;">Add Configuration Via WebHooks</button></a>
		</div>-->
		<form name="form1" id="form1" style='display:none'>
			<div class="row">
				<div class="large-12 medium-12 columns jira-steps">
				<p><b>Setup Instructions to Update JIRA tickets from Spark and/or Receive JIRA notifications in Spark.</b></p>
				<br/>
					<label><b>Step 1</b></label>
					
				</div>
			</div>
			<div class="row">
				<div class="large-3 medium-2 columns" style='margin-top:4px !Important'><label class="label-config">JIRA Base URL:
				<span style="margin-left:0px !important" class="has-tip tip-right jira-baseurl-tooltip" id="tooltip" title="Provide Base URL for JIRA Cloud. On-prem version is  not supported." data-tooltip="0aa1i7-tooltip" aria-describedby="awv4kc-tooltip" data-yeti-box="awv4kc-tooltip" data-toggle="awv4kc-tooltip" data-resize="awv4kc-tooltip" data-events="resize"><img class="tool-tip"></span></label>
				</div>
				<div class="large-6 medium-6 columns">
					<div class="large-3 columns medium-2 protocol-block">
						<span id="protocol" class="jira-protocol">https://</span>
					</div>
					<div class="large-5 medium-6 columns jira-domainName-block">
						<input name="jirasubdomain" id="jirasubdomain" type="text">
					</div>
					<div class="large-4 medium-4 columns">
						<span id="domainName" class="jira-domainName">.atlassian.net</span>
					</div>
				</div>
				<div class="large-3 medium-4 columns">
					<button id="get-authentication" class="button">
						<b>Validate</b>
					</button>
				</div>
			</div>
			<br/>
			<div class="row">
				
			</div>
		</form>
		<div class="row">
			<div class="large-12 medium-12 columns jira-setup-instructions " style="display:none;">
				<label class="jira-steps"><b>Step 2</b> (JIRA Admin user)</label>
				<div class="large-12 medium-12 columns instructions-config-info" style="">
				<!--	<p class='jira-align-margin'>Note: Before JIRA non-admin users can use this integration, the respective JIRA admin must complete steps A  L in the JIRA Admin instructions below. <b>Note: This step needs to be completed only once per each JIRA Base URL/domain</b>. Successful JIRA authorization in Step 3 confirms admin setup was already completed for this domain.</p><br> -->
					<p class='jira-align-margin'>Before JIRA non-admin users can use this integration, the respective JIRA admin must complete steps A  L in the JIRA Admin instructions below. <b>This step needs to be completed only once per each JIRA Base URL/domain.</b></p><br>
					<div class="large-12 medium-12 columns">
						<div class="large-3 medium-3 columns">
							<label style='margin-left:-14px !important'><span class="" id="intruction-expand-close-config" title=""> &nbsp;</span>
								<label class="admin_instruction_label" id="config-label">JIRA Admin Instructions
									<span class="has-tip tip-right instructions_tooltip"  id="tooltip" title="This will send you a direct Cisco Spark message with a PDF of the personalized admin instructions you can share with your Admin." data-tooltip><img class="tool-tip"></span>
								</label>
							</label>
						</div>
						<div class="large-8 medium-9 columns" style="right:-32px;">
							<button class="button send_instructions" ><b>Send Me Admin Instructions</b></button>
							<span class="file_sending_loading" style="display: none;"></span>
							<div id="spark_admin"></div>
						</div>
						<div id="showSetup" style="display:none">
							<div class="large-12 columns sub-config-block jira-align-margin">
								<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step A</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Enter your JIRA account credentials  and click the <b>Log in</b> button.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruction01.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step B</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Click on the <b>settings</b> icon and click <b>Applications</b>.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc111.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step C</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>In left panel, under <b>Integrations</b> click <b>Application links</b>.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc222.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step D</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Type the URL of your choice into the input field and then click <b>Create new link</b>.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc03.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step E</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Enter the URL of your choice in the <b>New URL</b> field and click <b>Continue</b>. Can be the same URL as provided in Step D.</p>
									<br><img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc04.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
							<div class="large-1 medium-1 columns step">
								<label><b>Step F</b></label>
							</div>
							<div class="large-11 medium-11 columns step-text">
								<!--<p>The below right hand side fileds are manadatory and enter other values of your choice.
								<!--Enter the fields as displayed in the box below on the right-hand side. --> <!--Double check the inputs match exactly and then click <b>Continue</b>.</p>-->
								<p>Be sure to copy and paste the Consumer Key, Shared Secret, and Application Type exactly. The other values are of your choice. A sample URL you can use is https://www.ciscospark.com/.</p>
								<br/>
								<div class="large-5 medium-5 columns" style="margin-left:-7px;">
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc05.png" class="setup-image">
								</div>
								<div class="large-7 medium-7 columns">
									<div class="large-2 medium-2 columns">
										<label><b>Application Name</b></label>
									</div>
									<div class="large-9 medium-9 columns">
										<input type="text" name="applicationName" id="applicationName" value="Cisco Spark" readonly>
														<a href="javascript:void(0)" id="applicationNameCopy">Copy App Name</a>	
									</div>
								</div><br>
								<div class="large-7 medium-7 columns">
									<div class="large-2 medium-2 columns">
										<label><b>Application Type</b></label>
									</div>
									<div class="large-9 medium-9 columns">
										<input type="text" name="applicationType" id="applicationType" value="Generic Application" readonly>
									</div>
								</div><br>
								<div class="large-7 medium-7 columns">
									<div class="large-2 medium-2 columns">
										<label><b>Consumer Key</b></label>
									</div>
									<div class="large-9 medium-9 columns">
										<input type="text" class="consumerKey" name="consumerKey" id="consumerKey" value="hardcoded-consumer" readonly>
														<a href="javascript:void(0)"  class="consumercopy" id="consumercopy">Copy Consumer Key</a>	
									</div>
								</div><br>
								<div class="large-7 medium-7 columns">
									<div class="large-2 medium-2 columns">
										<label><b>Shared Secret</b></label>
									</div>
									<div class="large-9 medium-9 columns">
										<input type="text" name="sharedSecret" id="sharedSecret" value="1232429789797" readonly>
														<a href="javascript:void(0)" id="sharedcopy">Copy Shared Secret</a>	
									</div>
								</div><br>
							</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step G</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Click on the <b>Edit</b> icon as shown below.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc06.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step I</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Click <b>Incoming Authentication</b> in the left panel.</p>
									<p>Copy the <b>Consumer Key</b> and paste it in the <b>Consumer Key</b> field. Enter the <b>Consumer Name</b> as JIRA for Cisco Spark.</p><br>
									<div class="large-10 medium-10 columns">
										<div class="large-3 medium-3 columns">
											<label><b>Consumer Key</b></label>
										</div>
										<div class="large-9 medium-9 columns">
											<input type="text" name="consumerKey1" id="consumerKey1" value="hardcoded-consumer" readonly>
											<a href="javascript:void(0)"  id="consumercopy1">Copy Consumer Key</a>	
										</div>
									</div>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc08.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step J</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Copy the provided <b>Public Key</b> below and paste it in the <b>Public Key</b> field.</p><br>
									<div class="large-10 medium-10 columns">
										<div class="large-3 medium-3 columns">
											<label><b>Public Key</b></label>
										</div>
										<div class="large-9 medium-9 columns">
											<input type="text" name="publicKey" id="publicKey" value="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxZDzGUGk6rElyPm0iOua0lWg84nOlhQN1gmTFTIu5WFyQFHZF6OA4HX7xATttQZ6N21yKMakuNdRvEudyN/coUqe89r3Ae+rkEIn4tCxGpJWX205xVF3Cgsn8ICj6dLUFQPiWXouoZ7HG0sPKhCLXXOvUXmekivtyx4bxVFD9Zy4SQ7IHTx0V0pZYGc6r1gF0LqRmGVQDaQSbivigH4mlVwoAO9Tfccf+V00hYuSvntU+B1ZygMw2rAFLezJmnftTxPuehqWu9xS5NVsPsWgBL7LOi3oY8lhzOYjbMKDWM6zUtpOmWJA52cVJW6zwxCxE28/592IARxlJcq14tjwYwIDAQAB" readonly>
											<a href="javascript:void(0)" id="publiccopy">Copy Public Key</a>		
										</div>
									</div>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc09.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin">
							<br/>
								<div class="large-1 medium-1 columns step">
									<label><b>Step K</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Copy the provided <b>Callback URL</b> below and paste it in the <b>Consumer Callback URL</b> field.</p><br>
									<div class="large-10 medium-10 columns">
										<div class="large-3 medium-3 columns">
											<label><b>Callback URL</b></label>
										</div>
										<div class="large-9 medium-9 columns">
											<input type="text" name="callBackURL" id="callBackURL" value="https://183.82.99.100:8443/CiscoWebcontent/spark1.html" readonly>
											<a href="javascript:void(0)" id="callbackcopy">Copy URL</a>		
										</div>
									</div>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-instruc10.png" class="setup-image"><br><br>
									<p>That's it! You have completed the necessary set up for your JIRA instance. Now, your JIRA non-admin users can setup their configurations starting at Step #3.<br><br></p>
									<!--<p id='collapse'><i>Collapse Step #2</i></p>-->
								</div>
							</div>
							<div class="large-12 columns sub-config-block jira-align-margin"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="large-12 columns sub-config-block jira-authform-btn" style="display:none;">
			<br/><br/>
				<div class="large-12 columns">
						<div class="large-6 medium-8 columns" style="margin-left: -18px;">
					<!--		<label class="jira-steps"><b>Step 3</b> (JIRA non-Admin user)</label><p>Authorize your JIRA account.</p></div>  -->
							<label class="jira-steps"><b>Step 3</b> (JIRA non-Admin user)</label><p>If JIRA Authorization (Step #3) is successful, then it confirms Step #2 was completed by your JIRA admin for the domain provided in Step #1.</p></div>
						<!--	<label class="jira-steps"><b>Step 3</b> (JIRA non-Admin user)</label><p>Successful JIRA authorization confirms admin setup in Step 2 was already completed for this domain.</p></div> -->
					<div class="large-6 medium-4 columns">
						<button id="authenticate-btn" class="button">
							<b>Authorize</b>
						</button>
					</div>
				</div>
				<div class="large-12 columns">
					<div class='application_link_configured_error'>
						
					</div>
				</div>
				<!-- 02/08/2017<label class="jira-steps"><b>Step 3</b> (JIRA non-Admin user)<div></div></label> -->
				<!--<div class="large-12 medium-12 columns">
					<p><span class="" id="intruction-expand-close-config-user" title="close"> &nbsp;</span><span id="config-label">JIRA non-Admin instructions.</span></p>
				</div>
				
				<div id="showSetup1" style='display:none'>
					<div class="large-12 columns sub-config-block">
						<div class="large-1 medium-1 columns step">
							<label><b>Step A</b></label>
						</div>
						<div class="large-11 medium-11 columns step-text">
							<p>After Clicking on the <b>Authencate</b> button, login to JIRA.</p><br>
							<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-user-instruc01.png" class="setup-image">
						</div>
					</div>
					
					<div class="large-12 columns sub-config-block">
						<div class="large-1 medium-1 columns step">
							<label><b>Step B</b></label>
						</div>
						<div class="large-11 medium-11 columns step-text">
							<p>Click <b>Allow</b> button.</p><br>
							<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-user-instruc02.png" class="setup-image">
						</div>
					</div>
				</div>-->
				
				
			<!--02/08/2017	<div class="large-12 columns">
					<div class="large-6 medium-7 columns domain-btna">
						<button id="authenticate-btn" class="button">
							<b>Authorize</b>
						</button>
					</div>
				</div> -->
			</div>
		</div>
		<div class="integrations" id="integrations-block">
			<div id="instance-loading-block" class="row instance-loading-block" style="display: none;">
				<div class="instances-loading">&nbsp;</div>
				<div class="instances-loading-text">Loading your configurations</div>
			</div>
			<div id="home" class="home">
				<div class="row add-config-block">
					<div class="large-12 medium-12 columns">							
						<div class="large-6 medium-6 columns config-name"><label><b>JIRA configurations</b></label></div>
						<div class="large-6 medium-6 columns">
							<!--<button class="secondary button" id="add-config">Add</button>-->
						</div>				
					</div>
				</div>
				<div id="instance-list-block" class="row instance-list-block"></div>
				<!--<div class="row unauth-config-block" style='margin-left:-16px !important'>
					<div class="large-12 medium-12 columns">							
						<div class="large-6 medium-6 columns config-name"><label><b>JIRA configurations</b></label></div>
						<div class="large-6 medium-6 columns">
							<!--<button class="secondary button" id="add-config">Add</button>-->
						<!--</div>					
					</div>
				</div>
				<div id="unauth-instance-list-block" class="row unauth-instance-list-block">						
				</div>-->
			</div>
		</div>
		<div class="large-12 columns" id="integration-form" >
			<div class="large-12 medium-12 columns edit-roomconfig-info" style="display:none">
				<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured space does not exist.</span></p>
			</div>
			<div class="large-12 medium-12 columns edit-projectconfig-info" style="display:none">
				<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured project does not exist.</span></p>
			</div>
			<form name="form" id="form" method="post">
				<div class="row app-config-block jira-authform authhiddenblock">
					<!--<p>Steps 1-3 have already been completed for this configuration by you and your admin. Please proceed to Steps 4 and/or 5 to complete the process.</p>
					<label><b>Step 4 (Optional)</b></label>
					<p>If you would like to interact with the JIRA bot solely through message commands within a space, you can add it directly to the space by adding <b>jiradevbot@sparkbot.io</b>.</p>
					<div>&nbsp;</div>-->
					<div class="row app-config-block">
						<div class="large-12 medium-12 columns jira-steps">
							<!--<label><b>Step 5 (Optional)</b></label>
							<p><span id="config-label">If you would like to receive JIRA notifications in a space, create a configuration below. Completing this section will also add the JIRA bot to the selected space, if it is not already there. You can add/edit/delete multiple configurations at any time.</span></p>
							<br>------>
							<p class='authenticted-block' style='margin:0px !important'>Authenticated as: <span id='authenticatedas'></span></p>
							<!--<p>Note:</p>
							<p>- If you prefer to only update JIRA tickets from Spark and not receive any JIRA notifications in Spark, you can add the bot (JIRAdevbot@sparkbot.io) directly to any desired space in the Cisco Spark app.</p>
							<p>- To receive JIRA notifications in Spark and also update JIRA tickets from Spark, proceed to setup JIRA notification configuration below.</p>
							---><br/>
						</div>
						<div class="large-12 columns sub-config-block">
							<h3 class="heading-01">Add Bot to Cisco Spark</h3>
							<div class="large-10 medium-10 columns sub-config-block items-config">
								<div class="large-3 medium-3 columns bot-small-mobile">
									<label class="label-config">Space</label>
									<span style="margin:-38px 0 0 49px;" class="has-tip tip-right" id="tooltip" title="Space in which you'd like to receive notifications. Only spaces in which you are eligible to add a bot will display here." data-tooltip>
										<img class="tool-tip">
									</span>
								</div>
								<div class="large-5 medium-5 columns text left bot-input-small-mobile">
									<span class="room">
									</span>
								</div>
								<div class="rooms-loading" style="display: none;"></div>
							</div>
							<br/>
							<div class="large-12 medium-12 columns" style="margin-bottom:10px">
								<div class="large-6 medium-6 columns">
								<div class="large-4 medium-4 columns left bot-btn" >
									<button class="button secondary text" id="bot-submit-button">Add Bot</button>
								</div>
								</div>
								<div class="large-6 medium-6 columns">
								&nbsp;
								</div>
								
							</div>
						</div>
						
						<div class="large-12 medium-12 columns" style="margin-bottom:27px !important;"><label class="heading-01" style="margin-bottom:1px !important;">JIRA notification configuration (Optional)</label>
						<p>Receive JIRA ticket notifications in the space the bot was added above. You can set up multiple configurations to receive customized notifications in different spaces.</p>
						</div>
						<div class="large-12 columns sub-config-block">
							<div class="large-10 medium-10 columns sub-config-block items-config ">
								<div class="large-3 medium-3 columns bot-small-mobile">
									<label class="fontsize">Configuration name</label>
								</div>
								<div class="large-5 medium-5 columns text left bot-input-small-mobile displayName">
									
								</div>
							</div>
						</div>
						<div class="large-12 columns sub-config-block">
							<div class="large-10 medium-10 columns sub-config-block items-config">
								<div class="large-3 medium-3 columns bot-small-mobile">
									<label class="label-config fontsize">Projects</label>
									<span style="margin:-39px 0 0 61px;"  class="has-tip tip-right" id="tooltip" title="JIRA Project, you'd like to receive notifications." data-tooltip><img class="tool-tip"></span>
								</div>
								<div class="large-5 medium-5 columns text left bot-input-small-mobile">
									<select name="projects"  id="projects" class="dropdown" style='width:100% !important'><option value="0" hidden>Select</option></select>
								</div>
								<div class="rooms-loading" style="display: none;"></div>
							</div>
						</div>
						
						<div class="large-12 columns sub-config-block authissuetypesblock">
							<div class="large-10 medium-10 columns sub-config-block items-config">
								<div class="large-3 medium-3 columns bot-small-mobile">
									<label class="label-config fontsize" style="margin:-0 0 0 2px;">Issue Types</label>
									<span style="margin:-38px 0 0 87px;"  class="has-tip tip-right" id="tooltip" title="IssueTypes, for which you'd receive notifications for this configuration." data-tooltip><img class="tool-tip"></span>
								</div>
								<div class="large-5 medium-5 columns text left bot-input-small-mobile auth-issuetypes">
									<select multiple="multiple" id="auth-issuetypes" class="dropdown">
											<option value="All" >All</option>
										</select>
								</div>
								<div class="authissuetypes-loading" style="display: none;"></div>	
							</div>
						</div>
						<div class="large-12 columns jira-loading sub-config-block" style="display: none;">
							<div class="jira-authissutypes-loading" ></div>	
						</div>
					</div>
				</div>
				<div class="row app-config-block jira-unauthform" style="display:none;">
					<div class="row app-config-block">
						<div class="large-12 medium-12 columns"><label class="heading-01" style="margin-bottom:2px !important">JIRA notification configuration</label>
						<p style="margin-bottom:10px">Receive JIRA ticket notifications in Cisco Spark. You can set up multiple configurations to receive customized notifications in different spaces.</p>
						</div>	
						<div class="large-12 medium-12 columns">
							<div class="large-10 medium-12 columns sub-config-block">
								<div class="large-5 medium-6 columns left">
									<div class="large-6 medium-8 columns issuetypes" style='margin-left:-22px !important'>
										<label class="label-config fontsize" style='margin-left:1px !important'>Issue Types:</label>
											<select multiple="multiple" id="issuetypes" class="dropdown" name="">
												<optgroup id="issue-types-options" label="" >
													<option value="All" >All</option>
													<option value="bug" >Bug</option>
													<option value="change">Change</option>
													<option value="story">Story</option>
													<option value="task">Task</option>
													<option value="epic">Epic</option>
													<option value="incident">Incident</option>
													<option value="servicerequest">Service Request</option>
													<option value="problem">Problem</option> 
												</optgroup>
											</select>
									</div>
								</div>
								<div class="large-5 medium-6 columns add-custom-type left" >
									<div class="large-6 medium-12 columns">
										<label class="label-config">&nbsp;</label>
										<div class="large-6 medium-10 columns">
											<input type="text" id="customtype_field"  name="">	
											<a style="float:right;font-size:12px" href="javascript:void(0)" id="add_customtypes">+ Add</a>
										</div>
										<span class="has-tip tip-right issutypes" id="tooltip" title="Notifications will be sent only for the selected issue types." data-tooltip><img class="tool-tip"></span>
									</div>
								</div>
							</div>
						</div>
					</div>	
				</div><br>
				<div class="row app-config-block">
					<div class="row app-config-block">
						<div class="large-12 medium-12 columns">
							<div class="large-10 columns sub-config-block" style='margin-left: -14px !important;'>
								<div class="large-10 medium-12 columns">
										<label class="label-config fontsize">Notifications: Status Changes <span class="has-tip tip-right jira-statuschange-tooltip" id="tooltip" title='Select for which status changes on selected issue type(s) you would like to receive notifications. A * represents all statuses.' data-tooltip><img class="tool-tip"></span></label>
								</div>
								<div class="large-10 medium-12 columns" id="notificationList" style='margin-left: -17px !important;'>
									<div></div>
								</div>
								<div class="large-1 medium-12 columns customstatus-add-div">
									<div class="large-0 medium-8 columns customstatus-add-btn">
										<a id="add_status" href="javascript:void(0)" style="font-size:12px;float:right;">+ Add</a>
									</div>
								</div>
							</div>	
						</div>		
					</div>	
				</div>
				<div class="row app-config-block">
					<div class="row app-config-block">
						<div class="large-12 columns events-config">
							<div class="large-12 medium-12 columns events">
								<label>Notifications: Comments <span class="has-tip tip-right jira-events-tooltip" id="tooltip" title="Select for which comments on selected issue type(s) you would like to receive notifications
" data-tooltip="shupm2-tooltip" aria-describedby="l5sa71-tooltip" data-yeti-box="l5sa71-tooltip" data-toggle="l5sa71-tooltip" data-resize="l5sa71-tooltip" data-events="resize"><img class="tool-tip"></span></label>
								<div class="events-sub " id="events">
									<div class="large-12 medium-12 columns">
										<div class="large-6 medium-6 columns checkbox"><input type="checkbox" class="events comments-checkbox" id="newcomment" name="events" value="newcomment"/>
										<label for="newcomment">New Comment</label></div>
									</div>
									<div class="large-12 medium-12 columns" style="margin:0 -5% 0 0"><!-- style="margin:0 0 0 10%"-->
										<div class="large-12 medium-12 columns">
											<div class="large-6 medium-6 columns checkbox"><input type="checkbox" class="events comments-checkbox" id="restricted-comments" name="events" value="restricted-comments"/>
											<label for="restricted-comments">Include restricted comments</label></div>
										</div>
										<div class="large-12 medium-12 columns">
											<div class="large-6 medium-6 columns checkbox"><input type="checkbox" class="events comments-checkbox" id="comment-edits" name="events" value="comment-edits"/>
											<label for="comment-edits">Include comment edits</label></div>
										</div> 
									</div>
								 </div>
							</div>
							<div class="large-12 medium-12 columns">&nbsp;</div>
							<div class="large-12 medium-12 columns events">
								<label>Notifications: Other events <span style="margin: -4px 0 0 12px !important" class="has-tip tip-right jira-events-tooltip" id="tooltip" title="Select the box(es) for which you would like to receive notifications when the field(s) change." data-tooltip="shupm2-tooltip" aria-describedby="l5sa71-tooltip" data-yeti-box="l5sa71-tooltip" data-toggle="l5sa71-tooltip" data-resize="l5sa71-tooltip" data-events="resize"><img class="tool-tip"></span></label>
								<div class="events-sub" id="other_notifications">
									<div class="large-12 medium-12 columns">
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="all" value="all" class="allevent-disable"><label for="all">All</label>
										</div>
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="board-update" value="board" class="otherevent-disable"><label for="board-update">Board</label>
										</div>
									</div>
									<div class="large-12 medium-12 columns">
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="priority-update" value="priority" class="otherevent-disable"><label for="priority-update">Priority</label>
										</div>
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="assignee-change" value="assignee" class="otherevent-disable"><label for="assignee-change">Assignee</label>
										</div>
									</div>
									<div class="large-12 medium-12 columns">
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="description-update" value="description" class="otherevent-disable"><label for="description-update">Description</label>
										</div>
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="attachment" value="attachment" class="otherevent-disable"><label for="attachment">Attachment</label>
										</div>
									</div>
									<div class="large-12 medium-12 columns">
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="sprint-update" value="sprint" class="otherevent-disable"><label for="sprint-update">Sprint</label>
										</div>
										<div class="large-3 medium-4 columns checkbox">
											<input type="checkbox" name="events" id="version-change" value="fixversion" class="otherevent-disable"><label for="version-change">Fix version</label>
										</div>
									</div>
								</div>
								<div class="large-12 medium-12 columns">&nbsp;</div>
								<div class="large-12 medium-12 columns " style="margin-right:15px">
									<div class="large-5 medium-4 columns left">
										<label>Other Event Names</label>
									</div>
									<div class="large-5 medium-4 columns left other-event-text">
										<input type="text" id="other-event-name" class="otherevent-disable">
										<a style="float:right;font-size:12px" href="javascript:void(0)" id="add-other-events" >+ Add</a>
									</div>
									<span class="has-tip tip-right other-events-tooltip" id="tooltip" title="Don't see a custom field for which you'd like to receive notifications when the field changes? Add it here." data-tooltip><img class="tool-tip"></span>
								</div>
							</div>
						</div>
						<div class="large-12 medium-12 columns config-info" style="display:none;">
							<p><span class="" id="expand-close-config" title=""> &nbsp;</span><span id="config-label" class="config-label">Next, once the respective JIRA admin completes these steps, notifications will get sent to the selected Spark space.<!--Next, reach out to your JIRA admin so that they can add this configuration to your JIRA instance. Below are the JIRA admin steps. Once your JIRA admin completes these steps, you will start to receive notifications in your selected Spark space.--></span></p>
						</div>
						<div id="showConfig" style="display:none;">
							<div class="large-12 columns sub-config-block">
								<div class="large-1 medium-1 columns step">
									<label><b>Step A</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Login into your JIRA account as Admin. Click on the <b>settings icon</b> and select <b>System</b> as shown.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-1.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block">
								<div class="large-1 medium-1 columns step">
									<label><b>Step B</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>If you are requested to login, use your admin credentials.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-2.png" class="setup-image">
								</div>
							</div>
							<div class="large-12 columns sub-config-block">
								<div class="large-1 medium-1 columns step">
									<label><b>Step C</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>In the left panel under the <b>ADVANCED</b> section, click on <b>WebHooks</b>.</p><br>
									<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-3.png" class="setup-image">
								</div>
							</div><br>
							<div class="large-12 columns sub-config-block">
								<div class="large-1 medium-1 columns step">
									<label><b>Step D</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>Click on <b>Create a WebHook</b> at top right corner.</p>
									<ul type="disc">
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;Enter <b>Name</b> of your choice.</li>
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;Paste below Webhook URL into the <b>URL</b> text box.</li>
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;In <b>Events</b> section text box, follow below Syntax to add projects for which you'd like to receive alerts.</li>
									</ul>
									<p>Syntax: <b>Project=&lt;project-name&gt;</b> for single project and  
										<b>Project=&lt;project-name&gt; OR Project=&lt;project-name&gt;</b> for multiple projects.</p>
									<ul>
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;Under <b>Issue</b>, select created, updated and/or deleted.</li>
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;Under <b>Comment</b>, unselect created, updated and/or deleted. If not, you'd receive dual notifications in your configured Cisco Spark space - one for the comment alone and other for a comment update related to the issue. </li>
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;If you intend to receive notifications for Sprints, Boards and other Project/User related events, ensure to select those options for the wehbook and also in the above section in Depot named 'Notifications  Other events'.</li>
										<li>&#9679;&nbsp;&nbsp;&nbsp;&nbsp;Click <b>Save</b>.</li>
									</ul><br>
										<div class="large-12 columns">
											<div class="large-2 medium-2 columns" style="padding: 0px !important;">
												<label style="margin:7px;">WebHook URL :</label>
											</div>
											<div class="large-10 medium-10 columns">
												<input type="text" name="webhookURL" id="webhookURL" value="" readonly>
												<a href="javascript:void(0)" id="copy">Copy URL</a>			
											</div>
										</div><br><br>
										<img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-4.png" class="setup-image">
										<div class='oneway_text'><img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-5.png" class="setup-image"></div>
										<div class='twoway_text'><img alt="" src="https://183.82.99.100:8443/CiscoWebcontent/images/jira/jira-5-2way.png" class="setup-image"></div>
								</div>
							</div>
							<div class="large-12 columns sub-config-block">
								<div class="large-1 medium-1 columns step">
									<label><b>Step E</b></label>
								</div>
								<div class="large-11 medium-11 columns step-text">
									<p>If you would like to receive notifications only from a specific user, please follow below instructions.</p><br>
									<div name="builder" class="large-11 medium-11 columns">
										<div class="large-3 medium-6 columns checkbox">
											<input type="radio" name="field" value="assignee" onclick='check_value(1)'/><span>Notifications from specific Assignee</span>
										</div>
										<div class="large-3 medium-6 columns checkbox">
											<input type="radio" name="field" value="reporter" onclick='check_value(2)'/><span>Notifications from specific Reporter</span>
										</div>
									</div>
									<div id="imagedest"></div>
								</div>
							</div><br>
						</div>
					</div>
				</div>
				<div class="row spark-config-block unauthconfigurationdiv" style='margin-left:2px;'>
					<div class="large-10 medium-10 columns">
						<h3 class="heading-01">Cisco Spark configuration</h3>
						<div class="large-8 columns sub-config-block">
							<div class="large-2 medium-3 columns small-mobile">
								<label>Space <span class="has-tip tip-right" id="tooltip" title="Space in which you'd like to receive notifications. Spaces with at least 1 message will appear here." data-tooltip><img class="tool-tip"></span></label>
							</div>
							<div class="large-5 medium-5 columns text left input-small-mobile">
								<span class="room">
								
								</span>
								
								<!-- <span class="has-tip tip-right" id="tooltip" title="Space in which you'd like to receive notifications. Spaces with at least 1 message will appear here." data-tooltip><img class="tool-tip"></span> -->
							</div>
							<div class="spaces-refresh" title="Refresh the spaces"></div>
							<div class="rooms-loading" style="display: none;"></div>
						</div>
						<div class="large-8 columns sub-config-block left">
							<div class="large-2 medium-3 columns small-mobile config-optional">
								<label>Configuration name (optional)</label>
							</div>
							<div class="large-5 medium-5 columns text left input-small-mobile displayName">
								
							</div>
						</div>
						<input type="hidden" name="instanceid" id="instanceid" value="">			
					</div>
				</div>
				<div class="row integration-config-block">
					<div class="large-5 medium-5 columns"> &nbsp;</div>
					<div class="large-4 medium-4 columns left">
						<button id="cancel-button" class="button">Cancel</button>
						<button id="submit-button" class="button secondary text">Save</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</body>
</html>