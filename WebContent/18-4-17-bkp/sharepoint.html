<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sharepoint Online Integration to Cisco Spark</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.css" rel="stylesheet" type="text/css"> 
<link href="https://d24wgzqqegxpap.cloudfront.net/api/css/collab-ui-min.css" rel="stylesheet" type="text/css">
<link href="https://183.82.99.100:8443/CiscoWebcontent/css/styles.css" rel="stylesheet" type="text/css">
<link href="https://183.82.99.100:8443/CiscoWebcontent/css/select2.min.css" rel="stylesheet" />  
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.js"></script> 
<script type="text/javascript" src="https://d24wgzqqegxpap.cloudfront.net/api/js/porthole.min.js"></script>
<script type="text/javascript" src="https://183.82.99.100:8443/CiscoWebcontent/js/scriptsRoom.js"></script>
<script src="https://183.82.99.100:8443/CiscoWebcontent/js/select2.min.js"></script>
<script>
	integration_app_icon_url="https://183.82.99.100:8443/CiscoWebcontent/images/sharepoint/sharepoint.png";
	clientAppRevokeMsg = '<p class="integrationAuthMsg"><span class="info-icon" title=""> &nbsp;</span><span>We are facing difficulty while accessing your Sharepoint account. Please click on Add to authorize.</span></p>';
	var application_id="29";
	var selected_source_id="0";
	var selected_subfolder_id ="0";
	var source_id_old="";	
	var source_modified =false;
	var instanceUuid="";
	var room_id = "";
    var selectedSourceId = "";
	var eventsMatchFlag = true;
	var configFlag = false;
	var folderFlag = false;
	var selectedSubSourceId = "";
	var sub_source_id_old = "0"
	var sub_source_modified = false;
	var saveJsonString = "";
	var selectedRoomName = "";
	var action_url = "";
	var actionType = "";
	var selected_site_url="0";
	var selectedSiteUrl = "";
	var newSiteUrl="";
	var itemslist = "";
	var siteURL = "";
	var selectedWebUrl="";
	var dropDownValue = false;
	var urlValid = false;
	var webURL = "";
	var selected_web_url = "";
	appName = "Sharepoint Online";
	postMessageToSpark = "Sharepoint Online "+postMessageToSpark;
	updateMessageToSpark= "Sharepoint Online "+updateMessageToSpark;
	removeMessageToSpark= "Sharepoint Online "+removeMessageToSpark;
	$(document).ready(function(){
		application_auth_details_url="/api/applications/"+application_id;
		token_url="/api/integrations/"+integration_id+"/authDetails";
		save_spark_token_url="/api/clients/tokens";
		save_app_token_url="/api/integrations/"+integration_id+"/appTokens";
		get_app_token_url="/api/integrations/"+integration_id+"/appTokens";
		configuration_settings_url="/api/integrations/"+integration_id+"/uiSettings";
		save_configuration_settings_url="/api/integrations/instances";
		update_configuration_settings_url="/api/integrations/instances/";
		delete_instance_url="/api/integrations/instances/";
		list_integration_instances_url="/api/integrations/instances";		
		removeall_integration_instances_url="/api/integrations/instances";	
		delete_spark_token_url="/api/clients/tokens";
		delete_integration_token_url="/api/integrations/"+integration_id+"/appTokens";		
		$('#integration-form').hide();
		action=action.toLowerCase();
		if(action=="connect") {
			$("#integrations-block").hide();
			$("#integration-form").hide();
			validateIntegrationAppToken();			
		} else if(action=="disconnect") {
			formAction="disconnect";
			removeAllIntegrationInstances(formAction);
		} else {
			var app_code =   gup(document.referrer, 'code');
			if(app_code!="") {
				generateIntegrationAppToken(app_code); 
			} else {
				validateIntegrationAppTokenDB();
			}
		} 
		$("#rooms").select2();
		$('#sharepoint-icon').attr("src", integration_app_icon_url);
		$(".spark-icon").attr("src", spark_icon_url);	
		$("#sharepoint #submit-button").click(function (e){
			e.preventDefault();
			saveSharepointOnlineInstance();
		});
		$("#cancel-button").click(function (e){
			e.preventDefault();			
			$('#integration-form').hide();
			$('#integrations-block').show();
			listIntegrations();
			resize();
		});
		$('#sharepoint #add-config').click(function(e){
			e.preventDefault();	
			formAction="add";
			$('#WebUrl').prop('disabled', false);
			$(".edit-siteconfig-info").hide();
			$(".edit-subfolderconfig-info").hide();
			$(".edit-itemconfig-info").hide();
			$(".edit-roomconfig-info").hide();
			if(listResultData.length != 0){
				$("#submit-button").text("Add");
				$('.foldersfilesSelection').hide();
				$('.subfolderSelection').hide();
				if(isClientAppTokenValid){
					loadSharepointOnlineForm();
					loadRooms();
					$('.client-app-warning').html('');
					$("#WebUrl").val('');
				}else{
					setIntegrationAppAuthDetails(integration_id);
				}
			}else{
				$("#submit-button").text("Add Integration");				
				validateIntegrationAppToken();				
			}
		});
		$("#sharepoint #siteurls").on('change',function(){
			if($('#siteurls').val()!=0&&formAction=="update")
				$(".edit-siteconfig-info").hide();
		});	
		$("#sharepoint #resources").on('change',function(){
			if($('#resources').val()!=0&&formAction=="update")
				$(".edit-itemconfig-info").hide();
		});	
		$("#sharepoint #subfolders").on('change',function(){
			if($('#subfolders').val()!=0&&formAction=="update")
				$(".edit-columnconfig-info").hide();
		});	
		$("#sharepoint #rooms").on('change',function(){
			if($('#rooms').val()!=0&&formAction=="update")
				$(".edit-roomconfig-info").hide();
		});
		$("#siteurls").change(function () {
			console.log("in site url selection!!!");
			if($("#siteurls").val()==null || $("#siteurls").val() == '0') {
				resize();
				console.log("value empty!!!!!!!!!!");
				$("#WebUrl").prop('disabled', false);
				$(".foldersfilesSelection").hide();
				$('.subfolderSelection').hide();
			}else if($("#siteurls").val()!=null && $("#siteurls").val() != '0'){
				resize();
				$("#WebUrl").prop('disabled', true);
				$("#WebUrl").val('');
				$(".foldersfilesSelection").show();
				$(".edit-siteconfig-info").hide();
				$(".edit-subfolderconfig-info").hide();
				$(".edit-itemconfig-info").hide();
				$(".edit-roomconfig-info").hide();
				siteURL = $("#siteurls").val();
				console.log("$(#siteurls).val()----!!!!!!!!!!!!!"+$("#siteurls").val()+$("#siteurls").val());
				var jsonObject={};
				jsonObject["integrationId"] = integration_id;
				jsonObject["userId"] = user_id;
				jsonObject["siteUrl"] = $("#siteurls").val();
				jsonString=JSON.stringify(jsonObject);
				resize();
				getFolderList(jsonString);
				return false;
			}
			
		});
		$('#WebUrl').keyup(function(e){
			if(e.keyCode == 8 || e.keyCode == 46){
				if(formAction=="update"){webURL=selected_web_url;
				console.log("webURL=selected_web_url;------"+webURL);}
				if(webURL==$(this).val()){urlValid=true;}else{urlValid = false;}
			}
		});
		$('#WebUrl').keypress(function(e) {
			if(e.which == 13) {
				console.log("in site url selection!!!");
				$(".foldersfilesSelection").hide();
				if($("#WebUrl").val()!=null && $("#WebUrl").val() != '0'){
				    webURL = $("#WebUrl").val();
					urlValid = true;
					if(webURL.includes("sharepoint.com/")){
						var jsonObject={};
						jsonObject["integrationId"] = integration_id;
						jsonObject["userId"] = user_id;
						jsonObject["siteUrl"] = $("#WebUrl").val();
						jsonString=JSON.stringify(jsonObject);
						getFolderList(jsonString);
						return false;
					}else{
						urlValid = false;
						alert("Please Enter Valid URL.");
						return false;
					}
				}
				resize();
			}
		});
		$("#resources").change(function () {
			resize();
			var itemData = itemslist; 
			$.each(itemData, function(id,obj){	
				if(obj.hasOwnProperty("file")){
					$('.subfolderSelection').hide();
					$('#subfolders')[0].options.length = 1;
				}else{
					if($("#resources").val()==obj.id && $("#resources").val() != '0'){
						resize();
						console.log("resources!!!!" + $("#resources").val());
						$(".edit-subfolderconfig-info").hide();
						$(".edit-itemconfig-info").hide();
						var jsonObject={};
						jsonObject["integrationId"] = integration_id;
						jsonObject["userId"] = user_id;
						jsonObject["itemId"] = $("#resources").val();
						if(formAction=="update"&&dropDownValue){
							jsonObject["siteUrl"] = $("#siteurls").val();
						}else if(formAction=="update"&&!dropDownValue){
							jsonObject["siteUrl"] = $("#WebUrl").val();
						}else if($("#siteurls").val()!=null && $("#siteurls").val() != '0'){
							jsonObject["siteUrl"] = $("#siteurls").val();
						}else if($("#WebUrl").val()!=null && $("#WebUrl").val() != '0'){
							jsonObject["siteUrl"] = $("#WebUrl").val();
						}
						console.log("$(#siteurls).val()----<"+$("#siteurls").val());
						jsonString=JSON.stringify(jsonObject);
						getNestedFolderList(jsonString);
						return false;
					}
				}
			});
			resize();
		});
		$("#subfolders").change(function () {
			$('.edit-subfolderconfig-info').hide();
		});
		$(document).on("click", ".same-config-yes" , function(e) {
			console.log("yes clicked!!!!!!!!!!!!!");
			saveSharepointInstanceConfig();
		});
		$(document).on("click", ".same-config-no" , function(e) {
			console.log("no clicked!!!!!!!!!!!!!");
			$('#same-configuration').foundation('close');
		});
		$(document).on("click", "#sharepoint #instance-list-block .edit-config" , function() {
			formAction="update";
			source_modified=false;
			sub_source_modified=false;
			room_modified=false;
			urlValid = false;
			$("#submit-button").text("Save");
			$('.foldersfilesSelection').hide();
			$('.subfolderSelection').hide();
			instanceId=this.id;
			$.each(listResultData,function(index,value){
				if(value["instanceId"]==instanceId) {
					instanceData=value;
				}
			});
			selected_room_id=instanceData.channelId;
			room_id_old = instanceData.channelId;
			var config=JSON.parse(instanceData.configJson);
			if(config.dropDownValue){
				dropDownValue = true;
				selected_site_url =	config.siteUrl;
				console.log("dropDownValue = true;....."+config.siteUrl);
			}else{
				dropDownValue = false;
				console.log("dropDownValue = false;....."+config.siteUrl);
				selectedWebUrl = config.siteUrl;
				selected_web_url = config.siteUrl;
			}
			selected_source_id=config.item_id;
			selected_subfolder_id=config.sub_item_id;
			sub_source_id_old = config.sub_item_id;
			console.log("Edit selected_subfolder_id..." + selected_subfolder_id);
			var jsonObject2={};
			jsonObject2["integrationId"] = integration_id;
			jsonObject2["userId"] = user_id;
			jsonObject2["itemId"] = config.item_id;
			jsonString=JSON.stringify(jsonObject2);
			loadSharepointOnlineForm();
			$('#displayName').val(config.displayName);
			source_id_old = config.item_id;
			instanceUuid = instanceData.instanceUuid;
			var events = config.notifications;			
			if($.isArray(events)) {
				$.each(events,function(index,value){
					$("input[type=checkbox][value="+value+"]").prop("checked",true);
				});
			} else {
				$("input[type=checkbox][value="+events+"]").prop("checked",true);
			}
			resize();
		});	
	});
	function validateIntegrationAppToken() {
		$.ajax({url: get_app_token_url+"?userId="+user_id,
			async:true,
			type: "get",
			success: function(result){
				if(result.tokenResult.tokenId) {
					console.log("in validateIntegrationAppToken token exists.");
					validateIntegrationAppspecificToken();
				} else {
					console.log("in validateIntegrationAppToken token not exists.");
					setIntegrationAppAuthDetails(integration_id);
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					alert("We've experienced some difficulty. Try again. get app token");
				}
			}
		});
	}
	function validateIntegrationAppspecificToken(){
		console.log("in validateIntegrationAppspecificToken");
		$.ajax({
			url: configuration_settings_url+"?userId="+user_id,
			async: true,
			success: function(result){
					if(result["integrationSpecificSettings"]["isValidToken"]==false && result["integrationSpecificSettings"]["isValidToken"] != undefined){
						isClientAppTokenValid = false;
						console.log("in validateIntegrationAppspecificToken app token not exist.");
						$('.client-app-warning').html(clientAppRevokeMsg);
						$('#integrations-block').show();
						$('.client-app-warning').show();
						if(listResultData.length==0){
							setIntegrationAppAuthDetails(integration_id);
						}
					}else{
						console.log("in validateIntegrationAppspecificToken app token exist.");
						loadSharepointOnlineForm();
					}
				},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
				   alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function validateIntegrationSpecificAppToken(app_code){
		console.log("in validateIntegrationSpecificAppToken");
		$.ajax({
			url: configuration_settings_url+"?userId="+user_id,
			async: true,
			success: function(result){
					if(result["integrationSpecificSettings"]["isValidToken"]==false && result["integrationSpecificSettings"]["isValidToken"] != undefined){
						isClientAppTokenValid = false;						
						if(app_code!="")
						getIntegrationAppTokenDetails(app_code);
						else setIntegrationAppAuthDetails(integration_id);						
					}else{
						isClientAppTokenValid = true;
						listIntegrations();
					}
				},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
				   alert("We've experienced some difficulty. Try again.");
				}
			}
		});
		
	}
	function getListInstances(){
		console.log("in getListInstances.");
		$.ajax({url: list_integration_instances_url+"?userId="+user_id+"&integrationId="+integration_id,
			async:true,
			success: function(result){
			 instanceList = result;
			 if(instanceList.length != 0 && instanceList.message == undefined){
				 console.log("instanceList in getListInstances()"+instanceList.length);
				 listIntegrations();
			 }else{
				 loadSharepointOnlineForm();
			 }
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }
			}
		});
	}
	function setIntegrationAppAuthDetails() {
		var OAUTHURL    =   '';
		var CLIENTID    =   '';
		var TYPE        =   'code';
		var REDIRECT_URI = "https://183.82.99.100:8443/CiscoWebcontent/spark1.html";
		$.ajax({url: application_auth_details_url,
			async:true,
			success: function(result){
				CLIENTID=result.clientId;
				console.log("CLIENTID.." + CLIENTID);
				OAUTHURL= result.authorizationEndpoint;		
				console.log("authorizationEndpoint.." + OAUTHURL);				
				OAUTHURL=OAUTHURL+'?client_id='+CLIENTID+'&response_type='+TYPE+'&redirect_uri='+REDIRECT_URI;
				loginWithAuthDetails(OAUTHURL);	
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});		
	}
	function loginWithAuthDetails(oauthURL) {
		isRedirect=true;
		if(isRedirect) {
			if(formAction=="add") {
				window.top.location.href = oauthURL;
			} else {
				var authReqMsg ="";
				authReqMsg+='<hr class="instance-hr"><div class="large-12 medium-12 columns instance-background">';
				authReqMsg+='<div class="no-config-msg">You are not authorized to this integration. Click Add to continue.</div></div>';
				$('#integrations-block').show();
				$("#instance-list-block").html(authReqMsg);
			}			
		} else {
			var win = window.open(oauthURL, "windowname1", 'width=600, height=600'); 
				if(win){ 
			}else{
				alert(popblockedMessage); 
				return false;
			}
			var pollTimer = window.setInterval(function() { 
				try {
					if (win.document.URL.indexOf("code") != -1) {
						window.clearInterval(pollTimer);
						var url =   win.document.URL;
						accessCode =   gup(url, 'code');
						tokenType = gup(url, 'token_type');
						expiresIn = gup(url, 'expires_in');
						win.close();
						getIntegrationAppTokenDetails(accessCode);
					}
				} catch(e) {
					console.log('error while getting authorization code..'+e);
				}
			}, 100);
		}
    }
	function getIntegrationAppTokenDetails(code) {
		console.log("in getIntegrationAppTokenDetails");
		var jsonObject={};
		jsonObject["integrationId"] = integration_id;
		jsonObject["authSettings"] = {};
		jsonObject["authSettings"]["code"] = code;
		jsonString=JSON.stringify(jsonObject)
		$.ajax({url: token_url,
			async:true,
			type: "POST",
			data: jsonString,
			contentType: "application/json",
			dataType: "json",
			success: function(result){
				var tokenDetails=result["integrationSpecificAuthDetails"];
				var jsonObject1={};
				jsonObject1["applicationId"] = application_id;
				jsonObject1["integrationId"] = integration_id;
				jsonObject1["accessToken"] = tokenDetails.accessToken
				jsonObject1["refreshToken"] = tokenDetails.refreshToken;
				jsonObject1["refreshExpires"] = tokenDetails.expires;
				jsonObject1["subDomain"] = tokenDetails.subDomain;
				var jsonString=JSON.stringify(jsonObject1);				
				saveIntegrationAppToken(jsonString);
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function saveIntegrationAppToken(jsonData){
		$.ajax({url: save_app_token_url+"?userId="+user_id,
			async:true,
			type: "POST",
			data: jsonData,
			contentType: "application/json",
			dataType: "json",
			success: function(result){		
				connectIntegration();		
				console.log("in saveIntegrationAppToken isClientAppTokenValid "+isClientAppTokenValid);
				if(isClientAppTokenValid == false) getListInstances();
				else loadSharepointOnlineForm();
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});	
	}
	function getFolderList(jsonString){
		console.log("in getFolderList!!! .... Get Folders list");
		var itemFlag=false;	
		var folderMatchFlag = false;
		$(".items-loading").show();
		$(".edit-itemconfig-info").hide();
		$('.subfolderSelection').hide();
		resize();
		$.ajax({url: configuration_settings_url+"?userId="+user_id,
				async:true,
				type: "POST",
				data: jsonString,
				contentType: "application/json",
				dataType: "json",
				success: function(result){ 
					console.log("success..getFolderList!!!");
					if(result["postSpecificIntegrationSettings"]["foldersList"]!= undefined){
					<!-- console.log("result['postSpecificIntegrationSettings']['foldersList']--------------"+JSON.stringify(result['postSpecificIntegrationSettings']['foldersList'])); -->
						 itemslist = result["postSpecificIntegrationSettings"]["foldersList"]["value"]; 
						 console.log("load all folderlists to itemsLists");
						$(".items-loading").hide();
					}else if(result["postSpecificIntegrationSettings"].url!=undefined&&result["postSpecificIntegrationSettings"].url==false){
						urlValid= false;
						itemslist = "";
						$('.foldersfilesSelection').hide();
						alert("Please Enter Valid URL.");
						return false;
					}else{
						$("#integration-form").hide();
						alert("We've experienced some difficulty. Try again.");
					}
					$('#resources')[0].options.length = 4;
					var foldersCount = 0,filesCount = 0;
						if(itemslist.length != 0){
							console.log("itemslist.length!!!!<0" + itemslist.length);
							$.each(itemslist, function(id,obj){	
								if(obj.hasOwnProperty("file")){
									filesCount++;
									
									$("#files").append($('<option>').text(obj.name).attr('value',obj.id));
									console.log("file appended!!!!!!!!!!");
								}else{
									foldersCount++;
									$("#folders").append($('<option>').text(obj.name).attr('value',obj.id));
								}
								if(formAction=="update" && selected_source_id==obj.id && folderMatchFlag==false){
									console.log("formaction update!!!" + "selected_source_id" + selected_source_id);
									selected_source_id=obj.id;
									folderMatchFlag=true;
								}
							});
							if(formAction=="update" && !folderMatchFlag && !urlValid){
							console.log("folderMatchFlag!!!!!!!!!" + folderMatchFlag + "!!!!selected_source_id!!!!" + selected_source_id);
								if(selected_source_id!="all"&&selected_source_id!="rootfolders"&&selected_source_id!="rootfiles"){
									selected_source_id = "0";
									$(".edit-itemconfig-info").show();
								}
							}
							console.log("files count!!!!!!!!!!!!!!!!!!!!!!!!!!!!!" + filesCount);
							if(foldersCount == 0){
								$("#folders").hide();
							}else{
								$("#folders").show();
							}
							if(filesCount == 0){
								$("#files").hide();
							}else{
								$("#files").show();
							}			
							$('.foldersfilesSelection').show();
							console.log("after shown!!!!!!!!!!!!!!");
							resize();
						}else{
							if(formAction=="update" && selected_source_id!="0"){
								if(selected_source_id!="all"&&selected_source_id!="rootfolders"&&selected_source_id!="rootfiles"){
									$(".edit-itemconfig-info").show();
								}else if(selected_source_id=="all" || selected_source_id=="rootfolders" || selected_source_id=="rootfiles"){
									$(".edit-itemconfig-info").hide();
								}
								selected_source_id = "0"
								$('.foldersfilesSelection').show();
								resize();
							}else{
								$('.foldersfilesSelection').show();
								$(".edit-itemconfig-info").hide();
							}
						} 
						$("#resources").val(selected_source_id);
						console.log("selected_source_id!!!"+ selected_source_id);
						var jsonObject1={};
						jsonObject1["integrationId"] = integration_id;
						jsonObject1["userId"] = user_id;
						jsonObject1["itemId"] = selected_source_id;
						if(dropDownValue){
							console.log("site url !!!" + $("#siteurls").val() + "edit siteurl " + selected_site_url);
							jsonObject1["siteUrl"] = $("#siteurls").val();
						}else{
							console.log("WebUrl url !!!" + $("#WebUrl").val() + "edit WebUrl " + selectedWebUrl);
							jsonObject1["siteUrl"] = $("#WebUrl").val();
						}
						jsonString2=JSON.stringify(jsonObject1);
						console.log("jsonString2 "+jsonString2);
						console.log("getFolderList folderMatchFlag!!!!!!" + folderMatchFlag);
						if(formAction=="update"&&folderMatchFlag){
							console.log("jsonString2!!!!" + jsonString2);
							getNestedFolderList(jsonString2);
						}
						selected_source_id="0";
						resize();
				},
				error: function(xmlHttpRequest,error) {
				   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					   return;
				   } else{
						$(".foldersfilesSelection").hide();
						alert("We've experienced some difficulty. Try again.");
					}
				}
			});
			resize();
	}
	function getNestedFolderList(jsonStringData){
		console.log("in getNestedFolderList!!!" + jsonStringData);
		var itemFlag=false;	
		$(".subitems-loading").show();
		$(".edit-subfolderconfig-info").hide();
		$.ajax({url: configuration_settings_url+"?userId="+user_id,
				async:true,
				type: "POST",
				data: jsonStringData,
				contentType: "application/json",
				dataType: "json",
				success: function(result){ 
					console.log("success..");
					if(result["postSpecificIntegrationSettings"]["subItems"]!= undefined && result["postSpecificIntegrationSettings"]["subItems"]["value"]!= undefined){
						var subfolders = result["postSpecificIntegrationSettings"]["subItems"]["value"]; 
						$(".subitems-loading").hide();
						console.log("nested folder if......");
					}else{
						$("#integration-form").hide();
						console.log("nested folder else......");
						alert("We've experienced some difficulty. Try again.");
					}
					$('#subfolders')[0].options.length = 1;	
						if(subfolders.length != 0){
							$.each(subfolders, function(id,obj){	
								$("#subfolders").append($('<option>').text(obj.name).attr('value',obj.id));
							if(formAction=="update" && selected_subfolder_id==obj.id && itemFlag==false){
									console.log("each selected_subfolder_id..." + selected_subfolder_id);		
									selected_subfolder_id=obj.id;
									itemFlag=true;
								}
							});
							$('.subfolderSelection').show();
							resize();
						}else{
							selected_subfolder_id = "0";
							$('.subfolderSelection').hide();
							$(".edit-subfolderconfig-info").hide();
						} 
						if(formAction=="update" && selected_subfolder_id!=0 && itemFlag==false){
							selected_subfolder_id = "0";
							$(".edit-subfolderconfig-info").show();
						}
						console.log("Before setting value :: "+selected_subfolder_id);
						$("#subfolders").val(selected_subfolder_id);
						selected_subfolder_id="0";
						console.log("After setting value :: "+selected_subfolder_id);
				},
				error: function(xmlHttpRequest,error) {
				   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					   return;
				   } else{
						$(".subfolderSelection").hide();
						alert("We've experienced some difficulty. Try again.");
					}
				}
			});
			resize();
	}
	function generateIntegrationAppToken(app_code) {
		$.ajax({url: get_app_token_url+"?userId="+user_id,
			async:true,
			type: "get",
			success: function(result){
				if(result.tokenResult.tokenId) {
					validateIntegrationSpecificAppToken(app_code);
				} else {
					getIntegrationAppTokenDetails(app_code); 
				}
			},
			error: function(xmlHttpRequest,error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   }else{
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
	}
	function getAuthUser(){
		if(ui_settings["integrationSpecificSettings"]["settings"] != undefined)
		authenticated_user=ui_settings["integrationSpecificSettings"]["settings"].userName;
	}
	function loadSharepointOnlineForm(){		
		$("#form").trigger("reset");
		$('#integrations-block').hide();
		$("#integration-form").show();
		$(".edit-roomconfig-info").hide();
		$(".edit-itemconfig-info").hide();
		$(".rooms-loading").show();
		$("#WebUrl").val('');
		$("#WebUrl").prop('disabled', false);
		resize();
		if(ui_settings=="") {	
			console.log("loadSharepointOnlineForm!!!!!!!!!");
			$(".sitenames-loading").show();
			$.ajax({
				url: configuration_settings_url+"?userId="+user_id,
				async: true,
				success: function(result){
					$(".sitenames-loading").hide();
					ui_settings=result;	
					loadConfigurationSettings();
					loadRooms();
				},
				error: function(xmlHttpRequest,error) {
				   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
					   return;
				   } else{
						$('#integration-form').html("We've experienced some difficulty. Try again.");
						$('#integration-form').hide();
						alert("We've experienced some difficulty. Try again.");
					}
				}
			});
			getAllSparkRooms();
		}else{
			console.log("not empty loadSharepointOnlineForm!!!!");
			loadConfigurationSettings();
		}
		resize();
	}
	function loadConfigurationSettings() {
		console.log("in loadConfigurationSettings!!!");
		var selectedSiteUrlFlag=false;
		if(ui_settings["sparkRoomSettings"] && ui_settings["integrationSpecificSettings"]["settings"]!= undefined) {
			var itemFlag=false;
			var roomFlag=false;
			var rooms = "";
			resize();
			$('#siteurls')[0].options.length = 1;
			var authorizedto=ui_settings["integrationSpecificSettings"]["settings"].userName;
			var sitename = ui_settings["integrationSpecificSettings"]["settings"]["userDetails"].value;
			if(authorizedto!=""&& authorizedto!=undefined) {
				$('#authenticted-to').html(authorizedto);
				$(".authenticted-block").css("display","block");
			}
			if(sitename!=""&& sitename!=undefined) {
				$('#sharepoint-sitename').html(sitename);
				$(".sitename-block").css("display","block");
				$("#siteurls").append($('<option>').text(sitename).attr('value','/'));
			}
			var sitelist = ui_settings["integrationSpecificSettings"]["settings"]["siteList"]["value"]; 

			$('#rooms')[0].options.length = 1;
			rooms = ui_settings["sparkRoomSettings"].items;
			if(allRooms.length !=0) {
				rooms = allRooms;
				$(".rooms-loading").hide();
			}
			$.each(rooms, function(id,obj){
				$("#rooms").append($('<option>').text(obj.title).attr('value',obj.id));
				if(formAction=="update" && selected_room_id==obj.id&&roomFlag==false){
					selected_room_id=obj.id;
					roomFlag=true;
				}
			});	
			if(formAction=="update" && roomFlag==false){
				selected_room_id = "0";
				$(".edit-roomconfig-info").show();
			}
			if(formAction=="update" && dropDownValue && selected_site_url=='/'){
				selected_site_url =	'/'; 
				selectedSiteUrlFlag = true;
			}
			$.each(sitelist, function(id,obj){	
				console.log("in for each!!!!!!!!!!!");
				name = "";
				name = obj.name;
				$("#siteurls").append($('<option>').text(name).attr('value',obj.webUrl).prepend("&nbsp;&nbsp;&nbsp;"));
				console.log("obj.webUrl!!!" + obj.webUrl + "!!!selected_site_url!!!" + selected_site_url);
				if(formAction=="update" && selected_site_url==obj.webUrl && dropDownValue && selectedSiteUrlFlag==false){
						selected_site_url==obj.webUrl;
						selectedSiteUrlFlag=true;
					}
			});	
			if(formAction=="update" && selectedSiteUrlFlag==false && dropDownValue){
					selected_site_url = "0";
					$(".edit-siteconfig-info").show();
			}
			$("#rooms").val(selected_room_id);
			if(formAction=="update"){
				if(!dropDownValue){
					$("#WebUrl").val(selectedWebUrl);
				}else{
					console.log("dropdown false cond!!!!");
					$("#WebUrl").prop('disabled', true);
				}	
			}
			$("#siteurls").val(selected_site_url);
			$('#select2-rooms-container').html($("#rooms option:selected").text());
			var jsonObject={};
			jsonObject["integrationId"] = integration_id;
			jsonObject["userId"] = user_id;
			if(dropDownValue)	jsonObject["siteUrl"] = selected_site_url;
			else jsonObject["siteUrl"] = selectedWebUrl;
				jsonString=JSON.stringify(jsonObject);
			if(formAction=="update"&&selectedSiteUrlFlag&&dropDownValue){
				getFolderList(jsonString);
			}else if(formAction=="update"&&!dropDownValue){
				getFolderList(jsonString);
			}
			selected_room_id="0";
			selected_site_url = "0";
			resize();
		} else {
			alert("We've experienced some difficulty. Try again.");
			$('#integration-form').html("We've experienced some difficulty. Try again.");
			$('#integration-form').hide();
		}	
		resize();
	}
	function validateConfiguration(instance, notifications){
	    console.log("validating Configuration....");
		var configData = JSON.parse(instance.configJson);
		var configEvents = configData.notifications;
		var notificationsLength = notifications.length;
		var matchCount = 0;
		configFlag = false;
		eventsMatchFlag = true;
		resize();
		if($("#subfolders").val()==0&&folderFlag){
			 subfolder_id= "all";
		}else{
			subfolder_id= $("#subfolders").val();
		}
		console.log("configData.sub_item_id.." + configData.sub_item_id + " subfolder_id.."+ subfolder_id);
		if(instance.channelId==room_id&&configData.item_id==selectedSourceId&&configData.sub_item_id==subfolder_id){
			console.log("matched...space and folder/file and subfolder");
			configFlag = true;
		}
		if($.isArray(notifications)){
			console.log("configEvents..." + configEvents +"length...." + configEvents.length);
			if($.isArray(configEvents)){
				for (var p in notifications) {
					if(configEvents[p] != notifications[p]){
						eventsMatchFlag = false;
						console.log("Match: " + configEvents[p] + "!=" + notifications[p]);
					}else {
						matchCount = matchCount +1;
					   console.log("Match: " + configEvents[p] + "==" + notifications[p]);
					}
					console.log("match count..." + matchCount + "configEvents.length..." + configEvents.length);
					if(matchCount==configEvents.length&&notificationsLength==configEvents.length){
						eventsMatchFlag = true;
						return false;
					}else{
						eventsMatchFlag = false;
					}
				}
			}else{
			    console.log("not matched...configEvents");
				eventsMatchFlag = false;
			}
		}else{
			if($.isArray(configEvents)){
			    eventsMatchFlag = false;
				console.log("not matched...array" + eventsMatchFlag);
			}else{
			  if(configEvents==notifications){
				eventsMatchFlag = true;
				 console.log("matched single.." + eventsMatchFlag);
			  }else{
				eventsMatchFlag = false;
			  }
			}
		}
	}
	function saveSharepointOnlineInstance(){
		var res = $('form').serializeObject();
		selectedRoomName=$("#rooms option:selected").text();
		selectedSourceId=$("#resources option:selected").val();
		selectedSiteUrl=$("#siteurls option:selected").val();
		selectedWebUrl=$("#WebUrl").val();
		selectedSubSourceId=$("#subfolders").val();
		room_id =$("#rooms option:selected").val();
		var source_name = $("#resources option:selected").text();
		var jsonData = {};
		console.log("room_ID_________")
		jsonData["channelId"] = room_id;								
		jsonData["integrationId"] = integration_id;
		jsonData["status"] = "ACTIVE";
		jsonData["userId"] = user_id;
		postAddMessageToRoom(room_id,appName);
		if(formAction=="update") {
			jsonData["configJson"]={};
			jsonData["instance_id"] = instanceId;
			resize();
			if(room_id!=room_id_old) {
				room_modified=true;
				jsonData["messageToSpark"] = updateMessageToSpark;
			} else {
				room_modified=false;
			}
			if(source_id_old!=selectedSourceId) {
				source_modified=true;
			} else {
				source_modified=false;
			}	
			if(sub_source_id_old!=selectedSubSourceId) {
				sub_source_modified=true;
			} else {
				sub_source_modified=false;
			}	
			jsonData["source_modified"] = source_modified;
			jsonData["room_modified"] = room_modified;	
			jsonData["instanceUuid"] = instanceUuid;			
			jsonData["configJson"]=JSON.parse(instanceData.configJson);
			action_url=update_configuration_settings_url+instanceId;
			actionType="PUT";
			$('.loading-first-block').html('Please wait while your Integration is being updated');
		} else {
			jsonData["configJson"]={};			
			jsonData["messageToSpark"] = postMessageToSpark;
			action_url=save_configuration_settings_url;
			actionType="POST";
			$('.loading-first-block').html('Please wait while your Integration is being set up');
		}
		jsonData["configJson"]["notifications"] = res.events;
		jsonData["configJson"]["item_id"] = selectedSourceId;
		
		if(selectedSiteUrl!=0 && selectedSiteUrl!=null){
			jsonData["configJson"]["siteUrl"] = selectedSiteUrl;
			jsonData["configJson"]["dropDownValue"] = true;
		}else{
			jsonData["configJson"]["siteUrl"] = selectedWebUrl;
			jsonData["configJson"]["dropDownValue"] = false;
		
		}
		jsonData["configJson"]["sub_item_id"]= $("#subfolders").val();
		jsonData["configJson"]["resources"] = $("#resources option:selected").text();
		jsonData["configJson"]["displayName"]= res.displayName;
		jsonData["messageFormat"]="Sharepoint Online Bot :"+"Hello...User";
		saveJsonString = JSON.stringify(jsonData);
		var notificationslength = objLength(res.events);
		var notifications = res.events;
		if(listResultData.length != 0 && notificationslength !=0){
			$.each(listResultData, function(i, instance) {
				if(formAction=="update"&&instance.instanceId!=instanceId){
				 validateConfiguration(instance, notifications);
				 if(eventsMatchFlag==true&&configFlag==true){
					 console.log("eventsMatchFlag in cond.." + eventsMatchFlag + " config Flag.." + configFlag);
						return false;
					}
				}
				if(formAction!="update"){
				 validateConfiguration(instance, notifications);
				  if(eventsMatchFlag==true&&configFlag==true){
					 console.log("eventsMatchFlag in cond.." + eventsMatchFlag + " config Flag.." + configFlag);
						return false;
					}
				}
			});
		} 
		console.log("selected_web_url!!!!!!!!!!!!!!!!!" + selected_web_url);
		if(formAction=="update"){if($('#WebUrl').val()==selected_web_url)webURL=selected_web_url;urlValid=true;}
		console.log("urlvalid!!!" + urlValid + " !!!webURL!!!" +webURL  + "!!!current value!!!" + $('#WebUrl').val());
		if($("#WebUrl").val()=="" && $("#siteurls").val()=='0'){
			alert("Please select Site URL  or provide Site URL in Site URL textbox.");
		}else if($('#rooms').val()==0 || $('#rooms').val()==null){ 
		    alert("Please select Space");
		}else if($('#WebUrl').val()!=0&&!urlValid || $('#WebUrl').val()!=0&&webURL!=$('#WebUrl').val()){
			alert("Please Enter Valid URL.");
		}else if($('#resources').val()==0){ 
		    alert("Please select Folders/Files");
		}else if(notificationslength==0){ 
		    alert("Please select atleast one Event");
		}else if(listResultData.length != 0 && eventsMatchFlag==true && configFlag==true){
			if(formAction=="update"){
				$.each(listResultData, function(i, instance) {
					if(formAction=="update"&&instance.instanceId==instanceId){
					 validateConfiguration(instance, notifications);
					}
				});
				if(room_modified || source_modified || sub_source_modified || !eventsMatchFlag)
					$('#same-configuration').foundation('open');
				else
					saveSharepointInstanceConfig();
			}else{
				$('#same-configuration').foundation('open');
			}
		}else {
			saveSharepointInstanceConfig();
		}
	}
	function saveSharepointInstanceConfig(){
		console.log("saveSharepointInstanceConfig!!!!!!!!!");
		$('#same-configuration').foundation('close');
		$('.loading-second-block').html('Selected Space is '+ selectedRoomName);
		$('#loading-block').foundation('open');
		console.log("saveSharepointInstanceConfig*****************");
		$.ajax({url: action_url+"?userId="+user_id,
			async:true,
			type: actionType,
			data: saveJsonString,
			contentType: "application/json",
			dataType: "json",
			success: function(result){	
				console.log("Success...........");
				$('#success-integration').foundation('open');
				$('#loading-block').foundation('close');					
			},
			error: function(xmlHttpRequest, error) {
			   if(xmlHttpRequest.readyState == 0 || xmlHttpRequest.status == 0) {
				   return;
			   } else{
					console.log("error occured@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@");
					$('#loading-block').foundation('close');
					alert("We've experienced some difficulty. Try again.");
				}
			}
		});
		$('.loading-first-block').html('Please wait just a moment while your app is loading');
		console.log("saveSharepointInstanceConfig+++++++++++++++++++++");
		$('.loading-second-block').html('');
	}
</script>
</head>
<body>	
	<div class="integration-app" id="sharepoint">
		<div class="rows large-12 medium-12 columns warning-msg" style="display:none;"></div>
		<div class="rows large-12 medium-12 columns client-app-warning" style="display:none;"></div>
		<div id="loading-block" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="loading"><img class="spark-icon" src="" alt="....."></div>
			<div class="loading-div-background">
				<div class="loading-first-block">Please wait just a moment while your app is loading</div>
				<div class="loading-second-block">name and space name</div>
				<div class="loading-bar"><div class="loading-background"></div>	</div>
			</div>
		</div>
		<div id="list-loading-block" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="loading"><img class="spark-icon" src="" alt="....."></div>
			<div class="loading-div-background">
				<div class="loading-first-block">Please wait...</div>
				<div class="loading-second-block"></div>
				<div class="loading-bar"><div class="loading-background"></div>	</div>
			</div>
		</div>
		<div id="success-integration" class="reveal success-integration" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="success-loading">
				<img class="spark-icon" src="" alt=".....">
			</div>
			<div class="well-done-text">Well done!</div>
			<div class="success-integration-first-block">Your configuration has been set up and is ready to use.</div>
			<div class="success-integration-note-block"><b>Note:</b> You may see a delay of up to 2 mins to receive notifications into your Cisco Spark spaces after its triggered.</div>
			<div class="large-5 medium-5 columns buttons-block">
				<div class="success-integration-second-block">
					<!--<button class="button" id="room-button">Go to
						Content Testing Space</button>-->
					<button class="secondary button" id="done-button">Done</button>
				</div>
			</div>
		</div>
		<div class="reveal" id="remove-integration-popup" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="large-12 columns desktop-block">
				<div class="row ">
					<div class="large-2 medium-2 columns"><img alt="icon" id="sharepoint-icon" src=""></div>
					<div class="large-6 medium-6 columns" style="float:left;">
						<span id="displayName-label">Sharepoint Online</span><br>
						<span id="addedon-label"></span>
					</div>
				</div><br>
				<div class="msg-labels">
					<label id="remove-msg"></label> 
					<label id="remove-auth"></label>
				</div>
				<button class="close-button" data-close aria-label="Close modal" type="button">
					<span aria-hidden="true">&times;</span>
				</button><br><br>
				<button class="button remove-integration-btn" id="remove-integration-btn" style="float:right">Remove</button>
			</div>
			<div class="large-12 columns mobile-block">	
				<div class="msg-labels">
					<label id="remove-msg-mobile"></label> 
					<label id="remove-auth-mobile"></label> 
				</div>				
				<div class="option-buttons remove-integration-buttons">
					<label class="remove-popup-cancel"> 
						<a href="#" id="cancel-remove-integration">cancel</a>
					</label>
					<label class="remove-popup-remove">
						<a href="#" id="remove-integration-btn" class="remove-integration-btn">remove</a>
					</label>
				</div>
			</div>
		</div>
		<div id="same-configuration" class="reveal" data-reveal data-options="closeOnClick:false;closeOnEsc:false;">
			<div class="same-config-text">An identical configuration to the same Cisco Spark space you have selected already exists. Are you sure you want to configure one more?</div>
			<div class="large-5 medium-5 columns buttons-block">
				<button class="secondary button same-config-yes">Yes</button>
				<button class="secondary button same-config-no">No</button>
			</div>
		</div>
		<div class="integrations" id="integrations-block">
			<div id="instance-loading-block" class="row instance-loading-block" style="display: none;">
				<div class="instances-loading">&nbsp;</div>
				<div class="instances-loading-text">Loading your configurations</div>
			</div>
			<div id="home" class="home">			
				<div class="row add-config-block">
					<div class="large-12 medium-12 columns">							
						<div class="large-6 medium-6 columns config-name"><label>Sharepoint Online configurations</label></div>
						<div class="large-6 medium-6 columns">
							<button class="button" data-open="remove-integration-popup" id="remove-all-config">Remove All</button>
							<button class="secondary button" id="add-config">Add</button>
						</div>					
					</div>
				</div>
				<div id="instance-list-block" class="row instance-list-block">						
				</div>
			</div>
		</div>
		<div id="integration-form" class="large-12 columns" >
			<div class="large-12 medium-12 columns edit-siteconfig-info" style="display:none">
				<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured site name does not exist.</span></p>
			</div>
			<div class="large-12 medium-12 columns edit-itemconfig-info" style="display:none">
				<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured folder/file does not exist.</span></p>
			</div>
			<div class="large-12 medium-12 columns edit-subfolderconfig-info" style="display:none">
				<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured subfolder does not exist.</span></p>
			</div>
			<div class="large-12 medium-12 columns edit-roomconfig-info" style="display:none">
				<p><span class="info-icon" title=""> &nbsp;</span><span>Previously configured space does not exist.</span></p>
			</div>
			<div class="authenticted-block">Authenticated to Sharepoint Online as: <span id="authenticted-to"></span></div>
			<!-- <div class="sitename-block">SiteName: <span id="sharepoint-sitename"></span></div> -->
			<div class="no-configuration-block" style="display:none">There are no Folders.Files available in your Sharepoint Online Account. Please Add folders/files in your account and configure</div>
			<form name="form" id="form" method="post">
				<div class="row app-config-block">
					<div class="large-10 medium-10 columns  first sub-config-block">
						<label class="heading-01">Sharepoint Online configuration</label>
							<div class="large-8 columns items-config">
								<div class="large-3 medium-4 columns ">
									<label class="label-config">Site Names</label>
								</div>
								<div class="large-5 medium-6 columns dropdown-config text left ">
									<select id="siteurls" name="resource" class="dropdown">
										<option value='0'>Select Site Name</option>			 
									</select>
									<span class="has-tip tip-right" id="tooltip" title="" data-tooltip><img class="tool-tip"></span>
									<div class="sitenames-loading" style="display: none;"></div>
								</div>			
							</div>
							<div class="large-8 columns items-config">
								<div class="large-2 medium-4 columns small-mobile config-optional">
									<label>Site URL</label>
								</div>
								<div class="large-5 medium-5  columns text left input-small-mobile sharepoint-weburl">
									<input type="text" name="WebUrl" id="WebUrl" class="integration-name" value="" placeholder="https://<domain>.sharepoint.com/site/<SiteName>/SitePages/Home.aspx">
								</div>
								<span class="has-tip tip-right sharepoint-url-tooltip" id="tooltip" title="Please click Enter after providing the Site URL" data-tooltip><img class="tool-tip"></span>
							</div>
					</div>
					
					<div class="large-10 medium-10 columns sub-config-block foldersfilesSelection" style="display:none;"> 
						<div class="large-8 columns items-config">
							<div class="large-3 medium-4 columns ">
								<label class="label-config">Folders / Files from sites</label>
							</div>
							<div class="large-5 medium-6 columns dropdown-config text left">
								<select id="resources" name="resource" class="dropdown">
									<option value='0' hidden>Select Folders / Files</option>
								    <option value="all">All Folders & Files </option>
									<option value="rootfolders">All Folders (including nested folders and files)</option>
									<option value="rootfiles" >All Files</option>
									<optgroup id="folders" label="Root Folders"></optgroup >
									<optgroup id="files" label="Root Files"></optgroup >				 
								</select>
								<span class="has-tip tip-right" id="tooltip" title="Select Folders and Files for which you'd like to receive notifications. Selecting All Folders or All Files, will also send notifications about all the nested folders or files. Individual folder or file selection enabled only for root level folders and files" data-tooltip><img class="tool-tip"></span>
								<div class="items-loading" style="display: none;"></div>
							</div>			
						</div>
					</div>
					<div class="large-10 medium-10 columns sub-config-block subfolderSelection" style="display:none;">
						<div class="large-8 columns items-config">
							<div class="large-3 medium-4 columns">
								<label class="label-config">Sub Folders/Files (Optional)</label>
							</div>
							<div class="large-5 medium-6 columns dropdown-config text left ">
								<select id="subfolders" name="subfolders" class="dropdown">
									<option value="0">None</option></select>			 
								</select>
								<span class="has-tip tip-right" id="tooltip" title="Select Subfolders for which you'd like to receive notifications. If you don't select then you will get notifications for all subfolders." data-tooltip><img class="tool-tip"></span>
								<div class="subitems-loading" style="display: none;"></div>
							</div>				
						</div>
					</div>
					<div class="large-12 columns events-config">
						<div class="large-12 medium-12 columns events">
							<label>Notifications</label>
							<div id="events" class="events-sub">
								<label>Note: If a folder is chosen, all notifications selected below will be applied to all files and subfolders within the selected folder.</label>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-3 columns checkbox"><input type="checkbox" id="create" name="events" value="create"/><label for="create">Create</label></div>
									<div class="large-3 medium-3 columns checkbox"><input type="checkbox" id="delete" name="events" value="delete"/><label for="delete">Delete</label></div>
								</div>
								<div class="large-12 medium-12 columns">
									<div class="large-3 medium-3 columns checkbox"><input type="checkbox" id="modify" name="events" value="update"/><label for="modify">Update</label></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row spark-config-block">
					<div class="large-10 medium-10 columns">
						<h3 class="heading-01">Cisco Spark configuration</h3>
						<div class="large-8 columns sub-config-block">
							<div class="large-2 medium-3 columns small-mobile">
								<label>Space</label>
							</div>
							<div class="large-5 medium-5 columns text left input-small-mobile">
								<select name="room" id="rooms" class="custom-select">
								<option value='0'>Please Select</option></select>
								<span class="has-tip tip-right" id="tooltip" title="Space in which you'd like to receive notifications. Ensure newly created spaces have at least one message in it for it to show up here." data-tooltip><img class="tool-tip"></span>
							</div>
							<div class="rooms-loading" style="display: none;"></div>
						</div>
						<div class="large-8 columns sub-config-block left">
							<div class="large-2 medium-3 columns small-mobile config-optional">
								<label>Configuration name (optional)</label>
							</div>
							<div class="large-5 medium-5  columns text left input-small-mobile">
								<input type="text" name="displayName" id="displayName" class="integration-name"	value="">
							</div>
						</div>
					</div>
				</div>
				<div class="row integration-config-block">
					<div class="large-5 medium-5 columns"> &nbsp;</div>
					<div class="large-4 medium-4 columns left">
						<button id="cancel-button" class="button">Cancel</button>
						<button id="submit-button" class="button secondary text">Add Integration</button>
					</div>
				</div>
			</form>
		</div>		
	</div>
</body>
</html>